var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b};$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};
$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&($jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(e):
$jscomp.POLYFILL_PREFIX+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};
$jscomp.getConstructImplementation=function(){function a(){function c(){}new c;Reflect.construct(c,[],function(){});return new c instanceof c}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(a())return Reflect.construct;var b=Reflect.construct;return function(c,d,e){c=b(c,d);e&&Reflect.setPrototypeOf(c,e.prototype);return c}}return function(c,d,e){void 0===e&&(e=c);e=$jscomp.objectCreate(e.prototype||Object.prototype);return Function.prototype.apply.call(c,e,d)||
e}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var c=$jscomp.setPrototypeOf;c(a,b)}else for(c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype};$jscomp.polyfill("Reflect",function(a){return a?a:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(a){return $jscomp.construct},"es6","es3");
$jscomp.polyfill("Reflect.setPrototypeOf",function(a){if(a)return a;if($jscomp.setPrototypeOf){var b=$jscomp.setPrototypeOf;return function(c,d){try{return b(c,d),!0}catch(e){return!1}}}return null},"es6","es5");$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var e=d.length,f=b.length;c=Math.max(0,Math.min(c|0,d.length));for(var g=0;g<f&&c<e;)if(d[c++]!=b[g++])return!1;return g>=f}},"es6","es3");
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"endsWith");b+="";void 0===c&&(c=d.length);c=Math.max(0,Math.min(c|0,d.length));for(var e=b.length;0<e&&0<c;)if(d[--c]!=b[--e])return!1;return 0>=e}},"es6","es3");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(e,f){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:f})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c=0,d=function(e){if(this instanceof d)throw new TypeError("Symbol is not a constructor");return new b("jscomp_symbol_"+(e||"")+"_"+c++,e)};return d},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=$jscomp.global[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&$jscomp.defineProperty(d.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b,c){return c})}},"es8","es3");$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).i}},"es6","es3");
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(b){var c=$jscomp.checkStringArgs(this,null,"repeat");if(0>b||1342177279<b)throw new RangeError("Invalid count value");b|=0;for(var d="";b;)if(b&1&&(d+=c),b>>>=1)c+=c;return d}},"es6","es3");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)$jscomp.owns(d,e)&&(a[e]=d[e])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).v}},"es6","es3");OV={};OV.TaskRunner=function(){this.callbacks=this.current=this.count=null};OV.TaskRunner.prototype.Run=function(a,b){this.count=a;this.current=0;this.callbacks=b;0===a?this.TaskReady():this.RunOnce()};OV.TaskRunner.prototype.RunBatch=function(a,b,c){var d=0;0<a&&(d=parseInt((a-1)/b,10)+1);this.Run(d,{runTask:function(e,f){c.runTask(e*b,Math.min((e+1)*b,a)-1,f)},onReady:c.onReady})};
OV.TaskRunner.prototype.RunOnce=function(){var a=this;setTimeout(function(){a.callbacks.runTask(a.current,a.TaskReady.bind(a))},0)};OV.TaskRunner.prototype.TaskReady=function(){this.current+=1;if(this.current<this.count)this.RunOnce();else if(this.callbacks.onReady)this.callbacks.onReady()};OV.RunTaskAsync=function(a){setTimeout(function(){a()},0)};OV.Eps=1E-8;OV.RadDeg=57.29577951308232;OV.DegRad=.017453292519943;OV.IsZero=function(a){return Math.abs(a)<OV.Eps};OV.IsLower=function(a,b){return b-a>OV.Eps};OV.IsGreater=function(a,b){return a-b>OV.Eps};OV.IsLowerOrEqual=function(a,b){return b-a>-OV.Eps};OV.IsGreaterOrEqual=function(a,b){return a-b>-OV.Eps};OV.IsEqual=function(a,b){return Math.abs(b-a)<OV.Eps};OV.IsPositive=function(a){return a>OV.Eps};OV.IsNegative=function(a){return a<-OV.Eps};OV.Direction={X:1,Y:2,Z:3};OV.Coord2D=function(a,b){this.x=a;this.y=b};OV.Coord2D.prototype.Clone=function(){return new OV.Coord2D(this.x,this.y)};OV.CoordIsEqual2D=function(a,b){return OV.IsEqual(a.x,b.x)&&OV.IsEqual(a.y,b.y)};OV.AddCoord2D=function(a,b){return new OV.Coord2D(a.x+b.x,a.y+b.y)};OV.SubCoord2D=function(a,b){return new OV.Coord2D(a.x-b.x,a.y-b.y)};OV.CoordDistance2D=function(a,b){return Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y))};OV.Coord3D=function(a,b,c){this.x=a;this.y=b;this.z=c};OV.Coord3D.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};OV.Coord3D.prototype.MultiplyScalar=function(a){this.x*=a;this.y*=a;this.z*=a;return this};OV.Coord3D.prototype.Normalize=function(){var a=this.Length();0<a&&this.MultiplyScalar(1/a);return this};OV.Coord3D.prototype.Offset=function(a,b){a=a.Clone().Normalize();this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;return this};
OV.Coord3D.prototype.Rotate=function(a,b,c){var d=a.Clone().Normalize();a=d.x;var e=d.y;d=d.z;var f=this.x-c.x,g=this.y-c.y,h=this.z-c.z,k=Math.sin(b);b=Math.cos(b);this.x=-a*(-a*f-e*g-d*h)*(1-b)+f*b+(-d*g+e*h)*k;this.y=-e*(-a*f-e*g-d*h)*(1-b)+g*b+(d*f-a*h)*k;this.z=-d*(-a*f-e*g-d*h)*(1-b)+h*b+(-e*f+a*g)*k;this.x+=c.x;this.y+=c.y;this.z+=c.z;return this};OV.Coord3D.prototype.Clone=function(){return new OV.Coord3D(this.x,this.y,this.z)};
OV.CoordIsEqual3D=function(a,b){return OV.IsEqual(a.x,b.x)&&OV.IsEqual(a.y,b.y)&&OV.IsEqual(a.z,b.z)};OV.AddCoord3D=function(a,b){return new OV.Coord3D(a.x+b.x,a.y+b.y,a.z+b.z)};OV.SubCoord3D=function(a,b){return new OV.Coord3D(a.x-b.x,a.y-b.y,a.z-b.z)};OV.CoordDistance3D=function(a,b){return Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y)+(a.z-b.z)*(a.z-b.z))};
OV.VectorAngle3D=function(a,b){a=a.Clone().Normalize();b=b.Clone().Normalize();if(OV.CoordIsEqual3D(a,b))return 0;b=OV.DotVector3D(a,b);return Math.acos(b)};OV.DotVector3D=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};OV.CrossVector3D=function(a,b){var c=new OV.Coord3D(0,0,0);c.x=a.y*b.z-a.z*b.y;c.y=a.z*b.x-a.x*b.z;c.z=a.x*b.y-a.y*b.x;return c};OV.VectorLength3D=function(a,b,c){return Math.sqrt(a*a+b*b+c*c)};OV.ArrayToCoord3D=function(a){return new OV.Coord3D(a[0],a[1],a[2])};OV.Quaternion=function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d};OV.ArrayToQuaternion=function(a){return new OV.Quaternion(a[0],a[1],a[2],a[3])};OV.Box3D=function(a,b){this.min=a;this.max=b};OV.Box3D.prototype.GetMin=function(){return this.min};OV.Box3D.prototype.GetMax=function(){return this.max};OV.Box3D.prototype.GetCenter=function(){return new OV.Coord3D((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,(this.min.z+this.max.z)/2)};OV.BoundingBoxCalculator3D=function(){this.box=new OV.Box3D(new OV.Coord3D(Infinity,Infinity,Infinity),new OV.Coord3D(-Infinity,-Infinity,-Infinity))};OV.BoundingBoxCalculator3D.prototype.GetBox=function(){return this.box};
OV.BoundingBoxCalculator3D.prototype.AddPoint=function(a){this.box.min.x=Math.min(this.box.min.x,a.x);this.box.min.y=Math.min(this.box.min.y,a.y);this.box.min.z=Math.min(this.box.min.z,a.z);this.box.max.x=Math.max(this.box.max.x,a.x);this.box.max.y=Math.max(this.box.max.y,a.y);this.box.max.z=Math.max(this.box.max.z,a.z)};OV.OctreeNode=function(a,b){this.boundingBox=a;this.level=b;this.pointItems=[];this.childNodes=[]};OV.OctreeNode.prototype.AddPoint=function(a,b,c){var d=this.FindNodeForPoint(a);if(null===d||null!==d.FindPointDirectly(a))return!1;if(d.pointItems.length<c.maxPointsPerNode||d.level>=c.maxTreeDepth)return d.AddPointDirectly(a,b),!0;d.CreateChildNodes();var e=d.pointItems;d.pointItems=[];for(var f=0;f<e.length;f++){var g=e[f];if(!d.AddPoint(g.point,g.data,c))return!1}return d.AddPoint(a,b,c)};
OV.OctreeNode.prototype.FindPoint=function(a){var b=this.FindNodeForPoint(a);return null===b?null:b.FindPointDirectly(a)};OV.OctreeNode.prototype.AddPointDirectly=function(a,b){this.pointItems.push({point:a,data:b})};OV.OctreeNode.prototype.FindPointDirectly=function(a){for(var b=0;b<this.pointItems.length;b++){var c=this.pointItems[b];if(OV.CoordIsEqual3D(a,c.point))return c.data}return null};
OV.OctreeNode.prototype.FindNodeForPoint=function(a){if(!this.IsPointInBounds(a))return null;if(0===this.childNodes.length)return this;for(var b=0;b<this.childNodes.length;b++){var c=this.childNodes[b].FindNodeForPoint(a);if(null!==c)return c}return null};
OV.OctreeNode.prototype.CreateChildNodes=function(){function a(g,h,k,l,m,p,n){h=new OV.Box3D(new OV.Coord3D(h,k,l),new OV.Coord3D(h+m,k+p,l+n));g.childNodes.push(new OV.OctreeNode(h,g.level+1,g.options))}var b=this.boundingBox.min,c=this.boundingBox.GetCenter(),d=(this.boundingBox.max.x-this.boundingBox.min.x)/2,e=(this.boundingBox.max.y-this.boundingBox.min.y)/2,f=(this.boundingBox.max.z-this.boundingBox.min.z)/2;a(this,b.x,b.y,b.z,d,e,f);a(this,c.x,b.y,b.z,d,e,f);a(this,b.x,c.y,b.z,d,e,f);a(this,
c.x,c.y,b.z,d,e,f);a(this,b.x,b.y,c.z,d,e,f);a(this,c.x,b.y,c.z,d,e,f);a(this,b.x,c.y,c.z,d,e,f);a(this,c.x,c.y,c.z,d,e,f)};OV.OctreeNode.prototype.IsPointInBounds=function(a){return OV.IsGreaterOrEqual(a.x,this.boundingBox.min.x)&&OV.IsGreaterOrEqual(a.y,this.boundingBox.min.y)&&OV.IsGreaterOrEqual(a.z,this.boundingBox.min.z)&&OV.IsLowerOrEqual(a.x,this.boundingBox.max.x)&&OV.IsLowerOrEqual(a.y,this.boundingBox.max.y)&&OV.IsLowerOrEqual(a.z,this.boundingBox.max.z)};
OV.Octree=function(a,b){this.options={maxPointsPerNode:10,maxTreeDepth:10};void 0!==b&&(void 0!==b.maxPointsPerNode&&(this.options.maxPointsPerNode=b.maxPointsPerNode),void 0!==b.maxTreeDepth&&(this.options.maxTreeDepth=b.maxTreeDepth));this.rootNode=new OV.OctreeNode(a,0,this.options)};OV.Octree.prototype.AddPoint=function(a,b){return this.rootNode.AddPoint(a,b,this.options)};OV.Octree.prototype.FindPoint=function(a){return this.rootNode.FindPoint(a)};OV.Matrix=function(a){this.matrix=null;void 0!==a&&null!==a&&(this.matrix=a)};OV.Matrix.prototype.IsValid=function(){return null!==this.matrix};OV.Matrix.prototype.Set=function(a){this.matrix=a;return this};OV.Matrix.prototype.Get=function(){return this.matrix};
OV.Matrix.prototype.Clone=function(){return new OV.Matrix([this.matrix[0],this.matrix[1],this.matrix[2],this.matrix[3],this.matrix[4],this.matrix[5],this.matrix[6],this.matrix[7],this.matrix[8],this.matrix[9],this.matrix[10],this.matrix[11],this.matrix[12],this.matrix[13],this.matrix[14],this.matrix[15]])};OV.Matrix.prototype.CreateIdentity=function(){this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return this};
OV.Matrix.prototype.IsIdentity=function(){for(var a=(new OV.Matrix).CreateIdentity().Get(),b=0;16>b;b++)if(!OV.IsEqual(this.matrix[b],a[b]))return!1;return!0};OV.Matrix.prototype.CreateTranslation=function(a,b,c){this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,a,b,c,1];return this};OV.Matrix.prototype.CreateRotation=function(a,b,c,d){var e=a+a,f=b+b,g=c+c,h=a*e,k=a*f;a*=g;var l=b*f;b*=g;c*=g;e*=d;f*=d;d*=g;this.matrix=[1-(l+c),k+d,a-f,0,k-d,1-(h+c),b+e,0,a+f,b-e,1-(h+l),0,0,0,0,1];return this};
OV.Matrix.prototype.CreateScale=function(a,b,c){this.matrix=[a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1];return this};OV.Matrix.prototype.ComposeTRS=function(a,b,c){var d=b.x,e=b.y,f=b.z,g=b.w;b=c.x;var h=c.y;c=c.z;var k=d+d,l=e+e,m=f+f,p=d*k,n=d*l;d*=m;var q=e*l;e*=m;f*=m;k*=g;l*=g;g*=m;this.matrix=[(1-(q+f))*b,(n+g)*b,(d-l)*b,0,(n-g)*h,(1-(p+f))*h,(e+k)*h,0,(d+l)*c,(e-k)*c,(1-(p+q))*c,0,a.x,a.y,a.z,1];return this};
OV.Matrix.prototype.DecomposeTRS=function(){var a=new OV.Coord3D(this.matrix[12],this.matrix[13],this.matrix[14]),b=OV.VectorLength3D(this.matrix[0],this.matrix[1],this.matrix[2]),c=OV.VectorLength3D(this.matrix[4],this.matrix[5],this.matrix[6]),d=OV.VectorLength3D(this.matrix[8],this.matrix[9],this.matrix[10]),e=this.Determinant();OV.IsNegative(e)&&(b*=-1);e=new OV.Coord3D(b,c,d);var f=this.matrix[0]/b,g=this.matrix[4]/c,h=this.matrix[8]/d,k=this.matrix[1]/b,l=this.matrix[5]/c,m=this.matrix[9]/d;
b=this.matrix[2]/b;c=this.matrix[6]/c;d=this.matrix[10]/d;var p=f+l+d;0<p?(f=2*Math.sqrt(p+1),g=new OV.Quaternion((c-m)/f,(h-b)/f,(k-g)/f,.25*f)):f>l&&f>d?(f=2*Math.sqrt(1+f-l-d),g=new OV.Quaternion(.25*f,(g+k)/f,(h+b)/f,(c-m)/f)):l>d?(f=2*Math.sqrt(1+l-f-d),g=new OV.Quaternion((g+k)/f,.25*f,(m+c)/f,(h-b)/f)):(f=2*Math.sqrt(1+d-f-l),g=new OV.Quaternion((h+b)/f,(m+c)/f,.25*f,(k-g)/f));return{translation:a,rotation:g,scale:e}};
OV.Matrix.prototype.Determinant=function(){var a=this.matrix[0],b=this.matrix[1],c=this.matrix[2],d=this.matrix[3],e=this.matrix[4],f=this.matrix[5],g=this.matrix[6],h=this.matrix[7],k=this.matrix[8],l=this.matrix[9],m=this.matrix[10],p=this.matrix[11],n=this.matrix[12],q=this.matrix[13],r=this.matrix[14],t=this.matrix[15];return(a*f-b*e)*(m*t-p*r)-(a*g-c*e)*(l*t-p*q)+(a*h-d*e)*(l*r-m*q)+(b*g-c*f)*(k*t-p*n)-(b*h-d*f)*(k*r-m*n)+(c*h-d*g)*(k*q-l*n)};
OV.Matrix.prototype.Invert=function(){var a=this.matrix[0],b=this.matrix[1],c=this.matrix[2],d=this.matrix[3],e=this.matrix[4],f=this.matrix[5],g=this.matrix[6],h=this.matrix[7],k=this.matrix[8],l=this.matrix[9],m=this.matrix[10],p=this.matrix[11],n=this.matrix[12],q=this.matrix[13],r=this.matrix[14],t=this.matrix[15],v=a*f-b*e,w=a*g-c*e,u=a*h-d*e,z=b*g-c*f,x=b*h-d*f,y=c*h-d*g,A=k*q-l*n,C=k*r-m*n,B=k*t-p*n,D=l*r-m*q,E=l*t-p*q,G=m*t-p*r,F=v*G-w*E+u*D+z*B-x*C+y*A;return OV.IsEqual(F,0)?null:new OV.Matrix([(f*
G-g*E+h*D)/F,(c*E-b*G-d*D)/F,(q*y-r*x+t*z)/F,(m*x-l*y-p*z)/F,(g*B-e*G-h*C)/F,(a*G-c*B+d*C)/F,(r*u-n*y-t*w)/F,(k*y-m*u+p*w)/F,(e*E-f*B+h*A)/F,(b*B-a*E-d*A)/F,(n*x-q*u+t*v)/F,(l*u-k*x-p*v)/F,(f*C-e*D-g*A)/F,(a*D-b*C+c*A)/F,(q*w-n*z-r*v)/F,(k*z-l*w+m*v)/F])};
OV.Matrix.prototype.MultiplyVector=function(a){var b=a[0],c=a[1],d=a[2];a=a[3];return[b*this.matrix[0]+c*this.matrix[4]+d*this.matrix[8]+a*this.matrix[12],b*this.matrix[1]+c*this.matrix[5]+d*this.matrix[9]+a*this.matrix[13],b*this.matrix[2]+c*this.matrix[6]+d*this.matrix[10]+a*this.matrix[14],b*this.matrix[3]+c*this.matrix[7]+d*this.matrix[11]+a*this.matrix[15]]};
OV.Matrix.prototype.MultiplyMatrix=function(a){var b=this.matrix[0],c=this.matrix[1],d=this.matrix[2],e=this.matrix[3],f=this.matrix[4],g=this.matrix[5],h=this.matrix[6],k=this.matrix[7],l=this.matrix[8],m=this.matrix[9],p=this.matrix[10],n=this.matrix[11],q=this.matrix[12],r=this.matrix[13],t=this.matrix[14],v=this.matrix[15],w=a.matrix[0],u=a.matrix[1],z=a.matrix[2],x=a.matrix[3],y=a.matrix[4],A=a.matrix[5],C=a.matrix[6],B=a.matrix[7],D=a.matrix[8],E=a.matrix[9],G=a.matrix[10],F=a.matrix[11],H=
a.matrix[12],J=a.matrix[13],I=a.matrix[14];a=a.matrix[15];return new OV.Matrix([b*w+c*y+d*D+e*H,b*u+c*A+d*E+e*J,b*z+c*C+d*G+e*I,b*x+c*B+d*F+e*a,f*w+g*y+h*D+k*H,f*u+g*A+h*E+k*J,f*z+g*C+h*G+k*I,f*x+g*B+h*F+k*a,l*w+m*y+p*D+n*H,l*u+m*A+p*E+n*J,l*z+m*C+p*G+n*I,l*x+m*B+p*F+n*a,q*w+r*y+t*D+v*H,q*u+r*A+t*E+v*J,q*z+r*C+t*G+v*I,q*x+r*B+t*F+v*a])};OV.Transformation=function(a){void 0!==a&&null!==a?this.matrix=a:(this.matrix=new OV.Matrix,this.matrix.CreateIdentity())};OV.Transformation.prototype.SetMatrix=function(a){this.matrix=a;return this};OV.Transformation.prototype.GetMatrix=function(){return this.matrix};OV.Transformation.prototype.IsIdentity=function(){return this.matrix.IsIdentity()};OV.Transformation.prototype.AppendMatrix=function(a){this.matrix=this.matrix.MultiplyMatrix(a);return this};
OV.Transformation.prototype.TransformCoord3D=function(a){a=this.matrix.MultiplyVector([a.x,a.y,a.z,1]);return new OV.Coord3D(a[0],a[1],a[2])};OV.BezierTweenFunction=function(a,b,c){b/=c;return a*b*b*(3-2*b)};OV.LinearTweenFunction=function(a,b,c){return b*a/c};OV.ParabolicTweenFunction=function(a,b,c){b/=c;c=b*b;return c/(2*(c-b)+1)*a};OV.TweenCoord3D=function(a,b,c,d){var e=OV.SubCoord3D(b,a).Normalize();b=OV.CoordDistance3D(a,b);for(var f=[],g=0;g<c;g++){var h=d(b,g,c-1);f.push(a.Clone().Offset(e,h))}return f};OV.BinaryReader=function(a,b){this.arrayBuffer=a;this.dataView=new DataView(a);this.isLittleEndian=b;this.position=0};OV.BinaryReader.prototype.GetPosition=function(){return this.position};OV.BinaryReader.prototype.SetPosition=function(a){this.position=a};OV.BinaryReader.prototype.GetByteLength=function(){return this.arrayBuffer.byteLength};OV.BinaryReader.prototype.Skip=function(a){this.position+=a};OV.BinaryReader.prototype.End=function(){return this.position>=this.arrayBuffer.byteLength};
OV.BinaryReader.prototype.ReadArrayBuffer=function(a){var b=new Uint8Array(this.arrayBuffer),c=new ArrayBuffer(a),d=new Uint8Array(c);b=b.subarray(this.position,this.position+a);d.set(b,0);this.position+=a;return c};OV.BinaryReader.prototype.ReadBoolean8=function(){var a=this.dataView.getInt8(this.position);this.position+=1;return a?!0:!1};OV.BinaryReader.prototype.ReadCharacter8=function(){var a=this.dataView.getInt8(this.position);this.position+=1;return a};
OV.BinaryReader.prototype.ReadUnsignedCharacter8=function(){var a=this.dataView.getUint8(this.position);this.position+=1;return a};OV.BinaryReader.prototype.ReadInteger16=function(){var a=this.dataView.getInt16(this.position,this.isLittleEndian);this.position+=2;return a};OV.BinaryReader.prototype.ReadUnsignedInteger16=function(){var a=this.dataView.getUint16(this.position,this.isLittleEndian);this.position+=2;return a};
OV.BinaryReader.prototype.ReadInteger32=function(){var a=this.dataView.getInt32(this.position,this.isLittleEndian);this.position+=4;return a};OV.BinaryReader.prototype.ReadUnsignedInteger32=function(){var a=this.dataView.getUint32(this.position,this.isLittleEndian);this.position+=4;return a};OV.BinaryReader.prototype.ReadFloat32=function(){var a=this.dataView.getFloat32(this.position,this.isLittleEndian);this.position+=4;return a};
OV.BinaryReader.prototype.ReadDouble64=function(){var a=this.dataView.getFloat64(this.position,this.isLittleEndian);this.position+=8;return a};OV.BinaryWriter=function(a,b){this.arrayBuffer=new ArrayBuffer(a);this.dataView=new DataView(this.arrayBuffer);this.isLittleEndian=b;this.position=0};OV.BinaryWriter.prototype.GetPosition=function(){return this.position};OV.BinaryWriter.prototype.SetPosition=function(a){this.position=a};OV.BinaryWriter.prototype.End=function(){return this.position>=this.arrayBuffer.byteLength};OV.BinaryWriter.prototype.GetBuffer=function(){return this.arrayBuffer};
OV.BinaryWriter.prototype.WriteArrayBuffer=function(a){var b=new Uint8Array(a);(new Uint8Array(this.arrayBuffer)).set(b,this.position);this.position+=a.byteLength};OV.BinaryWriter.prototype.WriteBoolean8=function(a){this.dataView.setInt8(this.position,a?1:0);this.position+=1};OV.BinaryWriter.prototype.WriteCharacter8=function(a){this.dataView.setInt8(this.position,a);this.position+=1};
OV.BinaryWriter.prototype.WriteUnsignedCharacter8=function(a){this.dataView.setUint8(this.position,a);this.position+=1};OV.BinaryWriter.prototype.WriteInteger16=function(a){this.dataView.setInt16(this.position,a,this.isLittleEndian);this.position+=2};OV.BinaryWriter.prototype.WriteUnsignedInteger16=function(a){this.dataView.setUint16(this.position,a,this.isLittleEndian);this.position+=2};
OV.BinaryWriter.prototype.WriteInteger32=function(a){this.dataView.setInt32(this.position,a,this.isLittleEndian);this.position+=4};OV.BinaryWriter.prototype.WriteUnsignedInteger32=function(a){this.dataView.setUint32(this.position,a,this.isLittleEndian);this.position+=4};OV.BinaryWriter.prototype.WriteFloat32=function(a){this.dataView.setFloat32(this.position,a,this.isLittleEndian);this.position+=4};
OV.BinaryWriter.prototype.WriteDouble64=function(a){this.dataView.setFloat64(this.position,a,this.isLittleEndian);this.position+=8};OV.TextWriter=function(){this.text="";this.indentation=0};OV.TextWriter.prototype.GetText=function(){return this.text};OV.TextWriter.prototype.Indent=function(a){this.indentation+=a};OV.TextWriter.prototype.WriteArrayLine=function(a){this.WriteLine(a.join(" "))};OV.TextWriter.prototype.WriteLine=function(a){this.WriteIndentation();this.Write(a+"\n")};OV.TextWriter.prototype.WriteIndentation=function(){for(var a=0;a<this.indentation;a++)this.Write("  ")};
OV.TextWriter.prototype.Write=function(a){this.text+=a};OV.ArrayBufferToUtf8String=function(a){return(new TextDecoder("utf-8")).decode(a)};OV.ArrayBufferToAsciiString=function(a){var b="";a=new Uint8Array(a);for(var c=0;c<a.byteLength;c++)b+=String.fromCharCode(a[c]);return b};OV.AsciiStringToArrayBuffer=function(a){for(var b=new ArrayBuffer(a.length),c=new Uint8Array(b),d=0;d<a.length;d++)c[d]=a.charCodeAt(d);return b};OV.Utf8StringToArrayBuffer=function(a){return(new TextEncoder).encode(a)};
OV.Base64DataURIToArrayBuffer=function(a){if(!a.startsWith("data:"))return null;var b=a.indexOf(";");if(-1===b)return null;var c=a.indexOf(",");if(-1===c)return null;b=a.substr(5,b-5);a=atob(a.substr(c+1));c=new ArrayBuffer(a.length);for(var d=new Uint8Array(c),e=0;e<a.length;e++)d[e]=a.charCodeAt(e);return{mimeType:b,buffer:c}};OV.CreateObjectUrl=function(a){a=new Blob([a]);return URL.createObjectURL(a)};OV.CreateObjectUrlWithMimeType=function(a,b){a=new Blob([a],{type:b});return URL.createObjectURL(a)};
OV.RevokeObjectUrl=function(a){URL.revokeObjectURL(a)};OV.FileSource={Url:1,File:2};OV.FileFormat={Text:1,Binary:2};OV.GetFileName=function(a){var b=a.lastIndexOf("/");-1===b&&(b=a.lastIndexOf("\\"));var c=a;-1!==b&&(c=a.substr(b+1));return decodeURI(c)};OV.GetFileExtension=function(a){var b=a.lastIndexOf(".");return-1===b?"":a.substr(b+1)};
OV.RequestUrl=function(a,b,c){function d(){c.error&&c.error();c.complete&&c.complete()}var e=new XMLHttpRequest;e.open("GET",a,!0);if(b===OV.FileFormat.Text)e.responseType="text";else if(b===OV.FileFormat.Binary)e.responseType="arraybuffer";else{d();return}e.onload=function(){if(200===e.status){var f=e.response;c.success&&c.success(f);c.complete&&c.complete()}else d()};e.onerror=function(){d()};e.send(null)};
OV.ReadFile=function(a,b,c){function d(){c.error&&c.error();c.complete&&c.complete()}var e=new FileReader;e.onloadend=function(f){f.target.readyState===FileReader.DONE&&(c.success&&c.success(f.target.result),c.complete&&c.complete())};e.onerror=function(){d()};b===OV.FileFormat.Text?e.readAsText(a):b===OV.FileFormat.Binary?e.readAsArrayBuffer(a):d()};OV.Color=function(a,b,c){this.r=a;this.g=b;this.b=c};OV.Color.prototype.Set=function(a,b,c){this.r=a;this.g=b;this.b=c};OV.Color.prototype.Clone=function(){return new OV.Color(this.r,this.g,this.b)};OV.TextureMap=function(){this.buffer=this.url=this.name=null;this.offset=new OV.Coord2D(0,0);this.scale=new OV.Coord2D(1,1);this.rotation=0};OV.TextureMap.prototype.IsValid=function(){return null!==this.name&&null!==this.url&&null!==this.buffer};
OV.TextureMap.prototype.HasTransformation=function(){return OV.CoordIsEqual2D(this.offset,new OV.Coord2D(0,0))&&OV.CoordIsEqual2D(this.scale,new OV.Coord2D(1,1))&&OV.IsEqual(this.rotation,0)?!1:!0};OV.TextureMap.prototype.Clone=function(){var a=new OV.TextureMap;a.name=this.name;a.url=this.url;a.buffer=this.buffer;a.offset=this.offset.Clone();a.scale=this.scale.Clone();a.rotation=this.rotation;return a};
OV.Material=function(){this.name="";this.ambient=new OV.Color(0,0,0);this.diffuse=new OV.Color(0,0,0);this.specular=new OV.Color(0,0,0);this.emissive=new OV.Color(0,0,0);this.shininess=0;this.opacity=1;this.emissiveMap=this.normalMap=this.bumpMap=this.specularMap=this.diffuseMap=null;this.alphaTest=0;this.multiplyDiffuseMap=this.transparent=!1};
OV.Material.prototype.EnumerateTextureMaps=function(a){null!==this.diffuseMap&&a(this.diffuseMap);null!==this.specularMap&&a(this.specularMap);null!==this.bumpMap&&a(this.bumpMap);null!==this.normalMap&&a(this.normalMap);null!==this.emissiveMap&&a(this.emissiveMap)};
OV.Material.prototype.Clone=function(){var a=new OV.Material;a.name=this.name;a.ambient=this.ambient.Clone();a.diffuse=this.diffuse.Clone();a.specular=this.specular.Clone();a.emissive=this.emissive.Clone();a.shininess=this.shininess;a.opacity=this.opacity;a.diffuseMap=this.CloneTextureMap(this.diffuseMap);a.specularMap=this.CloneTextureMap(this.specularMap);a.bumpMap=this.CloneTextureMap(this.bumpMap);a.normalMap=this.CloneTextureMap(this.normalMap);a.emissiveMap=this.CloneTextureMap(this.emissiveMap);
a.alphaTest=this.alphaTest;a.transparent=this.transparent;a.multiplyDiffuseMap=this.multiplyDiffuseMap;return a};OV.Material.prototype.CloneTextureMap=function(a){return null===a?null:a.Clone()};OV.SRGBToLinear=function(a){return.04045>a?.0773993808*a:Math.pow(.9478672986*a+.0521327014,2.4)};OV.LinearToSRGB=function(a){return.0031308>a?12.92*a:1.055*Math.pow(a,.41666)-.055};OV.IntegerToHexString=function(a){for(a=parseInt(a,10).toString(16);2>a.length;)a="0"+a;return a};
OV.ColorToHexString=function(a){var b=OV.IntegerToHexString(a.r),c=OV.IntegerToHexString(a.g);a=OV.IntegerToHexString(a.b);return b+c+a};OV.HexStringToColor=function(a){if(6!==a.length)return null;var b=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16);a=parseInt(a.substr(4,2),16);return new OV.Color(b,c,a)};OV.ColorIsEqual=function(a,b){return a.r===b.r&&a.g===b.g&&a.b===b.b};OV.ArrayToColor=function(a){return new OV.Color(a[0],a[1],a[2])};OV.Triangle=function(a,b,c){this.v0=a;this.v1=b;this.v2=c;this.curve=this.mat=this.u2=this.u1=this.u0=this.n2=this.n1=this.n0=null};OV.Triangle.prototype.HasVertices=function(){return null!==this.v0&&null!==this.v1&&null!==this.v2};OV.Triangle.prototype.HasNormals=function(){return null!==this.n0&&null!==this.n1&&null!==this.n2};OV.Triangle.prototype.HasTextureUVs=function(){return null!==this.u0&&null!==this.u1&&null!==this.u2};
OV.Triangle.prototype.SetVertices=function(a,b,c){this.v0=a;this.v1=b;this.v2=c;return this};OV.Triangle.prototype.SetNormals=function(a,b,c){this.n0=a;this.n1=b;this.n2=c;return this};OV.Triangle.prototype.SetTextureUVs=function(a,b,c){this.u0=a;this.u1=b;this.u2=c;return this};OV.Triangle.prototype.SetMaterial=function(a){this.mat=a;return this};OV.Triangle.prototype.SetCurve=function(a){this.curve=a;return this};
OV.Triangle.prototype.Clone=function(){var a=new OV.Triangle(this.v0,this.v1,this.v2);a.SetNormals(this.n0,this.n1,this.n2);a.SetTextureUVs(this.u0,this.u1,this.u2);a.SetMaterial(this.mat);a.SetCurve(this.curve);return a};OV.Element=function(){this.name=""};OV.Element.prototype.GetName=function(){return this.name};OV.Element.prototype.SetName=function(a){this.name=a};OV.Element.prototype.VertexCount=function(){return 0};OV.Element.prototype.NormalCount=function(){return 0};OV.Element.prototype.TextureUVCount=function(){return 0};OV.Element.prototype.TriangleCount=function(){return 0};OV.Element.prototype.EnumerateVertices=function(a){};OV.Element.prototype.EnumerateTriangles=function(a){};OV.Mesh=function(){OV.Element.call(this);this.vertices=[];this.normals=[];this.uvs=[];this.triangles=[]};$jscomp.inherits(OV.Mesh,OV.Element);OV.Mesh.prototype.VertexCount=function(){return this.vertices.length};OV.Mesh.prototype.NormalCount=function(){return this.normals.length};OV.Mesh.prototype.TextureUVCount=function(){return this.uvs.length};OV.Mesh.prototype.TriangleCount=function(){return this.triangles.length};
OV.Mesh.prototype.AddVertex=function(a){this.vertices.push(a);return this.vertices.length-1};OV.Mesh.prototype.SetVertex=function(a,b){this.vertices[a]=b};OV.Mesh.prototype.GetVertex=function(a){return this.vertices[a]};OV.Mesh.prototype.AddNormal=function(a){this.normals.push(a);return this.normals.length-1};OV.Mesh.prototype.SetNormal=function(a,b){this.normals[a]=b};OV.Mesh.prototype.GetNormal=function(a){return this.normals[a]};
OV.Mesh.prototype.AddTextureUV=function(a){this.uvs.push(a);return this.uvs.length-1};OV.Mesh.prototype.SetTextureUV=function(a,b){this.uvs[a]=b};OV.Mesh.prototype.GetTextureUV=function(a){return this.uvs[a]};OV.Mesh.prototype.AddTriangle=function(a){this.triangles.push(a);return this.triangles.length-1};OV.Mesh.prototype.GetTriangle=function(a){return this.triangles[a]};OV.Mesh.prototype.EnumerateVertices=function(a){for(var b=0;b<this.vertices.length;b++)a(this.vertices[b])};
OV.Mesh.prototype.EnumerateTriangles=function(a){for(var b=0;b<this.triangles.length;b++){var c=this.triangles[b];a(this.vertices[c.v0],this.vertices[c.v1],this.vertices[c.v2])}};OV.MeshPrimitiveBuffer=function(){this.indices=[];this.vertices=[];this.normals=[];this.uvs=[];this.material=null};OV.MeshPrimitiveBuffer.prototype.GetBounds=function(){for(var a=[Infinity,Infinity,Infinity],b=[-Infinity,-Infinity,-Infinity],c=0;c<this.vertices.length/3;c++)for(var d=0;3>d;d++)a[d]=Math.min(a[d],this.vertices[3*c+d]),b[d]=Math.max(b[d],this.vertices[3*c+d]);return{min:a,max:b}};
OV.MeshPrimitiveBuffer.prototype.GetByteLength=function(a,b){return this.indices.length*a+(this.vertices.length+this.normals.length+this.uvs.length)*b};OV.MeshBuffer=function(){this.primitives=[]};OV.MeshBuffer.prototype.PrimitiveCount=function(){return this.primitives.length};OV.MeshBuffer.prototype.GetPrimitive=function(a){return this.primitives[a]};OV.MeshBuffer.prototype.GetByteLength=function(a,b){for(var c=0,d=0;d<this.primitives.length;d++)c+=this.primitives[d].GetByteLength(a,b);return c};
OV.ConvertMeshToMeshBuffer=function(a){function b(k,l,m,p,n,q){function r(w,u,z,x,y){var A=0<w.TextureUVCount();u=w.GetVertex(u);z=w.GetNormal(z);var C=y.vertices.length/3;y.indices.push(C);y.vertices.push(u.x,u.y,u.z);y.normals.push(z.x,z.y,z.z);w=null!==x?w.GetTextureUV(x):A?new OV.Coord2D(0,0):null;null!==w&&y.uvs.push(w.x,w.y);return{index:C,normal:z,uv:w}}function t(w,u,z,x){for(var y=0;y<u.length;y++){var A=u[y],C=w.GetNormal(z);C=OV.CoordIsEqual3D(A.normal,C);if(null===A.uv&&null===x)var B=
!0;else B=null!==x?w.GetTextureUV(x):new OV.Coord2D(0,0),B=OV.CoordIsEqual2D(A.uv,B);if(C&&B)return A}return null}var v=q[l];void 0===v?(v=r(k,l,m,p,n),q[l]=[v]):(q=t(k,v,m,p),null!==q?n.indices.push(q.index):(l=r(k,l,m,p,n),v.push(l)))}var c=new OV.MeshBuffer,d=a.TriangleCount();if(0===d)return null;for(var e=[],f=0;f<d;f++)e.push(f);e.sort(function(k,l){k=a.GetTriangle(k);l=a.GetTriangle(l);return k.mat-l.mat});f=d=null;for(var g=0;g<e.length;g++){var h=a.GetTriangle(e[g]);if(null===d||d.material!==
h.mat)d=new OV.MeshPrimitiveBuffer,d.material=h.mat,f={},c.primitives.push(d);b(a,h.v0,h.n0,h.u0,d,f);b(a,h.v1,h.n1,h.u1,d,f);b(a,h.v2,h.n2,h.u2,d,f)}return c};OV.Model=function(){OV.Element.call(this);this.materials=[];this.meshes=[]};$jscomp.inherits(OV.Model,OV.Element);OV.Model.prototype.MaterialCount=function(){return this.materials.length};OV.Model.prototype.MeshCount=function(){return this.meshes.length};OV.Model.prototype.VertexCount=function(){for(var a=0,b=0;b<this.meshes.length;b++)a+=this.meshes[b].VertexCount();return a};OV.Model.prototype.NormalCount=function(){for(var a=0,b=0;b<this.meshes.length;b++)a+=this.meshes[b].NormalCount();return a};
OV.Model.prototype.TextureUVCount=function(){for(var a=0,b=0;b<this.meshes.length;b++)a+=this.meshes[b].TextureUVCount();return a};OV.Model.prototype.TriangleCount=function(){for(var a=0,b=0;b<this.meshes.length;b++)a+=this.meshes[b].TriangleCount();return a};OV.Model.prototype.AddMaterial=function(a){this.materials.push(a);return this.materials.length-1};OV.Model.prototype.GetMaterial=function(a){return this.materials[a]};
OV.Model.prototype.AddMesh=function(a){this.meshes.push(a);return this.meshes.length-1};OV.Model.prototype.AddMeshToIndex=function(a,b){this.meshes.splice(b,0,a);return b};OV.Model.prototype.RemoveMesh=function(a){this.meshes.splice(a,1)};OV.Model.prototype.GetMesh=function(a){return this.meshes[a]};OV.Model.prototype.EnumerateVertices=function(a){for(var b=0;b<this.meshes.length;b++)this.meshes[b].EnumerateVertices(a)};OV.Model.prototype.EnumerateTriangles=function(a){for(var b=0;b<this.meshes.length;b++)this.meshes[b].EnumerateTriangles(a)};OV.TopologyVertex=function(){this.edges=[];this.triangles=[]};OV.TopologyEdge=function(a,b){this.vertex1=a;this.vertex2=b;this.triangles=[]};OV.TopologyTriangleEdge=function(a,b){this.edge=a;this.reversed=b};OV.TopologyTriangle=function(){this.triEdge3=this.triEdge2=this.triEdge1=null};OV.Topology=function(){this.vertices=[];this.edges=[];this.triangleEdges=[];this.triangles=[];this.edgeStartToEndVertexMap={}};
OV.Topology.prototype.AddVertex=function(){this.vertices.push(new OV.TopologyVertex);return this.vertices.length-1};
OV.Topology.prototype.AddTriangle=function(a,b,c){var d=this.triangles.length,e=new OV.TopologyTriangle;e.triEdge1=this.AddTriangleEdge(a,b);e.triEdge2=this.AddTriangleEdge(b,c);e.triEdge3=this.AddTriangleEdge(c,a);this.vertices[a].triangles.push(d);this.vertices[b].triangles.push(d);this.vertices[c].triangles.push(d);this.vertices[a].edges.push(this.triangleEdges[e.triEdge1].edge);this.vertices[b].edges.push(this.triangleEdges[e.triEdge2].edge);this.vertices[c].edges.push(this.triangleEdges[e.triEdge3].edge);
this.edges[this.triangleEdges[e.triEdge1].edge].triangles.push(d);this.edges[this.triangleEdges[e.triEdge2].edge].triangles.push(d);this.edges[this.triangleEdges[e.triEdge3].edge].triangles.push(d);this.triangles.push(e)};OV.Topology.prototype.AddTriangleEdge=function(a,b){var c=a,d=b,e=!1;b<a&&(c=b,d=a,e=!0);a=this.AddEdge(c,d);this.triangleEdges.push(new OV.TopologyTriangleEdge(a,e));return this.triangleEdges.length-1};
OV.Topology.prototype.AddEdge=function(a,b){void 0===this.edgeStartToEndVertexMap[a]&&(this.edgeStartToEndVertexMap[a]=[]);for(var c=this.edgeStartToEndVertexMap[a],d=0;d<c.length;d++){var e=c[d];if(e.endVertex===b)return e.edgeIndex}d=this.edges.length;c.push({endVertex:b,edgeIndex:d});this.edges.push(new OV.TopologyEdge(a,b));return d};OV.CalculateTriangleNormal=function(a,b,c){b=OV.SubCoord3D(b,a);a=OV.SubCoord3D(c,a);a=OV.CrossVector3D(b,a);a.Normalize();return a};
OV.TransformMesh=function(a,b){if(!b.IsIdentity()){for(var c=0;c<a.VertexCount();c++){var d=a.GetVertex(c),e=b.TransformCoord3D(d);d.x=e.x;d.y=e.y;d.z=e.z}if(0<a.NormalCount())for(b=b.GetMatrix().DecomposeTRS(),b=(new OV.Matrix).ComposeTRS(new OV.Coord3D(0,0,0),b.rotation,new OV.Coord3D(1,1,1)),b=new OV.Transformation(b),c=0;c<a.NormalCount();c++)d=a.GetNormal(c),e=b.TransformCoord3D(d),d.x=e.x,d.y=e.y,d.z=e.z}};
OV.FlipMeshTrianglesOrientation=function(a){for(var b=0;b<a.TriangleCount();b++){var c=a.GetTriangle(b),d=c.v1;c.v1=c.v2;c.v2=d}};OV.IsModelEmpty=function(a){for(var b=0;b<a.MeshCount();b++)if(0<a.GetMesh(b).TriangleCount())return!1;return!0};
OV.CloneMesh=function(a){var b=new OV.Mesh;b.SetName(a.GetName());for(var c=0;c<a.VertexCount();c++){var d=a.GetVertex(c);b.AddVertex(d.Clone())}for(c=0;c<a.NormalCount();c++)d=a.GetNormal(c),b.AddNormal(d.Clone());for(c=0;c<a.TextureUVCount();c++)d=a.GetTextureUV(c),b.AddTextureUV(d.Clone());for(c=0;c<a.TriangleCount();c++)d=a.GetTriangle(c),b.AddTriangle(d.Clone());return b};
OV.CreateMergedModel=function(a){var b=new OV.Model;b.SetName(a.GetName());for(var c=0;c<a.MaterialCount();c++){var d=a.GetMaterial(c);b.AddMaterial(d.Clone())}c=new OV.Mesh;for(d=0;d<a.MeshCount();d++){for(var e=a.GetMesh(d),f=c,g=f.VertexCount(),h=f.NormalCount(),k=f.TextureUVCount(),l=0;l<e.VertexCount();l++){var m=e.GetVertex(l);f.AddVertex(m.Clone())}for(l=0;l<e.NormalCount();l++)m=e.GetNormal(l),f.AddNormal(m.Clone());for(l=0;l<e.TextureUVCount();l++)m=e.GetTextureUV(l),f.AddTextureUV(m.Clone());
for(l=0;l<e.TriangleCount();l++){m=e.GetTriangle(l);var p=m.Clone();p.SetVertices(m.v0+g,m.v1+g,m.v2+g);p.SetNormals(m.n0+h,m.n1+h,m.n2+h);p.HasTextureUVs()&&p.SetTextureUVs(m.u0+k,m.u1+k,m.u2+k);f.AddTriangle(p)}}b.AddMesh(c);return b};
OV.EnumerateModelVerticesAndTriangles=function(a,b){for(var c=0;c<a.MeshCount();c++)for(var d=a.GetMesh(c),e=0;e<d.VertexCount();e++){var f=d.GetVertex(e);b.onVertex(f.x,f.y,f.z)}for(d=c=0;d<a.MeshCount();d++){e=a.GetMesh(d);for(f=0;f<e.TriangleCount();f++){var g=e.GetTriangle(f);b.onTriangle(g.v0+c,g.v1+c,g.v2+c)}c+=e.VertexCount()}};OV.EnumerateTrianglesWithNormals=function(a,b){a.EnumerateTriangles(function(c,d,e){var f=OV.CalculateTriangleNormal(c,d,e);b(c,d,e,f)})};
OV.GetBoundingBox=function(a){var b=new OV.BoundingBoxCalculator3D;a.EnumerateVertices(function(c){b.AddPoint(c)});return b.GetBox()};OV.GetTopology=function(a){function b(f,g,h){var k=g.FindPoint(f);null===k&&(k=h.AddVertex(),g.AddPoint(f,k));return k}var c=OV.GetBoundingBox(a),d=new OV.Octree(c),e=new OV.Topology;a.EnumerateTriangles(function(f,g,h){f=b(f,d,e);g=b(g,d,e);h=b(h,d,e);e.AddTriangle(f,g,h)});return e};
OV.IsSolid=function(a){a=OV.GetTopology(a);for(var b=0;b<a.edges.length;b++){var c=a.edges[b],d=c.triangles.length;if(0===d||0!==d%2)return!1;for(var e=d=0;e<c.triangles.length;e++){var f=a.triangles[c.triangles[e]];var g=a.triangleEdges[f.triEdge1];var h=a.triangleEdges[f.triEdge2];f=a.triangleEdges[f.triEdge3];g=g.edge===b?g.reversed:h.edge===b?h.reversed:f.edge===b?f.reversed:null;d=g?d+1:d-1}if(0!==d)return!1}return!0};OV.FinalizeModel=function(a,b){function c(h,k){function l(q){function r(A,C,B,D,E){var G=[];B=E[B];for(E=0;E<B.length;E++){var F=B[E],H=A.GetTriangle(F);if(C.curve===H.curve){F=D[F];a:{H=G;for(var J=F,I=0;I<H.length;I++)if(OV.CoordIsEqual3D(H[I],J)){H=!0;break a}H=!1}H||G.push(F)}}C=new OV.Coord3D(0,0,0);for(D=0;D<G.length;D++)C=OV.AddCoord3D(C,G[D]);C.MultiplyScalar(1/G.length);C.Normalize();return A.AddNormal(C)}for(var t=[],v={},w=0;w<q.VertexCount();w++)v[w]=[];for(w=0;w<q.TriangleCount();w++){var u=
q.GetTriangle(w),z=q.GetVertex(u.v0),x=q.GetVertex(u.v1),y=q.GetVertex(u.v2);z=OV.CalculateTriangleNormal(z,x,y);t.push(z);v[u.v0].push(w);v[u.v1].push(w);v[u.v2].push(w)}for(w=0;w<q.TriangleCount();w++)u=q.GetTriangle(w),u.HasNormals()||(z=r(q,u,u.v0,t,v),x=r(q,u,u.v1,t,v),y=r(q,u,u.v2,t,v),u.SetNormals(z,x,y))}function m(q,r,t){if(!r.HasNormals())if(null===r.curve||0===r.curve){var v=q.GetVertex(r.v0),w=q.GetVertex(r.v1),u=q.GetVertex(r.v2);v=OV.CalculateTriangleNormal(v,w,u);q=q.AddNormal(v);r.SetNormals(q,
q,q)}else t.calculateCurveNormals=!0;null===r.mat&&(r.mat=t.getDefaultMaterialIndex());null===r.curve&&(r.curve=0)}k={getDefaultMaterialIndex:k,calculateCurveNormals:!1};for(var p=0;p<h.TriangleCount();p++){var n=h.GetTriangle(p);m(h,n,k)}k.calculateCurveNormals&&l(h)}for(var d=null,e=function(){null===d&&(d=a.AddMaterial(b()));return d},f=0;f<a.MeshCount();f++){var g=a.GetMesh(f);0===g.TriangleCount()?(a.RemoveMesh(f),--f):c(g,e)}};
OV.CheckModel=function(a){function b(g){return void 0===g||null===g||isNaN(g)?!1:!0}function c(g,h){return!b(g)||0>g||g>=h?!1:!0}function d(g,h){for(var k=0;k<h.VertexCount();k++){var l=h.GetVertex(k);if(!b(l.x)||!b(l.y)||!b(l.z))return!1}for(k=0;k<h.NormalCount();k++)if(l=h.GetNormal(k),!b(l.x)||!b(l.y)||!b(l.z))return!1;for(k=0;k<h.TextureUVCount();k++)if(l=h.GetTextureUV(k),!b(l.x)||!b(l.y))return!1;for(k=0;k<h.TriangleCount();k++){var m=h.GetTriangle(k);l=g;var p=h;if(!(c(m.v0,p.VertexCount())&&
c(m.v1,p.VertexCount())&&c(m.v2,p.VertexCount())&&c(m.n0,p.NormalCount())&&c(m.n1,p.NormalCount())&&c(m.n2,p.NormalCount())&&(!m.HasTextureUVs()||c(m.u0,p.TextureUVCount())&&c(m.u1,p.TextureUVCount())&&c(m.u2,p.TextureUVCount()))&&c(m.mat,l.MaterialCount())&&b(m.curve)))return!1}return!0}for(var e=0;e<a.MeshCount();e++){var f=a.GetMesh(e);if(!d(a,f))return!1}return!0};OV.GetTriangleArea=function(a,b,c){var d=OV.CoordDistance3D(a,b);b=OV.CoordDistance3D(b,c);a=OV.CoordDistance3D(a,c);c=(d+b+a)/2;d=c*(c-d)*(c-b)*(c-a);return 0>d?0:Math.sqrt(d)};OV.GetTetrahedronSignedVolume=function(a,b,c){return OV.DotVector3D(a,OV.CrossVector3D(b,c))/6};OV.CalculateVolume=function(a){if(!OV.IsSolid(a))return null;var b=0;a.EnumerateTriangles(function(c,d,e){b+=OV.GetTetrahedronSignedVolume(c,d,e)});return b};
OV.CalculateSurfaceArea=function(a){var b=0;a.EnumerateTriangles(function(c,d,e){b+=OV.GetTriangleArea(c,d,e)});return b};OV.GeneratorParams=function(){this.transformation=this.material=this.name=null};OV.GeneratorParams.prototype.SetName=function(a){this.name=a;return this};OV.GeneratorParams.prototype.SetMaterial=function(a){this.material=a;return this};OV.GeneratorParams.prototype.SetTransformation=function(a,b,c){a=(new OV.Matrix).ComposeTRS(a,b,c);return this.SetTransformationMatrix(a)};OV.GeneratorParams.prototype.SetTransformationMatrix=function(a){this.transformation=new OV.Transformation(a);return this};
OV.Generator=function(a){this.params=a||new OV.GeneratorParams;this.mesh=new OV.Mesh;null!==this.params.name&&this.mesh.SetName(this.params.name)};OV.Generator.prototype.GetMesh=function(){return this.mesh};OV.Generator.prototype.AddVertex=function(a,b,c){a=new OV.Coord3D(a,b,c);null!==this.params.transformation&&(a=this.params.transformation.TransformCoord3D(a));return this.mesh.AddVertex(a)};
OV.Generator.prototype.AddTriangle=function(a,b,c){a=new OV.Triangle(a,b,c);null!==this.params.material&&a.SetMaterial(this.params.material);return this.mesh.AddTriangle(a)};OV.Generator.prototype.AddConvexPolygon=function(a){for(var b=0;b<a.length-2;b++)this.AddTriangle(a[0],a[b+1],a[b+2])};
OV.GenerateCuboid=function(a,b,c,d){a=new OV.Generator(a);a.AddVertex(0,0,0);a.AddVertex(b,0,0);a.AddVertex(b,c,0);a.AddVertex(0,c,0);a.AddVertex(0,0,d);a.AddVertex(b,0,d);a.AddVertex(b,c,d);a.AddVertex(0,c,d);a.AddConvexPolygon([0,3,2,1]);a.AddConvexPolygon([0,1,5,4]);a.AddConvexPolygon([1,2,6,5]);a.AddConvexPolygon([2,3,7,6]);a.AddConvexPolygon([3,0,4,7]);a.AddConvexPolygon([4,5,6,7]);return a.GetMesh()};OV.NameFromLine=function(a,b,c){a=a.substr(b);c=a.indexOf(c);-1!==c&&(a=a.substr(0,c));return a.trim()};OV.ParametersFromLine=function(a,b){null!==b&&(b=a.indexOf(b),-1!==b&&(a=a.substr(0,b).trim()));return a.split(/\s+/u)};OV.ReadLines=function(a,b){for(var c=0,d=a.indexOf("\n",c);-1!==d;){var e=a.substr(c,d-c);c=b;e=e.trim();0<e.length&&c(e);c=d+1;d=a.indexOf("\n",c)}a=a.substr(c).trim();0<a.length&&b(a)};OV.IsPowerOfTwo=function(a){return 0===(a&a-1)};
OV.NextPowerOfTwo=function(a){return OV.IsPowerOfTwo(a)?a:parseInt(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2))),10)};OV.ResizeImageToPowerOfTwoSides=function(a){if(OV.IsPowerOfTwo(a.width)&&OV.IsPowerOfTwo(a.height))return a;var b=OV.NextPowerOfTwo(a.width),c=OV.NextPowerOfTwo(a.height),d=document.createElement("canvas");d.width=b;d.height=c;d=d.getContext("2d");d.drawImage(a,0,0,b,c);return d.getImageData(0,0,b,c)};
OV.UpdateMaterialTransparency=function(a){a.transparent=!1;OV.IsLower(a.opacity,1)&&(a.transparent=!0)};OV.ImporterBase=function(){};OV.ImporterBase.prototype.Import=function(a,b,c){this.Clear();this.extension=b;this.callbacks=c;this.model=new OV.Model;this.error=!1;this.message=null;this.ResetContent();var d=this;this.ImportContent(a,function(){d.CreateResult(c)})};OV.ImporterBase.prototype.Clear=function(){this.message=this.error=this.model=this.callbacks=this.extension=null;this.ClearContent()};
OV.ImporterBase.prototype.CreateResult=function(a){if(this.error)a.onError();else OV.IsModelEmpty(this.model)?(this.error=!0,a.onError()):(OV.FinalizeModel(this.model,this.callbacks.getDefaultMaterial),a.onSuccess());a.onComplete()};OV.ImporterBase.prototype.CanImportExtension=function(a){return!1};OV.ImporterBase.prototype.GetKnownFileFormats=function(){return{}};OV.ImporterBase.prototype.GetUpDirection=function(){return OV.Direction.Z};OV.ImporterBase.prototype.ClearContent=function(){};
OV.ImporterBase.prototype.ResetContent=function(){};OV.ImporterBase.prototype.ImportContent=function(a,b){};OV.ImporterBase.prototype.GetModel=function(){return this.model};OV.ImporterBase.prototype.SetError=function(){this.error=!0};OV.ImporterBase.prototype.IsError=function(){return this.error};OV.ImporterBase.prototype.SetMessage=function(a){this.message=a};OV.ImporterBase.prototype.GetMessage=function(){return this.message};OV.ImporterObj=function(){OV.ImporterBase.call(this)};$jscomp.inherits(OV.ImporterObj,OV.ImporterBase);OV.ImporterObj.prototype.CanImportExtension=function(a){return"obj"===a};OV.ImporterObj.prototype.GetKnownFileFormats=function(){return{obj:OV.FileFormat.Text,mtl:OV.FileFormat.Text}};OV.ImporterObj.prototype.GetUpDirection=function(){return OV.Direction.Y};
OV.ImporterObj.prototype.ClearContent=function(){this.materialNameToIndex=this.meshNameToMeshData=this.currentMaterialIndex=this.currentMaterial=this.currentMeshData=this.currentMesh=this.globalUvs=this.globalNormals=this.globalVertices=null};OV.ImporterObj.prototype.ResetContent=function(){this.globalVertices=[];this.globalNormals=[];this.globalUvs=[];this.currentMaterialIndex=this.currentMaterial=this.currentMeshData=this.currentMesh=null;this.meshNameToMeshData={};this.materialNameToIndex={}};
OV.ImporterObj.prototype.ImportContent=function(a,b){var c=this;OV.ReadLines(a,function(d){c.IsError()||c.ProcessLine(d)});b()};OV.ImporterObj.prototype.ProcessLine=function(a){if("#"!==a[0]){var b=OV.ParametersFromLine(a,"#");if(0!==b.length){var c=b[0].toLowerCase();b.shift();this.ProcessMeshParameter(c,b,a)||this.ProcessMaterialParameter(c,b,a)}}};
OV.ImporterObj.prototype.AddNewMesh=function(a){var b=this.meshNameToMeshData[a];void 0===b&&(b=new OV.Mesh,null!==a&&b.SetName(a),this.model.AddMesh(b),b={mesh:b,data:{globalToCurrentVertices:{},globalToCurrentNormals:{},globalToCurrentUvs:{}}},this.meshNameToMeshData[a]=b);this.currentMesh=b.mesh;this.currentMeshData=b.data};
OV.ImporterObj.prototype.ProcessMeshParameter=function(a,b,c){if("g"===a||"o"===a){if(0===b.length)return!0;a=OV.NameFromLine(c,a.length,"#");this.AddNewMesh(a);return!0}if("v"===a){if(3>b.length)return!0;this.globalVertices.push(new OV.Coord3D(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2])));return!0}if("vn"===a){if(3>b.length)return!0;this.globalNormals.push(new OV.Coord3D(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2])));return!0}if("vt"===a){if(2>b.length)return!0;this.globalUvs.push(new OV.Coord2D(parseFloat(b[0]),
parseFloat(b[1])));return!0}if("f"===a){if(3>b.length)return!0;this.ProcessFace(b);return!0}return!1};
OV.ImporterObj.prototype.ProcessMaterialParameter=function(a,b,c){function d(g){return new OV.Color(parseInt(parseFloat(255*g[0]),10),parseInt(parseFloat(255*g[1]),10),parseInt(parseFloat(255*g[2]),10))}function e(g,h,k){var l=new OV.TextureMap;g=OV.NameFromLine(h,g.length,"#");k=k.getTextureBuffer(g);l.name=g;null!==k&&(l.url=k.url,l.buffer=k.buffer);return l}var f=this;if("newmtl"===a){if(0===b.length)return!0;b=new OV.Material;a=OV.NameFromLine(c,a.length,"#");c=this.model.AddMaterial(b);b.name=
a;this.currentMaterial=b;this.materialNameToIndex[a]=c;return!0}if("usemtl"===a){if(0===b.length)return!0;b=OV.NameFromLine(c,a.length,"#");b=this.materialNameToIndex[b];void 0!==b&&(this.currentMaterialIndex=b);return!0}if("mtllib"===a){if(0===b.length)return!0;b=OV.NameFromLine(c,a.length,"#");b=this.callbacks.getFileBuffer(b);null!==b&&OV.ReadLines(b,function(g){f.IsError()||f.ProcessLine(g)});return!0}if("map_kd"===a){if(null===this.currentMaterial||0===b.length)return!0;this.currentMaterial.diffuseMap=
e(a,c,this.callbacks);OV.UpdateMaterialTransparency(this.currentMaterial);return!0}if("map_ks"===a){if(null===this.currentMaterial||0===b.length)return!0;this.currentMaterial.specularMap=e(a,c,this.callbacks);return!0}if("map_bump"===a||"bump"===a){if(null===this.currentMaterial||0===b.length)return!0;this.currentMaterial.bumpMap=e(a,c,this.callbacks);return!0}if("ka"===a){if(null===this.currentMaterial||3>b.length)return!0;this.currentMaterial.ambient=d(b);return!0}if("kd"===a){if(null===this.currentMaterial||
3>b.length)return!0;this.currentMaterial.diffuse=d(b);return!0}if("ks"===a){if(null===this.currentMaterial||3>b.length)return!0;this.currentMaterial.specular=d(b);return!0}if("ns"===a){if(null===this.currentMaterial||1>b.length)return!0;this.currentMaterial.shininess=parseFloat(b[0])/1E3;return!0}if("tr"===a){if(null===this.currentMaterial||1>b.length)return!0;this.currentMaterial.opacity=1-parseFloat(b[0]);OV.UpdateMaterialTransparency(this.currentMaterial);return!0}if("d"===a){if(null===this.currentMaterial||
1>b.length)return!0;this.currentMaterial.opacity=parseFloat(b[0]);OV.UpdateMaterialTransparency(this.currentMaterial);return!0}return!1};
OV.ImporterObj.prototype.ProcessFace=function(a){function b(q,r){return 0<q?q-1:r+q}function c(q,r,t,v){if(isNaN(t)||0>t||t>=q.length)return null;var w=r[t];if(void 0===w){q=q[t];if(void 0===q)return null;w=v(q);r[t]=w}return w}function d(q,r,t){return c(q.globalVertices,q.currentMeshData.globalToCurrentVertices,t,function(v){return r.AddVertex(new OV.Coord3D(v.x,v.y,v.z))})}function e(q,r,t){return c(q.globalNormals,q.currentMeshData.globalToCurrentNormals,t,function(v){return r.AddNormal(new OV.Coord3D(v.x,
v.y,v.z))})}function f(q,r,t){return c(q.globalUvs,q.currentMeshData.globalToCurrentUvs,t,function(v){return r.AddTextureUV(new OV.Coord2D(v.x,v.y))})}for(var g=[],h=[],k=[],l=0;l<a.length;l++){var m=a[l].split("/");g.push(b(parseInt(m[0],10),this.globalVertices.length));1<m.length&&0<m[1].length&&k.push(b(parseInt(m[1],10),this.globalUvs.length));2<m.length&&0<m[2].length&&h.push(b(parseInt(m[2],10),this.globalNormals.length))}null===this.currentMesh&&this.AddNewMesh("");for(a=0;a<g.length-2;a++){l=
d(this,this.currentMesh,g[0]);m=d(this,this.currentMesh,g[a+1]);var p=d(this,this.currentMesh,g[a+2]);if(null===l||null===m||null===p){this.SetError();this.SetMessage("Invalid vertex index.");break}l=new OV.Triangle(l,m,p);if(h.length===g.length){m=e(this,this.currentMesh,h[0]);p=e(this,this.currentMesh,h[a+1]);var n=e(this,this.currentMesh,h[a+2]);if(null===m||null===p||null===n){this.SetError();this.SetMessage("Invalid normal index.");break}l.SetNormals(m,p,n)}if(k.length===g.length){m=f(this,this.currentMesh,
k[0]);p=f(this,this.currentMesh,k[a+1]);n=f(this,this.currentMesh,k[a+2]);if(null===m||null===p||null===n){this.SetError();this.SetMessage("Invalid uv index.");break}l.SetTextureUVs(m,p,n)}null!==this.currentMaterialIndex&&(l.mat=this.currentMaterialIndex);this.currentMesh.AddTriangle(l)}};OV.ImporterStl=function(){OV.ImporterBase.call(this)};$jscomp.inherits(OV.ImporterStl,OV.ImporterBase);OV.ImporterStl.prototype.CanImportExtension=function(a){return"stl"===a};OV.ImporterStl.prototype.GetKnownFileFormats=function(){return{stl:OV.FileFormat.Binary}};OV.ImporterStl.prototype.GetUpDirection=function(){return OV.Direction.Z};OV.ImporterStl.prototype.ClearContent=function(){this.triangle=this.mesh=null};
OV.ImporterStl.prototype.ResetContent=function(){this.mesh=new OV.Mesh;this.model.AddMesh(this.mesh);this.triangle=null};OV.ImporterStl.prototype.ImportContent=function(a,b){if(this.IsBinaryStlFile(a))this.ProcessBinary(a);else{var c=this;a=OV.ArrayBufferToUtf8String(a);OV.ReadLines(a,function(d){c.IsError()||c.ProcessLine(d)})}b()};
OV.ImporterStl.prototype.IsBinaryStlFile=function(a){var b=a.byteLength;if(84>b)return!1;a=new OV.BinaryReader(a,!0);a.Skip(80);a=a.ReadUnsignedInteger32();return b!==50*a+84?!1:!0};
OV.ImporterStl.prototype.ProcessLine=function(a){if("#"!==a[0]){var b=OV.ParametersFromLine(a,"#");if(0!==b.length){var c=b[0];"solid"===c?1<b.length&&(a=OV.NameFromLine(a,c.length,"#"),this.mesh.SetName(a)):"facet"===c?(this.triangle=new OV.Triangle(-1,-1,-1),5<=b.length&&"normal"===b[1]&&(a=new OV.Coord3D(parseFloat(b[2]),parseFloat(b[3]),parseFloat(b[4])),OV.IsPositive(a.Length())&&(a=this.mesh.AddNormal(a),this.triangle.SetNormals(a,a,a)))):"vertex"===c&&null!==this.triangle?4<=b.length&&(a=this.mesh.AddVertex(new OV.Coord3D(parseFloat(b[1]),
parseFloat(b[2]),parseFloat(b[3]))),-1===this.triangle.v0?this.triangle.v0=a:-1===this.triangle.v1?this.triangle.v1=a:-1===this.triangle.v2&&(this.triangle.v2=a)):"endfacet"===c&&null!==this.triangle&&(-1!==this.triangle.v0&&-1!==this.triangle.v1&&null!==this.triangle.v2&&this.mesh.AddTriangle(this.triangle),this.triangle=null)}}};
OV.ImporterStl.prototype.ProcessBinary=function(a){function b(l){var m=new OV.Coord3D;m.x=l.ReadFloat32();m.y=l.ReadFloat32();m.z=l.ReadFloat32();return m}function c(l,m){m=b(m);return l.AddVertex(m)}a=new OV.BinaryReader(a,!0);a.Skip(80);for(var d=a.ReadUnsignedInteger32(),e=0;e<d;e++){var f=b(a),g=c(this.mesh,a),h=c(this.mesh,a),k=c(this.mesh,a);a.Skip(2);g=new OV.Triangle(g,h,k);OV.IsPositive(f.Length())&&(f=this.mesh.AddNormal(f),g.SetNormals(f,f,f));this.mesh.AddTriangle(g)}};OV.ImporterOff=function(){OV.ImporterBase.call(this)};$jscomp.inherits(OV.ImporterOff,OV.ImporterBase);OV.ImporterOff.prototype.CanImportExtension=function(a){return"off"===a};OV.ImporterOff.prototype.GetKnownFileFormats=function(){return{off:OV.FileFormat.Text}};OV.ImporterOff.prototype.GetUpDirection=function(){return OV.Direction.Y};OV.ImporterOff.prototype.ClearContent=function(){this.status=this.mesh=null};
OV.ImporterOff.prototype.ResetContent=function(){this.mesh=new OV.Mesh;this.model.AddMesh(this.mesh);this.status={vertexCount:0,faceCount:0,foundVertex:0,foundFace:0}};OV.ImporterOff.prototype.ImportContent=function(a,b){var c=this;OV.ReadLines(a,function(d){c.IsError()||c.ProcessLine(d)});b()};
OV.ImporterOff.prototype.ProcessLine=function(a){if("#"!==a[0]&&(a=OV.ParametersFromLine(a,"#"),0!==a.length&&"OFF"!==a[0]))if(0===this.status.vertexCount&&0===this.status.faceCount)1<a.length&&(this.status.vertexCount=parseInt(a[0],10),this.status.faceCount=parseInt(a[1],10));else if(this.status.foundVertex<this.status.vertexCount)3<=a.length&&(this.mesh.AddVertex(new OV.Coord3D(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]))),this.status.foundVertex+=1);else if(this.status.foundFace<this.status.faceCount&&
4<=a.length){var b=parseInt(a[0],10);if(!(a.length<b+1)){for(var c=0;c<b-2;c++){var d=parseInt(a[1]),e=parseInt(a[c+2]),f=parseInt(a[c+3]);d=new OV.Triangle(d,e,f);this.mesh.AddTriangle(d)}this.status.foundFace+=1}}};OV.PlyHeader=function(){this.format=null;this.elements=[]};OV.PlyHeader.prototype.SetFormat=function(a){this.format=a};OV.PlyHeader.prototype.AddElement=function(a,b){this.elements.push({name:a,count:b,format:[]})};OV.PlyHeader.prototype.GetElements=function(){return this.elements};OV.PlyHeader.prototype.AddSingleFormat=function(a,b){this.elements[this.elements.length-1].format.push({name:b,isSingle:!0,elemType:a})};
OV.PlyHeader.prototype.AddListFormat=function(a,b,c){this.elements[this.elements.length-1].format.push({name:c,isSingle:!1,countType:a,elemType:b})};OV.PlyHeader.prototype.GetElement=function(a){for(var b=0;b<this.elements.length;b++){var c=this.elements[b];if(c.name===a)return c}return null};
OV.PlyHeader.prototype.Check=function(){var a=this.GetElement("vertex");if(null===a||0===a.length||3>a.format.length)return!1;a=this.GetElement("face");if("ascii"===this.format){if(null===a||0===a.count||0>a.format.length)return!1}else if("binary_little_endian"===this.format||"binary_big_endian"===this.format){var b=this.GetElement("tristrips");b=null!==b&&0<b.count&&0<b.format.length;if(!(null!==a&&0<a.count&&0<a.format.length||b))return!1}else return!1;return!0};OV.ImporterPly=function(){OV.ImporterBase.call(this)};
$jscomp.inherits(OV.ImporterPly,OV.ImporterBase);OV.ImporterPly.prototype.CanImportExtension=function(a){return"ply"===a};OV.ImporterPly.prototype.GetKnownFileFormats=function(){return{ply:OV.FileFormat.Binary}};OV.ImporterPly.prototype.GetUpDirection=function(){return OV.Direction.Y};OV.ImporterPly.prototype.ClearContent=function(){this.mesh=null};OV.ImporterPly.prototype.ResetContent=function(){this.mesh=new OV.Mesh;this.model.AddMesh(this.mesh)};
OV.ImporterPly.prototype.ImportContent=function(a,b){var c=this.GetHeaderContent(a),d=this.ReadHeader(c);d.Check()?"ascii"===d.format?(a=OV.ArrayBufferToUtf8String(a),a=a.substr(c.length),this.ReadAsciiContent(d,a)):"binary_little_endian"!==d.format&&"binary_big_endian"!==d.format||this.ReadBinaryContent(d,a,c.length):(this.SetError(),this.SetMessage("Invalid header information."));b()};
OV.ImporterPly.prototype.GetHeaderContent=function(a){var b="",c=new Uint8Array(a),d;for(d=0;d<a.byteLength&&(b+=String.fromCharCode(c[d]),!b.endsWith("end_header"));d++);for(d+=1;d<a.byteLength;){var e=String.fromCharCode(c[d]);b+=e;d+=1;if("\n"===e)break}return b};
OV.ImporterPly.prototype.ReadHeader=function(a){var b=new OV.PlyHeader;OV.ReadLines(a,function(c){c=OV.ParametersFromLine(c,null);0!==c.length&&"comment"!==c[0]&&"ply"!==c[0]&&("format"===c[0]&&2<=c.length?b.SetFormat(c[1]):"element"===c[0]&&3<=c.length?b.AddElement(c[1],parseInt(c[2],10)):"property"===c[0]&&3<=c.length&&("list"===c[1]&&5<=c.length?b.AddListFormat(c[2],c[3],c[4]):b.AddSingleFormat(c[1],c[2])))});return b};
OV.ImporterPly.prototype.ReadAsciiContent=function(a,b){var c=this,d=a.GetElement("vertex"),e=a.GetElement("face"),f=0,g=0;OV.ReadLines(b,function(h){if(!c.IsError()&&(h=OV.ParametersFromLine(h,null),0!==h.length&&"comment"!==h[0]))if(f<d.count)3<=h.length&&(c.mesh.AddVertex(new OV.Coord3D(parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2]))),f+=1);else if(g<e.count&&4<=h.length){var k=parseInt(h[0],10);if(!(h.length<k+1)){for(var l=0;l<k-2;l++){var m=parseInt(h[1]),p=parseInt(h[l+2]),n=parseInt(h[l+
3]);m=new OV.Triangle(m,p,n);c.mesh.AddTriangle(m)}g+=1}}})};
OV.ImporterPly.prototype.ReadBinaryContent=function(a,b,c){function d(w,u,z,x){for(var y=null,A=null,C=null,B=255;x<z.length;x++){var D=z[x],E=w.ReadByFormat(u,D);"red"===D.name?y=E:"green"===D.name?A=E:"blue"===D.name?C=E:"alpha"===D.name&&(B=E)}return null!==y&&null!==A&&null!==C?[y,A,C,B]:null}function e(w,u,z){if(null===u)return null;var x="Color "+OV.IntegerToHexString(u[0])+OV.IntegerToHexString(u[1])+OV.IntegerToHexString(u[2])+OV.IntegerToHexString(u[3]),y=z[x];void 0===y&&(y=new OV.Material,
y.name=x,y.diffuse=new OV.Color(u[0],u[1],u[2]),y.opacity=u[3]/255,OV.UpdateMaterialTransparency(y),y=w.model.AddMaterial(y),z[x]=y);return y}function f(w,u,z,x,y,A){u=y[u];z=y[z];x=y[x];y=Math.abs(z[0]-x[0])+Math.abs(z[1]-x[1])+Math.abs(z[2]-x[2]);var C=u;Math.min(Math.abs(u[0]-z[0])+Math.abs(u[1]-z[1])+Math.abs(u[2]-z[2]),y,Math.abs(u[0]-x[0])+Math.abs(u[1]-x[1])+Math.abs(u[2]-x[2]))===y&&(C=z);return e(w,C,A)}var g=null;if("binary_little_endian"===a.format)g=new OV.BinaryReader(b,!0);else if("binary_big_endian"===
a.format)g=new OV.BinaryReader(b,!1);else return;g.Skip(c);b=[];c={};a=a.GetElements();for(var h=0;h<a.length;h++){var k=a[h];if("vertex"===k.name)for(var l=0;l<k.count;l++){var m=this.ReadByFormat(g,k.format[0]),p=this.ReadByFormat(g,k.format[1]),n=this.ReadByFormat(g,k.format[2]),q=d(this,g,k.format,3);null!==q&&b.push(q);this.mesh.AddVertex(new OV.Coord3D(m,p,n))}else if("face"===k.name)for(l=0;l<k.count;l++)for(m=this.ReadByFormat(g,k.format[0]),p=d(this,g,k.format,1),n=0;n<m.length-2;n++){q=
m[0];var r=m[n+1],t=m[n+2],v=new OV.Triangle(q,r,t);null!==p?v.mat=e(this,p,c):b.length===this.model.VertexCount()&&(v.mat=f(this,q,r,t,b,c));this.mesh.AddTriangle(v)}else if("tristrips"===k.name)for(l=0;l<k.count;l++)for(m=this.ReadByFormat(g,k.format[0]),this.SkipFormat(g,k.format,1),p=!0,n=0;n<m.length-2;n++)q=m[n],r=m[n+1],t=m[n+2],-1===t?(n+=2,p=!0):(p||(v=r,r=t,t=v),p=!p,q=new OV.Triangle(q,r,t),this.mesh.AddTriangle(q));else this.SkipFormat(g,k.format,0)}};
OV.ImporterPly.prototype.SkipFormat=function(a,b,c){for(;c<b.length;c++)this.ReadByFormat(a,b[c])};
OV.ImporterPly.prototype.ReadByFormat=function(a,b){function c(g,h){return"char"===h||"int8"===h?g.ReadCharacter8():"uchar"===h||"uint8"===h?g.ReadUnsignedCharacter8():"short"===h||"int16"===h?g.ReadInteger16():"ushort"===h||"uint16"===h?g.ReadUnsignedInteger16():"int"===h||"int32"===h?g.ReadInteger32():"uint"===h||"uint32"===h?g.ReadUnsignedInteger32():"float"===h||"float32"===h?g.ReadFloat32():"double"===h||"double64"===h?g.ReadDouble64():null}if(b.isSingle)return c(a,b.elemType);for(var d=[],e=
c(a,b.countType),f=0;f<e;f++)d.push(c(a,b.elemType));return d};OV.CHUNK3DS={MAIN3DS:19789,EDIT3DS:15677,EDIT_MATERIAL:45055,MAT_NAME:40960,MAT_AMBIENT:40976,MAT_DIFFUSE:40992,MAT_SPECULAR:41008,MAT_SHININESS:41024,MAT_SHININESS_STRENGTH:41025,MAT_TRANSPARENCY:41040,MAT_COLOR_F:16,MAT_COLOR:17,MAT_LIN_COLOR:18,MAT_LIN_COLOR_F:19,MAT_TEXMAP:41472,MAT_TEXMAP_NAME:41728,MAT_TEXMAP_UOFFSET:41816,MAT_TEXMAP_VOFFSET:41818,MAT_TEXMAP_USCALE:41812,MAT_TEXMAP_VSCALE:41814,MAT_TEXMAP_ROTATION:41820,PERCENTAGE:48,PERCENTAGE_F:49,EDIT_OBJECT:16384,OBJ_TRIMESH:16640,OBJ_LIGHT:17920,
OBJ_CAMERA:18176,TRI_VERTEX:16656,TRI_TEXVERTEX:16704,TRI_FACE:16672,TRI_TRANSFORMATION:16736,TRI_MATERIAL:16688,TRI_SMOOTH:16720,KF3DS:45056,OBJECT_NODE:45058,OBJECT_HIERARCHY:45072,OBJECT_INSTANCE_NAME:45073,OBJECT_PIVOT:45075,OBJECT_POSITION:45088,OBJECT_ROTATION:45089,OBJECT_SCALE:45090,OBJECT_ID:45104};OV.Importer3ds=function(){OV.ImporterBase.call(this)};$jscomp.inherits(OV.Importer3ds,OV.ImporterBase);OV.Importer3ds.prototype.CanImportExtension=function(a){return"3ds"===a};
OV.Importer3ds.prototype.GetKnownFileFormats=function(){return{"3ds":OV.FileFormat.Binary}};OV.Importer3ds.prototype.GetUpDirection=function(){return OV.Direction.Z};OV.Importer3ds.prototype.ClearContent=function(){this.defaultMaterialIndex=this.meshTransformations=this.meshNameToIndex=this.materialNameToIndex=null};OV.Importer3ds.prototype.ResetContent=function(){this.materialNameToIndex={};this.meshNameToIndex={};this.meshTransformations=[];this.defaultMaterialIndex=null};
OV.Importer3ds.prototype.ImportContent=function(a,b){this.ProcessBinary(a);b()};OV.Importer3ds.prototype.ProcessBinary=function(a){var b=this,c=new OV.BinaryReader(a,!0);a=c.GetByteLength();this.ReadChunks(c,a,function(d,e){d===OV.CHUNK3DS.MAIN3DS?b.ReadMainChunk(c,e):b.SkipChunk(c,e)})};
OV.Importer3ds.prototype.ReadMainChunk=function(a,b){var c=this;b=this.GetChunkEnd(a,b);this.ReadChunks(a,b,function(d,e){d===OV.CHUNK3DS.EDIT3DS?c.ReadEditorChunk(a,e):d===OV.CHUNK3DS.KF3DS?c.ReadKeyFrameChunk(a,e):c.SkipChunk(a,e)})};OV.Importer3ds.prototype.ReadEditorChunk=function(a,b){var c=this;b=this.GetChunkEnd(a,b);this.ReadChunks(a,b,function(d,e){d===OV.CHUNK3DS.EDIT_MATERIAL?c.ReadMaterialChunk(a,e):d===OV.CHUNK3DS.EDIT_OBJECT?c.ReadObjectChunk(a,e):c.SkipChunk(a,e)})};
OV.Importer3ds.prototype.ReadMaterialChunk=function(a,b){var c=this,d=new OV.Material;b=this.GetChunkEnd(a,b);var e=null,f=null;this.ReadChunks(a,b,function(g,h){g===OV.CHUNK3DS.MAT_NAME?d.name=c.ReadName(a):g===OV.CHUNK3DS.MAT_AMBIENT?d.ambient=c.ReadColorChunk(a,h):g===OV.CHUNK3DS.MAT_DIFFUSE?d.diffuse=c.ReadColorChunk(a,h):g===OV.CHUNK3DS.MAT_SPECULAR?d.specular=c.ReadColorChunk(a,h):g===OV.CHUNK3DS.MAT_SHININESS?e=c.ReadPercentageChunk(a,h):g===OV.CHUNK3DS.MAT_SHININESS_STRENGTH?f=c.ReadPercentageChunk(a,
h):g===OV.CHUNK3DS.MAT_TRANSPARENCY?(d.opacity=1-c.ReadPercentageChunk(a,h),OV.UpdateMaterialTransparency(d)):g===OV.CHUNK3DS.MAT_TEXMAP?(d.diffuseMap=c.ReadTextureMapChunk(a,h),OV.UpdateMaterialTransparency(d)):c.SkipChunk(a,h)});null!==e&&null!==f&&(d.shininess=e*f/10);b=this.model.AddMaterial(d);this.materialNameToIndex[d.name]=b};
OV.Importer3ds.prototype.ReadTextureMapChunk=function(a,b){var c=this,d=new OV.TextureMap;b=this.GetChunkEnd(a,b);this.ReadChunks(a,b,function(e,f){e===OV.CHUNK3DS.MAT_TEXMAP_NAME?(e=c.ReadName(a),f=c.callbacks.getTextureBuffer(e),d.name=e,null!==f&&(d.url=f.url,d.buffer=f.buffer)):e===OV.CHUNK3DS.MAT_TEXMAP_UOFFSET?d.offset.x=a.ReadFloat32():e===OV.CHUNK3DS.MAT_TEXMAP_VOFFSET?d.offset.y=a.ReadFloat32():e===OV.CHUNK3DS.MAT_TEXMAP_USCALE?d.scale.x=a.ReadFloat32():e===OV.CHUNK3DS.MAT_TEXMAP_VSCALE?
d.scale.y=a.ReadFloat32():e===OV.CHUNK3DS.MAT_TEXMAP_ROTATION?d.rotation=a.ReadFloat32()*OV.DegRad:c.SkipChunk(a,f)});return d};
OV.Importer3ds.prototype.ReadColorChunk=function(a,b){var c=this,d=new OV.Color(0,0,0);b=this.GetChunkEnd(a,b);var e=!1;this.ReadChunks(a,b,function(f,g){f===OV.CHUNK3DS.MAT_COLOR?e||(d.r=a.ReadUnsignedCharacter8(),d.g=a.ReadUnsignedCharacter8(),d.b=a.ReadUnsignedCharacter8()):f===OV.CHUNK3DS.MAT_LIN_COLOR?(d.r=a.ReadUnsignedCharacter8(),d.g=a.ReadUnsignedCharacter8(),d.b=a.ReadUnsignedCharacter8(),e=!0):f===OV.CHUNK3DS.MAT_COLOR_F?e||(d.r=parseInt(255*a.ReadFloat32(),10),d.g=parseInt(255*a.ReadFloat32(),
10),d.b=parseInt(255*a.ReadFloat32(),10)):f===OV.CHUNK3DS.MAT_LIN_COLOR_F?(d.r=parseInt(255*a.ReadFloat32(),10),d.g=parseInt(255*a.ReadFloat32(),10),d.b=parseInt(255*a.ReadFloat32(),10),e=!0):c.SkipChunk(a,g)});return d};OV.Importer3ds.prototype.ReadPercentageChunk=function(a,b){var c=this,d=0;b=this.GetChunkEnd(a,b);this.ReadChunks(a,b,function(e,f){e===OV.CHUNK3DS.PERCENTAGE?d=a.ReadUnsignedInteger16()/100:e===OV.CHUNK3DS.PERCENTAGE_F?d=a.ReadFloat32():c.SkipChunk(a,f)});return d};
OV.Importer3ds.prototype.ReadObjectChunk=function(a,b){var c=this;b=this.GetChunkEnd(a,b);var d=this.ReadName(a);this.ReadChunks(a,b,function(e,f){e===OV.CHUNK3DS.OBJ_TRIMESH?c.ReadMeshChunk(a,f,d):c.SkipChunk(a,f)})};
OV.Importer3ds.prototype.ReadMeshChunk=function(a,b,c){var d=this,e=new OV.Mesh;e.SetName(c);b=this.GetChunkEnd(a,b);var f=null;this.ReadChunks(a,b,function(g,h){g===OV.CHUNK3DS.TRI_VERTEX?d.ReadVerticesChunk(e,a):g===OV.CHUNK3DS.TRI_TEXVERTEX?d.ReadTextureVerticesChunk(e,a):g===OV.CHUNK3DS.TRI_FACE?d.ReadFacesChunk(e,a,h):g===OV.CHUNK3DS.TRI_TRANSFORMATION?f=d.ReadTransformationChunk(a):d.SkipChunk(a,h)});if(e.VertexCount()===e.TextureUVCount())for(b=0;b<e.TriangleCount();b++)c=e.GetTriangle(b),
c.SetTextureUVs(c.v0,c.v1,c.v2);b=this.model.AddMesh(e);this.meshNameToIndex[e.GetName()]=b;this.meshTransformations.push(new OV.Matrix(f))};OV.Importer3ds.prototype.ReadVerticesChunk=function(a,b){for(var c=b.ReadUnsignedInteger16(),d=0;d<c;d++){var e=b.ReadFloat32(),f=b.ReadFloat32(),g=b.ReadFloat32();a.AddVertex(new OV.Coord3D(e,f,g))}};
OV.Importer3ds.prototype.ReadTextureVerticesChunk=function(a,b){for(var c=b.ReadUnsignedInteger16(),d=0;d<c;d++){var e=b.ReadFloat32(),f=b.ReadFloat32();a.AddTextureUV(new OV.Coord2D(e,f))}};
OV.Importer3ds.prototype.ReadFacesChunk=function(a,b,c){c=this.GetChunkEnd(b,c);for(var d=b.ReadUnsignedInteger16(),e=0;e<d;e++){var f=b.ReadUnsignedInteger16(),g=b.ReadUnsignedInteger16(),h=b.ReadUnsignedInteger16();b.ReadUnsignedInteger16();a.AddTriangle(new OV.Triangle(f,g,h))}var k=this;this.ReadChunks(b,c,function(l,m){l===OV.CHUNK3DS.TRI_MATERIAL?k.ReadFaceMaterialsChunk(a,b):l===OV.CHUNK3DS.TRI_SMOOTH?k.ReadFaceSmoothingGroupsChunk(a,d,b):k.SkipChunk(b,m)})};
OV.Importer3ds.prototype.ReadFaceMaterialsChunk=function(a,b){var c=this.ReadName(b);c=this.materialNameToIndex[c];for(var d=b.ReadUnsignedInteger16(),e=0;e<d;e++){var f=b.ReadUnsignedInteger16();f=a.GetTriangle(f);void 0!==c&&(f.mat=c)}};OV.Importer3ds.prototype.ReadFaceSmoothingGroupsChunk=function(a,b,c){for(var d=0;d<b;d++){var e=c.ReadUnsignedInteger32();a.GetTriangle(d).curve=e}};
OV.Importer3ds.prototype.ReadTransformationChunk=function(a){for(var b=[],c=0;4>c;c++){for(var d=0;3>d;d++)b.push(a.ReadFloat32());3>c?b.push(0):b.push(1)}return b};OV.Importer3ds.prototype.ReadKeyFrameChunk=function(a,b){var c={nodes:[],idToIndex:{},meshIndexToNodes:{}};b=this.GetChunkEnd(a,b);var d=this;this.ReadChunks(a,b,function(e,f){e===OV.CHUNK3DS.OBJECT_NODE?d.ReadObjectNodeChunk(c,a,f):d.SkipChunk(a,f)});this.ApplyModelTransformations(c)};
OV.Importer3ds.prototype.ApplyModelTransformations=function(a){function b(n,q){if(null!==q.matrix)return q.matrix;var r=new OV.Matrix,t=r,v=t.ComposeTRS,w=OV,u=w.ArrayToCoord3D;var z=0===q.positions.length?[0,0,0]:q.positions[0];w=u.call(w,z);u=OV;z=u.ArrayToQuaternion;if(0===q.rotations.length)var x=[0,0,0,1];else{x=q.rotations[0];var y=[0,0,0,1],A=Math.sqrt(x[0]*x[0]+x[1]*x[1]+x[2]*x[2]);0<A&&(y=-.5*x[3],A=Math.sin(y)/A,y=[A*x[0],A*x[1],A*x[2],Math.cos(y)]);x=y}u=z.call(u,x);z=OV;x=z.ArrayToCoord3D;
A=0===q.scales.length?[1,1,1]:q.scales[0];v.call(t,w,u,x.call(z,A));65535!==q.userId&&(t=n.idToIndex[q.userId],void 0!==t&&(n=b(n,n.nodes[t]),r=r.MultiplyMatrix(n)));return q.matrix=r}function c(n,q,r,t,v){if(r.IsValid()){var w=r;null!==v&&(w=b(t,v));n=n.GetMesh(q);q=r.Determinant();(q=OV.IsNegative(q))&&(r=(new OV.Matrix).CreateScale(-1,1,1).MultiplyMatrix(r));r=r.Invert();null!==r&&(v=null===v?[0,0,0]:v.pivot,v=(new OV.Matrix).CreateTranslation(-v[0],-v[1],-v[2]),w=w.Clone(),w=v.MultiplyMatrix(w),
w=r.MultiplyMatrix(w),w=new OV.Transformation(w),q&&OV.FlipMeshTrianglesOrientation(n),OV.TransformMesh(n,w))}}function d(n,q,r){q=n.GetMesh(q);q=OV.CloneMesh(q);return n.AddMeshToIndex(q,r)}for(var e=0,f=0;f<this.model.MeshCount();f++){var g=f,h=g-e,k=this.meshTransformations[h];h=a.meshIndexToNodes[h];if(void 0===h)c(this.model,g,k,a,null);else for(var l=0;l<h.length;l++){var m=h[l],p=g;0<l&&(p=d(this.model,g,g+l),e+=1,f+=1);c(this.model,p,k,a,m)}}};
OV.Importer3ds.prototype.ReadObjectNodeChunk=function(a,b,c){function d(g,h,k){var l=[];h.Skip(10);for(var m=h.ReadInteger32(),p=0;p<m;p++){h.ReadInteger32();0!==h.ReadUnsignedInteger16()&&h.ReadFloat32();if(k===OV.CHUNK3DS.OBJECT_ROTATION){var n=h.ReadFloat32();var q=g.ReadVector(h);q[3]=n}else q=g.ReadVector(h);l.push(q)}return l}var e={name:"",instanceName:"",nodeId:-1,flags:-1,userId:-1,pivot:[0,0,0],positions:[],rotations:[],scales:[],matrix:null},f=this;c=this.GetChunkEnd(b,c);this.ReadChunks(b,
c,function(g,h){g===OV.CHUNK3DS.OBJECT_HIERARCHY?(e.name=f.ReadName(b),e.flags=b.ReadUnsignedInteger32(),e.userId=b.ReadUnsignedInteger16()):g===OV.CHUNK3DS.OBJECT_INSTANCE_NAME?e.instanceName=f.ReadName(b):g===OV.CHUNK3DS.OBJECT_PIVOT?e.pivot=f.ReadVector(b):g===OV.CHUNK3DS.OBJECT_POSITION?e.positions=d(f,b,OV.CHUNK3DS.OBJECT_POSITION):g===OV.CHUNK3DS.OBJECT_ROTATION?e.rotations=d(f,b,OV.CHUNK3DS.OBJECT_ROTATION):g===OV.CHUNK3DS.OBJECT_SCALE?e.scales=d(f,b,OV.CHUNK3DS.OBJECT_SCALE):g===OV.CHUNK3DS.OBJECT_ID?
e.nodeId=b.ReadUnsignedInteger16():f.SkipChunk(b,h)});c=a.nodes.length;a.nodes.push(e);a.idToIndex[e.nodeId]=c;c=this.meshNameToIndex[e.name];void 0!==c&&(void 0===a.meshIndexToNodes[c]&&(a.meshIndexToNodes[c]=[]),a.meshIndexToNodes[c].push(e))};OV.Importer3ds.prototype.ReadName=function(a){for(var b="",c,d=0;64>d;){c=a.ReadCharacter8();if(0===c)break;b+=String.fromCharCode(c);d+=1}return b};OV.Importer3ds.prototype.ReadVector=function(a){return[a.ReadFloat32(),a.ReadFloat32(),a.ReadFloat32()]};
OV.Importer3ds.prototype.ReadChunks=function(a,b,c){for(;a.GetPosition()<=b-6;){var d=a.ReadUnsignedInteger16(),e=a.ReadUnsignedInteger32();c(d,e)}};OV.Importer3ds.prototype.GetChunkEnd=function(a,b){return a.GetPosition()+b-6};OV.Importer3ds.prototype.SkipChunk=function(a,b){a.Skip(b-6)};OV.GltfComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};OV.GltfDataType={SCALAR:0,VEC2:1,VEC3:2,VEC4:3,MAT2:4,MAT3:5,MAT4:6};OV.GltfRenderMode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};OV.GltfConstants={GLTF_STRING:1179937895,JSON_CHUNK_TYPE:1313821514,BINARY_CHUNK_TYPE:5130562};OV.GltfNodeTree=function(){this.nodes=[];this.nodeToParent={};this.nodeMatrices={}};
OV.GltfNodeTree.prototype.AddMeshNode=function(a){this.nodes.push(a);return this.nodes.length-1};OV.GltfNodeTree.prototype.AddNodeParent=function(a,b){this.nodeToParent[a]=b};OV.GltfNodeTree.prototype.GetNodeParent=function(a){a=this.nodeToParent[a];return void 0===a||-1===a?null:a};OV.GltfNodeTree.prototype.AddNodeMatrix=function(a,b){this.nodeMatrices[a]=b};OV.GltfNodeTree.prototype.GetNodeMatrix=function(a){a=this.nodeMatrices[a];return void 0===a?null:a};
OV.GltfBufferReader=function(a){this.reader=new OV.BinaryReader(a,!0);this.sparseReader=this.dataCount=this.byteStride=this.dataType=this.componentType=null};OV.GltfBufferReader.prototype.SetComponentType=function(a){this.componentType=a};
OV.GltfBufferReader.prototype.SetDataType=function(a){"SCALAR"===a?this.dataType=OV.GltfDataType.SCALAR:"VEC2"===a?this.dataType=OV.GltfDataType.VEC2:"VEC3"===a?this.dataType=OV.GltfDataType.VEC3:"VEC4"===a?this.dataType=OV.GltfDataType.VEC4:"MAT2"===a?this.dataType=OV.GltfDataType.MAT2:"MAT3"===a?this.dataType=OV.GltfDataType.MAT3:"MAT4"===a&&(this.dataType=OV.GltfDataType.MAT4)};OV.GltfBufferReader.prototype.SetByteStride=function(a){this.byteStride=a};
OV.GltfBufferReader.prototype.SetDataCount=function(a){this.dataCount=a};OV.GltfBufferReader.prototype.SetSparseReader=function(a,b){this.sparseReader={indexReader:a,valueReader:b}};OV.GltfBufferReader.prototype.ReadArrayBuffer=function(a){return this.reader.ReadArrayBuffer(a)};OV.GltfBufferReader.prototype.GetDataCount=function(){return this.dataCount};
OV.GltfBufferReader.prototype.ReadData=function(){if(null===this.dataType)return null;if(this.dataType===OV.GltfDataType.SCALAR){var a=this.ReadComponent();this.SkipBytesByStride(1);return a}if(this.dataType===OV.GltfDataType.VEC2){a=this.ReadComponent();var b=this.ReadComponent();this.SkipBytesByStride(2);return new OV.Coord2D(a,b)}if(this.dataType===OV.GltfDataType.VEC3){a=this.ReadComponent();b=this.ReadComponent();var c=this.ReadComponent();this.SkipBytesByStride(3);return new OV.Coord3D(a,b,
c)}return null};OV.GltfBufferReader.prototype.EnumerateData=function(a){if(null===this.sparseReader)for(var b=0;b<this.dataCount;b++)a(this.ReadData());else{b=[];for(var c=0;c<this.sparseReader.indexReader.GetDataCount();c++){var d=this.sparseReader.indexReader.ReadData(),e=this.sparseReader.valueReader.ReadData();b.push({index:d,value:e})}for(d=c=0;d<this.dataCount;d++)e=this.ReadData(),c<b.length&&b[c].index===d?(a(b[c].value),c+=1):a(e)}};OV.GltfBufferReader.prototype.SkipBytes=function(a){this.reader.Skip(a)};
OV.GltfBufferReader.prototype.ReadComponent=function(){return null===this.componentType?null:this.componentType===OV.GltfComponentType.BYTE?this.reader.ReadCharacter8():this.componentType===OV.GltfComponentType.UNSIGNED_BYTE?this.reader.ReadUnsignedCharacter8():this.componentType===OV.GltfComponentType.SHORT?this.reader.ReadInteger16():this.componentType===OV.GltfComponentType.UNSIGNED_SHORT?this.reader.ReadUnsignedInteger16():this.componentType===OV.GltfComponentType.UNSIGNED_INT?this.reader.ReadInteger32():
this.componentType===OV.GltfComponentType.FLOAT?this.reader.ReadFloat32():null};OV.GltfBufferReader.prototype.SkipBytesByStride=function(a){null!==this.byteStride&&(a*=this.GetComponentSize(),this.reader.Skip(this.byteStride-a))};
OV.GltfBufferReader.prototype.GetComponentSize=function(){return this.componentType===OV.GltfComponentType.BYTE||this.componentType===OV.GltfComponentType.UNSIGNED_BYTE?1:this.componentType===OV.GltfComponentType.SHORT||this.componentType===OV.GltfComponentType.UNSIGNED_SHORT?2:this.componentType===OV.GltfComponentType.UNSIGNED_INT||this.componentType===OV.GltfComponentType.FLOAT?4:0};OV.GltfExtensions=function(){this.supportedExtensions=["KHR_materials_pbrSpecularGlossiness","KHR_texture_transform"]};
OV.GltfExtensions.prototype.GetUnsupportedExtensions=function(a){var b=[];if(void 0===a)return b;for(var c=0;c<a.length;c++){var d=a[c];-1===this.supportedExtensions.indexOf(d)&&b.push(d)}return b};
OV.GltfExtensions.prototype.ProcessMaterial=function(a,b,c){function d(f){return parseInt(Math.round(255*OV.LinearToSRGB(f)),10)}if(void 0!==a.extensions&&(a=a.extensions.KHR_materials_pbrSpecularGlossiness,void 0!==a)){var e=a.diffuseFactor;void 0!==e&&(b.diffuse=new OV.Color(d(e[0]),d(e[1]),d(e[2])),b.opacity=e[3]);e=a.diffuseTexture;void 0!==e&&(b.diffuseMap=c(e));e=a.specularFactor;void 0!==e&&(b.specular=new OV.Color(d(e[0]),d(e[1]),d(e[2])));e=a.specularGlossinessTexture;void 0!==e&&(b.specularMap=
c(e));c=a.glossinessFactor;void 0!==c&&(b.shininess=c)}};OV.GltfExtensions.prototype.ProcessTexture=function(a,b){void 0!==a.extensions&&(a=a.extensions.KHR_texture_transform,void 0!==a&&(void 0!==a.offset&&(b.offset.x=a.offset[0],b.offset.y=-a.offset[1]),void 0!==a.scale&&(b.scale.x=a.scale[0],b.scale.y=a.scale[1]),void 0!==a.rotation&&(b.rotation=-a.rotation)))};OV.ImporterGltf=function(){OV.ImporterBase.call(this)};$jscomp.inherits(OV.ImporterGltf,OV.ImporterBase);
OV.ImporterGltf.prototype.CanImportExtension=function(a){return"gltf"===a||"glb"===a};OV.ImporterGltf.prototype.GetKnownFileFormats=function(){return{gltf:OV.FileFormat.Text,glb:OV.FileFormat.Binary,bin:OV.FileFormat.Binary}};OV.ImporterGltf.prototype.GetUpDirection=function(){return OV.Direction.Y};OV.ImporterGltf.prototype.ClearContent=function(){this.imageIndexToTextureParams=this.gltfExtensions=this.bufferContents=null};
OV.ImporterGltf.prototype.ResetContent=function(){this.bufferContents=[];this.gltfExtensions=new OV.GltfExtensions;this.imageIndexToTextureParams={}};OV.ImporterGltf.prototype.ImportContent=function(a,b){"gltf"===this.extension?this.ProcessGltf(a):"glb"===this.extension&&this.ProcessBinaryGltf(a);b()};
OV.ImporterGltf.prototype.ProcessGltf=function(a){a=JSON.parse(a);if("2.0"!==a.asset.version)this.SetError(),this.SetMessage("Invalid glTF version.");else{for(var b=0;b<a.buffers.length;b++){var c=null,d=a.buffers[b],e=OV.Base64DataURIToArrayBuffer(d.uri);null!==e?c=e.buffer:(d=this.callbacks.getFileBuffer(d.uri),null!==d&&(c=d));if(null===c){this.SetError();this.SetMessage("One  of the requested buffers is missing.");return}this.bufferContents.push(c)}this.ProcessMainFile(a)}};
OV.ImporterGltf.prototype.ProcessBinaryGltf=function(a){a=new OV.BinaryReader(a,!0);if(a.ReadUnsignedInteger32()!==OV.GltfConstants.GLTF_STRING)this.SetError(),this.SetMessage("Invalid glTF file.");else if(2!==a.ReadUnsignedInteger32())this.SetError(),this.SetMessage("Invalid glTF version.");else if(a.ReadUnsignedInteger32()!==a.GetByteLength())this.SetError(),this.SetMessage("Invalid glTF file.");else{for(var b=null;!a.End();){var c=a;var d=c.ReadUnsignedInteger32();var e=c.ReadUnsignedInteger32();
c=c.ReadArrayBuffer(d);e===OV.GltfConstants.JSON_CHUNK_TYPE?b=OV.ArrayBufferToUtf8String(c):e===OV.GltfConstants.BINARY_CHUNK_TYPE&&this.bufferContents.push(c)}null!==b&&(a=JSON.parse(b),this.ProcessMainFile(a))}};
OV.ImporterGltf.prototype.ProcessMainFile=function(a){var b=this.gltfExtensions.GetUnsupportedExtensions(a.extensionsRequired);if(0<b.length)this.SetError(),this.SetMessage("Unsupported extension: "+b.join(", ")+".");else if(b=this.GetDefaultScene(a),null===b)this.SetError(),this.SetMessage("No default scene found.");else{var c=a.materials;if(void 0!==c)for(var d=0;d<c.length;d++)this.ImportMaterial(a,d);b=this.CollectMeshNodesForScene(a,b);for(c=0;c<b.nodes.length;c++)this.ImportMeshNode(a,b.nodes[c],
b)}};OV.ImporterGltf.prototype.GetDefaultScene=function(a){var b=a.scene||0;return b>=a.scenes.length?null:a.scenes[b]};OV.ImporterGltf.prototype.CollectMeshNodesForScene=function(a,b){function c(g,h,k,l,m){var p=g.nodes[k];void 0!==p.mesh&&(l.AddMeshNode(k),m.push(k));l.AddNodeParent(k,h);if(void 0!==p.children)for(h=0;h<p.children.length;h++)c(g,k,p.children[h],l,m)}for(var d=new OV.GltfNodeTree,e=[],f=0;f<b.nodes.length;f++)c(a,-1,b.nodes[f],d,e);return d};
OV.ImporterGltf.prototype.ImportMaterial=function(a,b){function c(g){return parseInt(Math.round(255*OV.LinearToSRGB(g)),10)}b=a.materials[b];var d=new OV.Material;void 0!==b.name&&(d.name=b.name);d.diffuse=new OV.Color(c(1),c(1),c(1));if(void 0!==b.pbrMetallicRoughness){var e=b.pbrMetallicRoughness.baseColorFactor;void 0!==e&&(d.diffuse=new OV.Color(c(e[0]),c(e[1]),c(e[2])),d.opacity=e[3]);e=b.emissiveFactor;void 0!==e&&(d.emissive=new OV.Color(c(e[0]),c(e[1]),c(e[2])));d.diffuseMap=this.ImportTexture(a,
b.pbrMetallicRoughness.baseColorTexture);d.normalMap=this.ImportTexture(a,b.normalTexture);d.emissiveMap=this.ImportTexture(a,b.emissiveTexture);null!==d.diffuseMap&&(d.multiplyDiffuseMap=!0);e=b.alphaMode;void 0!==e&&("BLEND"===e?d.transparent=!0:"MASK"===e&&(d.transparent=!0,d.alphaTest=b.alphaCutoff||.5))}var f=this;this.gltfExtensions.ProcessMaterial(b,d,function(g){return f.ImportTexture(a,g)});this.model.AddMaterial(d)};
OV.ImporterGltf.prototype.ImportTexture=function(a,b){function c(l){if(void 0===l||null===l)return"";l=l.split("/");return 0===l.length?"":"."+l[l.length-1]}if(void 0===b||null===b)return null;var d=new OV.TextureMap,e=a.textures[b.index].source,f=a.images[e],g=this.imageIndexToTextureParams[e];if(void 0===g){g={name:null,url:null,buffer:null};var h=e.toString();if(void 0!==f.uri)a=OV.Base64DataURIToArrayBuffer(f.uri),null!==a?(g.name="Embedded_"+h+c(a.mimeType),g.url=OV.CreateObjectUrlWithMimeType(a.buffer,
a.mimeType),g.buffer=a.buffer):(h=this.callbacks.getTextureBuffer(f.uri),g.name=f.uri,null!==h&&(g.url=h.url,g.buffer=h.buffer));else if(void 0!==f.bufferView){a=a.bufferViews[f.bufferView];var k=this.GetReaderFromBufferView(a);null!==k&&(a=k.ReadArrayBuffer(a.byteLength),g.name="Binary_"+h+c(f.mimeType),g.url=OV.CreateObjectUrlWithMimeType(a,f.mimeType),g.buffer=a)}this.imageIndexToTextureParams[e]=g}d.name=g.name;d.url=g.url;d.buffer=g.buffer;this.gltfExtensions.ProcessTexture(b,d);return d};
OV.ImporterGltf.prototype.ImportMeshNode=function(a,b,c){function d(h,k,l){var m=h.nodes[k],p=l.GetNodeMatrix(k);if(null!==p)return p;p=(new OV.Matrix).CreateIdentity();if(void 0!==m.matrix)p.Set(m.matrix);else{var n=!1,q=[0,0,0],r=[0,0,0,1],t=[1,1,1];void 0!==m.translation&&(q=m.translation,n=!0);void 0!==m.rotation&&(r=m.rotation,n=!0);void 0!==m.scale&&(t=m.scale,n=!0);n&&p.ComposeTRS(OV.ArrayToCoord3D(q),OV.ArrayToQuaternion(r),OV.ArrayToCoord3D(t))}m=l.GetNodeParent(k);null!==m&&(h=d(h,m,l),
p=p.MultiplyMatrix(h));l.AddNodeMatrix(k,p);return p}var e=a.nodes[b],f=a.meshes[e.mesh],g=new OV.Mesh;this.model.AddMesh(g);void 0!==f.name?g.SetName(f.name):void 0!==e.name&&g.SetName(e.name);for(e=0;e<f.primitives.length;e++)this.ImportPrimitive(a,f.primitives[e],g);a=d(a,b,c);a=new OV.Transformation(a);OV.TransformMesh(g,a)};
OV.ImporterGltf.prototype.ImportPrimitive=function(a,b,c){function d(r,t,v,w,u,z,x,y,A){x=new OV.Triangle(x+t,x+v,x+w);u&&x.SetNormals(y+t,y+v,y+w);z&&x.SetTextureUVs(A+t,A+v,A+w);void 0!==b.material&&(x.mat=b.material);r.AddTriangle(x)}if(void 0!==b.attributes){var e=void 0!==b.attributes.POSITION,f=void 0!==b.attributes.NORMAL,g=void 0!==b.attributes.TEXCOORD_0,h=void 0!==b.indices,k=OV.GltfRenderMode.TRIANGLES;void 0!==b.mode&&(k=b.mode);if(k===OV.GltfRenderMode.TRIANGLES||k===OV.GltfRenderMode.TRIANGLE_STRIP||
k===OV.GltfRenderMode.TRIANGLE_FAN){var l=c.VertexCount(),m=c.NormalCount(),p=c.TextureUVCount();if(e&&(e=this.GetReaderFromAccessor(a,a.accessors[b.attributes.POSITION]),null!==e)){e.EnumerateData(function(r){c.AddVertex(r)});if(f){e=this.GetReaderFromAccessor(a,a.accessors[b.attributes.NORMAL]);if(null===e)return;e.EnumerateData(function(r){c.AddNormal(r)})}if(g){e=this.GetReaderFromAccessor(a,a.accessors[b.attributes.TEXCOORD_0]);if(null===e)return;e.EnumerateData(function(r){r.y=-r.y;c.AddTextureUV(r)})}var n=
[];if(h){a=this.GetReaderFromAccessor(a,a.accessors[b.indices]);if(null===a)return;a.EnumerateData(function(r){n.push(r)})}else for(a=0;a<c.VertexCount();a++)n.push(a);if(k===OV.GltfRenderMode.TRIANGLES)for(k=0;k<n.length;k+=3)d(c,n[k],n[k+1],n[k+2],f,g,l,m,p);else if(k===OV.GltfRenderMode.TRIANGLE_STRIP)for(k=0;k<n.length-2;k++){a=n[k];h=n[k+1];e=n[k+2];if(1===k%2){var q=h;h=e;e=q}d(c,a,h,e,f,g,l,m,p)}else if(k===OV.GltfRenderMode.TRIANGLE_FAN)for(k=1;k<n.length-1;k++)d(c,n[0],n[k],n[k+1],f,g,l,
m,p)}}}};OV.ImporterGltf.prototype.GetReaderFromBufferView=function(a){var b=this.bufferContents[a.buffer||0];if(null===b)return null;b=new OV.GltfBufferReader(b);b.SkipBytes(a.byteOffset||0);a=a.byteStride;void 0!==a&&0!==a&&b.SetByteStride(a);return b};
OV.ImporterGltf.prototype.GetReaderFromAccessor=function(a,b){var c=this.GetReaderFromBufferView(a.bufferViews[b.bufferView||0]);if(null===c)return null;c.SetComponentType(b.componentType);c.SetDataType(b.type);c.SetDataCount(b.count);c.SkipBytes(b.byteOffset||0);if(void 0!==b.sparse){var d=this.GetReaderFromSparseAccessor(a,b.sparse.indices,b.sparse.indices.componentType,"SCALAR",b.sparse.count);a=this.GetReaderFromSparseAccessor(a,b.sparse.values,b.componentType,b.type,b.sparse.count);null!==d&&
null!==a&&c.SetSparseReader(d,a)}return c};OV.ImporterGltf.prototype.GetReaderFromSparseAccessor=function(a,b,c,d,e){if(void 0===b.bufferView)return null;a=this.GetReaderFromBufferView(a.bufferViews[b.bufferView]);if(null===a)return null;a.SetComponentType(c);a.SetDataType(d);a.SetDataCount(e);a.SkipBytes(b.byteOffset||0);return a};OV.ImporterO3dv=function(){OV.ImporterBase.call(this)};$jscomp.inherits(OV.ImporterO3dv,OV.ImporterBase);OV.ImporterO3dv.prototype.CanImportExtension=function(a){return"o3dv"===a};OV.ImporterO3dv.prototype.GetKnownFileFormats=function(){return{o3dv:OV.FileFormat.Text}};OV.ImporterO3dv.prototype.GetUpDirection=function(){return OV.Direction.Z};OV.ImporterO3dv.prototype.ClearContent=function(){};OV.ImporterO3dv.prototype.ResetContent=function(){};
OV.ImporterO3dv.prototype.ImportContent=function(a,b){a=JSON.parse(a);if(void 0!==a.materials)for(var c=0;c<a.materials.length;c++)this.ImportMaterial(a.materials[c]);if(void 0!==a.meshes)for(c=0;c<a.meshes.length;c++)this.ImportMesh(a.meshes[c]);b()};OV.ImporterO3dv.prototype.ImportMaterial=function(a){var b=new OV.Material;b.diffuse.Set(255,255,255);void 0!==a.name&&(b.name=a.name);void 0!==a.diffuse&&(b.diffuse=OV.ArrayToColor(a.diffuse));this.model.AddMaterial(b)};
OV.ImporterO3dv.prototype.ImportMesh=function(a){var b=new OV.GeneratorParams;void 0!==a.name&&b.SetName(a.name);void 0!==a.material&&b.SetMaterial(a.material);if(void 0!==a.transformation){var c=new OV.Coord3D(0,0,0),d=new OV.Quaternion(0,0,0,1),e=new OV.Coord3D(1,1,1);void 0!==a.transformation.translation&&(c=OV.ArrayToCoord3D(a.transformation.translation));void 0!==a.transformation.rotation&&(d=OV.ArrayToQuaternion(a.transformation.rotation));void 0!==a.transformation.scale&&(e=OV.ArrayToCoord3D(a.transformation.scale));
b.SetTransformation(c,d,e)}c=a.parameters;void 0!==c&&"cuboid"===a.type&&void 0!==c.size_x&&void 0!==c.size_y&&void 0!==c.size_z&&(a=OV.GenerateCuboid(b,c.size_x,c.size_y,c.size_z),this.model.AddMesh(a))};OV.File=function(a,b){this.source=b;b===OV.FileSource.Url?(this.fileUrl=a,this.fileObject=null,this.name=OV.GetFileName(a),this.extension=OV.GetFileExtension(a)):b===OV.FileSource.File&&(this.fileUrl=null,this.fileObject=a,this.name=OV.GetFileName(a.name),this.extension=OV.GetFileExtension(a.name));this.content=null};OV.FileList=function(a){this.files=[];this.importers=a};OV.FileList.prototype.FillFromFileUrls=function(a){this.Fill(a,OV.FileSource.Url)};
OV.FileList.prototype.FillFromFileObjects=function(a){this.Fill(a,OV.FileSource.File)};OV.FileList.prototype.ExtendFromFileList=function(a){for(var b=0;b<a.length;b++){var c=a[b];this.ContainsFileByPath(c.name)||this.files.push(c)}};OV.FileList.prototype.GetFiles=function(){return this.files};OV.FileList.prototype.GetContent=function(a){var b=this;(new OV.TaskRunner).Run(this.files.length,{runTask:function(c,d){b.GetFileContent(b.files[c],d)},onReady:a})};
OV.FileList.prototype.ContainsFileByPath=function(a){return null!==this.FindFileByPath(a)};OV.FileList.prototype.FindFileByPath=function(a){a=OV.GetFileName(a).toLowerCase();for(var b=0;b<this.files.length;b++){var c=this.files[b];if(c.name.toLowerCase()===a)return c}return null};OV.FileList.prototype.HasMainFile=function(){return null!==this.GetMainFile()};
OV.FileList.prototype.GetMainFile=function(){for(var a=0;a<this.files.length;a++){var b=this.files[a],c=this.FindImporter(b);if(null!==c)return{file:b,importer:c}}return null};OV.FileList.prototype.IsOnlySource=function(a){if(0===this.files.length)return!1;for(var b=0;b<this.files.length;b++)if(this.files[b].source!==a)return!1;return!0};OV.FileList.prototype.Fill=function(a,b){this.files=[];for(var c=0;c<a.length;c++){var d=new OV.File(a[c],b);this.AddFile(d)}};OV.FileList.prototype.AddFile=function(a){this.files.push(a)};
OV.FileList.prototype.GetFileContent=function(a,b){var c={success:function(e){a.content=e},error:function(){},complete:function(){b()}};if(null!==a.content)b();else{var d=this.GetFileFormat(a);a.source===OV.FileSource.Url?OV.RequestUrl(a.fileUrl,d,c):a.source===OV.FileSource.File&&OV.ReadFile(a.fileObject,d,c)}};OV.FileList.prototype.GetFileFormat=function(a){for(var b=0;b<this.importers.length;b++){var c=this.importers[b],d=a.extension.toLowerCase();c=c.GetKnownFileFormats();if(void 0!==c[d])return c[d]}return OV.FileFormat.Binary};
OV.FileList.prototype.FindImporter=function(a){for(var b=0;b<this.importers.length;b++){var c=this.importers[b];if(c.CanImportExtension(a.extension.toLowerCase()))return c}return null};OV.ImportSettings=function(){this.defaultColor=new OV.Color(200,200,200);this.edgesColor=new OV.Color(0,0,0);this.showEdges=!1;this.edgesAngle=15};OV.ImportErrorCode={NoImportableFile:1,ImportFailed:2,UnknownError:3};OV.ImportError=function(a,b){this.code=a;this.message=b};
OV.ImportResult=function(){this.missingFiles=this.usedFiles=this.upVector=this.mainFile=this.model=null};OV.ImportBuffers=function(a){this.getBufferCallback=a;this.fileBuffers={};this.textureBuffers={}};OV.ImportBuffers.prototype.GetFileBuffer=function(a){a=OV.GetFileName(a);var b=this.fileBuffers[a];void 0===b&&(b=this.getBufferCallback(a),this.fileBuffers[a]=b);return b};
OV.ImportBuffers.prototype.GetTextureBuffer=function(a){a=OV.GetFileName(a);var b=this.textureBuffers[a];void 0===b&&(b=this.getBufferCallback(a),b=null!==b?{url:OV.CreateObjectUrl(b),buffer:b}:null,this.textureBuffers[a]=b);return b};
OV.Importer=function(){this.importers=[new OV.ImporterObj,new OV.ImporterStl,new OV.ImporterOff,new OV.ImporterPly,new OV.Importer3ds,new OV.ImporterGltf,new OV.ImporterO3dv];this.fileList=new OV.FileList(this.importers);this.model=null;this.usedFiles=[];this.missingFiles=[]};OV.Importer.prototype.AddImporter=function(a){this.importers.push(a)};OV.Importer.prototype.LoadFilesFromUrls=function(a,b){this.LoadFiles(a,OV.FileSource.Url,b)};
OV.Importer.prototype.LoadFilesFromFileObjects=function(a,b){this.LoadFiles(a,OV.FileSource.File,b)};
OV.Importer.prototype.Import=function(a,b){var c=this.fileList.GetMainFile();if(null===c||null===c.file||null===c.file.content)b.onError(new OV.ImportError(OV.ImportErrorCode.NoImportableFile,null));else{this.RevokeModelUrls();this.model=null;this.usedFiles=[];this.missingFiles=[];this.usedFiles.push(c.file.name);var d=this,e=c.importer,f=new OV.ImportBuffers(function(g){var h=d.fileList.FindFileByPath(g);null===h||null===h.content?(d.missingFiles.push(g),h=null):(h=h.content,d.usedFiles.push(g));
return h});e.Import(c.file.content,c.file.extension,{getDefaultMaterial:function(){var g=new OV.Material;g.diffuse=a.defaultColor;return g},getFileBuffer:function(g){return f.GetFileBuffer(g)},getTextureBuffer:function(g){return f.GetTextureBuffer(g)},onSuccess:function(){d.model=e.GetModel();d.model.SetName(c.file.name);var g=new OV.ImportResult;g.mainFile=c.file.name;g.model=d.model;g.usedFiles=d.usedFiles;g.missingFiles=d.missingFiles;g.upVector=e.GetUpDirection();b.onSuccess(g)},onError:function(){var g=
e.GetMessage();b.onError(new OV.ImportError(OV.ImportErrorCode.ImportFailed,g))},onComplete:function(){e.Clear()}})}};
OV.Importer.prototype.LoadFiles=function(a,b,c){var d=new OV.FileList(this.importers);b===OV.FileSource.Url?d.FillFromFileUrls(a):b===OV.FileSource.File&&d.FillFromFileObjects(a);a=!1;if(d.HasMainFile())a=!0;else{a=!1;for(b=0;b<this.missingFiles.length;b++)d.ContainsFileByPath(this.missingFiles[b])&&(a=!0);a?(a=d.GetFiles(),this.fileList.ExtendFromFileList(a),a=!1):a=!0}a&&(this.fileList=d);this.fileList.GetContent(function(){c()})};OV.Importer.prototype.GetFileList=function(){return this.fileList};
OV.Importer.prototype.IsOnlyFileSource=function(a){return this.fileList.IsOnlySource(a)};OV.Importer.prototype.RevokeModelUrls=function(){if(null!==this.model)for(var a=0;a<this.model.MaterialCount();a++)this.model.GetMaterial(a).EnumerateTextureMaps(function(b){null!==b.url&&OV.RevokeObjectUrl(b.url)})};OV.ExportedFile=function(a){this.name=a;this.content=null};OV.ExportedFile.prototype.GetName=function(){return this.name};OV.ExportedFile.prototype.SetName=function(a){this.name=a};OV.ExportedFile.prototype.GetContent=function(){return this.content};OV.ExportedFile.prototype.SetContent=function(a){this.content=a};OV.ExporterBase=function(){};OV.ExporterBase.prototype.CanExport=function(a,b){return!1};OV.ExporterBase.prototype.Export=function(a,b,c){var d=[];this.ExportContent(a,b,d,function(){c(d)})};
OV.ExporterBase.prototype.ExportContent=function(a,b,c,d){};OV.ExporterBase.prototype.GetExportedMaterialName=function(a){return this.GetExportedName(a,"Material")};OV.ExporterBase.prototype.GetExportedMeshName=function(a){return this.GetExportedName(a,"Mesh")};OV.ExporterBase.prototype.GetExportedName=function(a,b){return 0===a.length?b:a};OV.ExporterObj=function(){OV.ExporterBase.call(this)};$jscomp.inherits(OV.ExporterObj,OV.ExporterBase);OV.ExporterObj.prototype.CanExport=function(a,b){return a===OV.FileFormat.Text&&"obj"===b};
OV.ExporterObj.prototype.ExportContent=function(a,b,c,d){function e(A,C,B,D){if(null!==B&&B.IsValid()){var E=OV.GetFileName(B.name);A.WriteArrayLine([C,E]);-1===D.findIndex(function(G){return G.GetName()===E})&&(A=new OV.ExportedFile(E),A.SetContent(B.buffer),D.push(A))}}var f=new OV.ExportedFile("model.mtl");b=new OV.ExportedFile("model.obj");c.push(f);c.push(b);var g=new OV.TextWriter;g.WriteLine(this.GetHeaderText());for(var h=0;h<a.MaterialCount();h++){var k=a.GetMaterial(h);g.WriteArrayLine(["newmtl",
this.GetExportedMaterialName(k.name)]);g.WriteArrayLine(["Ka",k.ambient.r/255,k.ambient.g/255,k.ambient.b/255]);g.WriteArrayLine(["Kd",k.diffuse.r/255,k.diffuse.g/255,k.diffuse.b/255]);g.WriteArrayLine(["Ks",k.specular.r/255,k.specular.g/255,k.specular.b/255]);g.WriteArrayLine(["Ns",1E3*k.shininess]);g.WriteArrayLine(["d",k.opacity]);e(g,"map_Kd",k.diffuseMap,c);e(g,"map_Ks",k.specularMap,c);e(g,"bump",k.bumpMap,c)}f.SetContent(g.GetText());c=new OV.TextWriter;c.WriteLine(this.GetHeaderText());c.WriteArrayLine(["mtllib",
f.GetName()]);h=g=f=0;k=null;for(var l=0;l<a.MeshCount();l++){var m=a.GetMesh(l);c.WriteArrayLine(["g",this.GetExportedMeshName(m.GetName())]);for(var p=0;p<m.VertexCount();p++){var n=m.GetVertex(p);c.WriteArrayLine(["v",n.x,n.y,n.z])}for(p=0;p<m.NormalCount();p++)n=m.GetNormal(p),c.WriteArrayLine(["vn",n.x,n.y,n.z]);for(p=0;p<m.TextureUVCount();p++)n=m.GetTextureUV(p),c.WriteArrayLine(["vt",n.x,n.y]);for(p=0;p<m.TriangleCount();p++){n=m.GetTriangle(p);var q=n.v0+f+1,r=n.v1+f+1,t=n.v2+f+1,v=n.n0+
g+1,w=n.n1+g+1,u=n.n2+g+1;if(null!==n.mat){var z=a.GetMaterial(n.mat);z=this.GetExportedMaterialName(z.name);z!==k&&(c.WriteArrayLine(["usemtl",z]),k=z)}var x=z="",y="";n.HasTextureUVs()&&(z=n.u0+h+1,x=n.u1+h+1,y=n.u2+h+1);c.WriteArrayLine(["f",[q,z,v].join("/"),[r,x,w].join("/"),[t,y,u].join("/")])}f+=m.VertexCount();g+=m.NormalCount();h+=m.TextureUVCount()}b.SetContent(c.GetText());d()};OV.ExporterObj.prototype.GetHeaderText=function(){return"# exported by https://3dviewer.net"};OV.ExporterStl=function(){OV.ExporterBase.call(this)};$jscomp.inherits(OV.ExporterStl,OV.ExporterBase);OV.ExporterStl.prototype.CanExport=function(a,b){return(a===OV.FileFormat.Text||a===OV.FileFormat.Binary)&&"stl"===b};OV.ExporterStl.prototype.ExportContent=function(a,b,c,d){b===OV.FileFormat.Text?this.ExportText(a,c):this.ExportBinary(a,c);d()};
OV.ExporterStl.prototype.ExportText=function(a,b){var c=new OV.ExportedFile("model.stl");b.push(c);var d=new OV.TextWriter;d.WriteLine("solid Model");OV.EnumerateTrianglesWithNormals(a,function(e,f,g,h){d.WriteArrayLine(["facet","normal",h.x,h.y,h.z]);d.Indent(1);d.WriteLine("outer loop");d.Indent(1);d.WriteArrayLine(["vertex",e.x,e.y,e.z]);d.WriteArrayLine(["vertex",f.x,f.y,f.z]);d.WriteArrayLine(["vertex",g.x,g.y,g.z]);d.Indent(-1);d.WriteLine("endloop");d.Indent(-1);d.WriteLine("endfacet")});d.WriteLine("endsolid Model");
c.SetContent(d.GetText())};
OV.ExporterStl.prototype.ExportBinary=function(a,b){var c=new OV.ExportedFile("model.stl");b.push(c);b=a.TriangleCount();for(var d=new OV.BinaryWriter(84+50*b,!0),e=0;80>e;e++)d.WriteUnsignedCharacter8(0);d.WriteUnsignedInteger32(b);OV.EnumerateTrianglesWithNormals(a,function(f,g,h,k){d.WriteFloat32(k.x);d.WriteFloat32(k.y);d.WriteFloat32(k.z);d.WriteFloat32(f.x);d.WriteFloat32(f.y);d.WriteFloat32(f.z);d.WriteFloat32(g.x);d.WriteFloat32(g.y);d.WriteFloat32(g.z);d.WriteFloat32(h.x);d.WriteFloat32(h.y);
d.WriteFloat32(h.z);d.WriteUnsignedInteger16(0)});c.SetContent(d.GetBuffer())};OV.ExporterPly=function(){OV.ExporterBase.call(this)};$jscomp.inherits(OV.ExporterPly,OV.ExporterBase);OV.ExporterPly.prototype.CanExport=function(a,b){return(a===OV.FileFormat.Text||a===OV.FileFormat.Binary)&&"ply"===b};OV.ExporterPly.prototype.ExportContent=function(a,b,c,d){b===OV.FileFormat.Text?this.ExportText(a,c):this.ExportBinary(a,c);d()};
OV.ExporterPly.prototype.ExportText=function(a,b){var c=new OV.ExportedFile("model.ply");b.push(c);var d=new OV.TextWriter;b=a.VertexCount();var e=a.TriangleCount();b=this.GetHeaderText("ascii",b,e);d.Write(b);OV.EnumerateModelVerticesAndTriangles(a,{onVertex:function(f,g,h){d.WriteArrayLine([f,g,h])},onTriangle:function(f,g,h){d.WriteArrayLine([3,f,g,h])}});c.SetContent(d.GetText())};
OV.ExporterPly.prototype.ExportBinary=function(a,b){var c=new OV.ExportedFile("model.ply");b.push(c);var d=a.VertexCount(),e=a.TriangleCount();b=this.GetHeaderText("binary_little_endian",d,e);var f=new OV.BinaryWriter(b.length+12*d+13*e,!0);for(d=0;d<b.length;d++)f.WriteUnsignedCharacter8(b.charCodeAt(d));OV.EnumerateModelVerticesAndTriangles(a,{onVertex:function(g,h,k){f.WriteFloat32(g);f.WriteFloat32(h);f.WriteFloat32(k)},onTriangle:function(g,h,k){f.WriteUnsignedCharacter8(3);f.WriteInteger32(g);
f.WriteInteger32(h);f.WriteInteger32(k)}});c.SetContent(f.GetBuffer())};OV.ExporterPly.prototype.GetHeaderText=function(a,b,c){var d=new OV.TextWriter;d.WriteLine("ply");d.WriteLine("format "+a+" 1.0");d.WriteLine("element vertex "+b);d.WriteLine("property float x");d.WriteLine("property float y");d.WriteLine("property float z");d.WriteLine("element face "+c);d.WriteLine("property list uchar int vertex_index");d.WriteLine("end_header");return d.GetText()};OV.ExporterOff=function(){OV.ExporterBase.call(this)};$jscomp.inherits(OV.ExporterOff,OV.ExporterBase);OV.ExporterOff.prototype.CanExport=function(a,b){return a===OV.FileFormat.Text&&"off"===b};
OV.ExporterOff.prototype.ExportContent=function(a,b,c,d){b=new OV.ExportedFile("model.off");c.push(b);var e=new OV.TextWriter;e.WriteLine("OFF");e.WriteArrayLine([a.VertexCount(),a.TriangleCount(),0]);OV.EnumerateModelVerticesAndTriangles(a,{onVertex:function(f,g,h){e.WriteArrayLine([f,g,h])},onTriangle:function(f,g,h){e.WriteArrayLine([3,f,g,h])}});b.SetContent(e.GetText());d()};OV.ExporterGltf=function(){OV.ExporterBase.call(this);this.components={index:{type:5125,size:4},number:{type:5126,size:4}}};$jscomp.inherits(OV.ExporterGltf,OV.ExporterBase);OV.ExporterGltf.prototype.CanExport=function(a,b){return a===OV.FileFormat.Text&&"gltf"===b||a===OV.FileFormat.Binary&&"glb"===b};OV.ExporterGltf.prototype.ExportContent=function(a,b,c,d){b===OV.FileFormat.Text?this.ExportAsciiContent(a,c):b===OV.FileFormat.Binary&&this.ExportBinaryContent(a,c);d()};
OV.ExporterGltf.prototype.ExportAsciiContent=function(a,b){var c=new OV.ExportedFile("model.gltf"),d=new OV.ExportedFile("model.bin");b.push(c);b.push(d);var e=this.GetMeshData(a),f=this.GetMainBuffer(e),g=this.GetMainJson(e);g.buffers.push({uri:d.GetName(),byteLength:f.byteLength});var h=[];this.ExportMaterials(a,g,function(k){var l=OV.GetFileName(k.name),m=h[l];void 0===m&&(m=new OV.ExportedFile(l),m.SetContent(k.buffer),b.push(m),m=g.textures.length,h[l]=m,g.images.push({uri:l}),g.textures.push({source:m}));
return m});c.SetContent(JSON.stringify(g,null,4));d.SetContent(f)};
OV.ExporterGltf.prototype.ExportBinaryContent=function(a,b){function c(t){var v=t%4;return 0===v?t:t+(4-v)}function d(t,v,w){for(var u=0;u<w;u++)t.WriteUnsignedCharacter8(v)}var e=new OV.ExportedFile("model.glb");b.push(e);var f=this.GetMeshData(a);b=this.GetMainBuffer(f);var g=this.GetMainJson(f),h=[],k=b.byteLength,l=[];this.ExportMaterials(a,g,function(t){var v=OV.GetFileName(t.name),w=OV.GetFileExtension(t.name),u=l[v];if(void 0===u){var z=g.bufferViews.length;u=g.textures.length;l[v]=u;t=t.buffer;
h.push(t);g.bufferViews.push({buffer:0,byteOffset:k,byteLength:t.byteLength});k+=t.byteLength;g.images.push({bufferView:z,mimeType:"image/"+w});g.textures.push({source:u})}return u});a=b.byteLength;for(f=0;f<h.length;f++)a+=h[f].byteLength;f=c(a);g.buffers.push({byteLength:f});var m=JSON.stringify(g),p=OV.Utf8StringToArrayBuffer(m),n=p.byteLength,q=c(n),r=20+q+8+f;m=new OV.BinaryWriter(r,!0);m.WriteUnsignedInteger32(1179937895);m.WriteUnsignedInteger32(2);m.WriteUnsignedInteger32(r);m.WriteUnsignedInteger32(q);
m.WriteUnsignedInteger32(1313821514);m.WriteArrayBuffer(p);d(m,32,q-n);m.WriteUnsignedInteger32(f);m.WriteUnsignedInteger32(5130562);m.WriteArrayBuffer(b);for(b=0;b<h.length;b++)m.WriteArrayBuffer(h[b]);d(m,0,f-a);e.SetContent(m.GetBuffer())};OV.ExporterGltf.prototype.GetMeshData=function(a){for(var b=[],c=0;c<a.MeshCount();c++){var d=a.GetMesh(c),e=OV.ConvertMeshToMeshBuffer(d);b.push({name:d.GetName(),buffer:e,offsets:[],sizes:[]})}return b};
OV.ExporterGltf.prototype.GetMainBuffer=function(a){for(var b=0,c=0;c<a.length;c++)b+=a[c].buffer.GetByteLength(this.components.index.size,this.components.number.size);b=new OV.BinaryWriter(b,!0);for(c=0;c<a.length;c++)for(var d=a[c],e=0;e<d.buffer.PrimitiveCount();e++){for(var f=d.buffer.GetPrimitive(e),g=b.GetPosition(),h=0;h<f.indices.length;h++)b.WriteUnsignedInteger32(f.indices[h]);for(h=0;h<f.vertices.length;h++)b.WriteFloat32(f.vertices[h]);for(h=0;h<f.normals.length;h++)b.WriteFloat32(f.normals[h]);
for(h=0;h<f.uvs.length;h++){var k=f.uvs[h];1===h%2&&(k*=-1);b.WriteFloat32(k)}d.offsets.push(g);d.sizes.push(b.GetPosition()-g)}return b.GetBuffer()};
OV.ExporterGltf.prototype.GetMainJson=function(a){var b=function(r,t){this.mainJson=r;this.byteOffset=t};b.prototype.AddBufferView=function(r){this.mainJson.bufferViews.push({buffer:0,byteOffset:this.byteOffset,byteLength:r});this.byteOffset+=r};for(var c={asset:{version:"2.0",generator:"https://3dviewer.net"},scene:0,scenes:[{nodes:[]}],nodes:[],materials:[],meshes:[],buffers:[],bufferViews:[],accessors:[]},d=0;d<a.length;d++){var e=a[d];c.scenes[0].nodes.push(d);c.nodes.push({mesh:d});for(var f=
{name:this.GetExportedMeshName(e.name),primitives:[]},g=e.buffer.primitives,h=0;h<g.length;h++){var k=g[h],l=c.bufferViews.length,m=new b(c,e.offsets[h]);m.AddBufferView(k.indices.length*this.components.index.size);m.AddBufferView(k.vertices.length*this.components.number.size);m.AddBufferView(k.normals.length*this.components.number.size);var p=c.accessors.length,n={attributes:{POSITION:p+1,NORMAL:p+2},indices:p,mode:4,material:k.material},q=k.GetBounds();c.accessors.push({bufferView:l,byteOffset:0,
componentType:this.components.index.type,count:k.indices.length,type:"SCALAR"});c.accessors.push({bufferView:l+1,byteOffset:0,componentType:this.components.number.type,count:k.vertices.length/3,min:q.min,max:q.max,type:"VEC3"});c.accessors.push({bufferView:l+2,byteOffset:0,componentType:this.components.number.type,count:k.normals.length/3,type:"VEC3"});0<k.uvs.length&&(m.AddBufferView(k.uvs.length*this.components.number.size),c.accessors.push({bufferView:l+3,byteOffset:0,componentType:this.components.number.type,
count:k.uvs.length/2,type:"VEC2"}),n.attributes.TEXCOORD_0=p+3);f.primitives.push(n)}c.meshes.push(f)}return c};
OV.ExporterGltf.prototype.ExportMaterials=function(a,b,c){function d(g,h,k,l){function m(q,r){return[OV.SRGBToLinear(q.r/255),OV.SRGBToLinear(q.g/255),OV.SRGBToLinear(q.b/255),r]}function p(q,r,t){if(null===r||!r.IsValid())return null;void 0===q.images&&(q.images=[]);void 0===q.textures&&(q.textures=[]);t={index:t(r)};r.HasTransformation()&&(void 0===q.extensionsUsed&&(q.extensionsUsed=[]),-1===q.extensionsUsed.indexOf("KHR_texture_transform")&&q.extensionsUsed.push("KHR_texture_transform"),t.extensions=
{KHR_texture_transform:{offset:[r.offset.x,-r.offset.y],scale:[r.scale.x,r.scale.y],rotation:-r.rotation}});return t}g={name:g.GetExportedMaterialName(k.name),pbrMetallicRoughness:{baseColorFactor:m(k.diffuse,k.opacity),metallicFactor:0,roughnessFactor:1},emissiveFactor:function(q){return[OV.SRGBToLinear(q.r/255),OV.SRGBToLinear(q.g/255),OV.SRGBToLinear(q.b/255)]}(k.emissive),doubleSided:!0,alphaMode:"OPAQUE"};k.transparent&&(g.alphaMode="BLEND");var n=p(h,k.diffuseMap,l);null!==n&&(k.multiplyDiffuseMap||
(g.pbrMetallicRoughness.baseColorFactor=m(new OV.Color(255,255,255),k.opacity)),g.pbrMetallicRoughness.baseColorTexture=n);n=p(h,k.normalMap,l);null!==n&&(g.normalTexture=n);k=p(h,k.emissiveMap,l);null!==k&&(g.emissiveTexture=k);h.materials.push(g)}for(var e=0;e<a.MaterialCount();e++){var f=a.GetMaterial(e);d(this,b,f,c)}};OV.Exporter=function(){this.exporters=[new OV.ExporterObj,new OV.ExporterStl,new OV.ExporterPly,new OV.ExporterOff,new OV.ExporterGltf]};OV.Exporter.prototype.AddExporter=function(a){this.exporters.push(a)};OV.Exporter.prototype.Export=function(a,b,c,d){for(var e=null,f=0;f<this.exporters.length;f++){var g=this.exporters[f];if(g.CanExport(b,c)){e=g;break}}if(null===e)d.onError();else e.Export(a,b,function(h){if(0===h.length)d.onError();else d.onSuccess(h)})};OV.ExternalLibLocation=null;OV.LoadedExternalLibs={};OV.LoadExternalLibrary=function(a,b){if(null===OV.ExternalLibLocation)b.error();else if(void 0!==OV.LoadedExternalLibs[a])b.success();else{var c=document.createElement("script");c.type="text/javascript";c.src=OV.ExternalLibLocation+"/"+a;c.onload=function(){b.success();OV.LoadedExternalLibs[a]=!0};c.onerror=b.error;document.head.appendChild(c)}};OV.Importer3dm=function(){OV.ImporterBase.call(this);this.rhino=null};$jscomp.inherits(OV.Importer3dm,OV.ImporterBase);OV.Importer3dm.prototype.CanImportExtension=function(a){return"3dm"===a};OV.Importer3dm.prototype.GetKnownFileFormats=function(){return{"3dm":OV.FileFormat.Binary}};OV.Importer3dm.prototype.GetUpDirection=function(){return OV.Direction.Z};OV.Importer3dm.prototype.ClearContent=function(){this.instanceDefinitions=this.instanceObjects=null};
OV.Importer3dm.prototype.ResetContent=function(){this.instanceObjects={};this.instanceDefinitions={}};OV.Importer3dm.prototype.ImportContent=function(a,b){if(null===this.rhino){var c=this;OV.LoadExternalLibrary("rhino3dm.min.js",{success:function(){rhino3dm().then(function(d){c.rhino=d;c.ImportRhinoContent(a);b()})},error:function(){b()}})}else this.ImportRhinoContent(a),b()};
OV.Importer3dm.prototype.ImportRhinoContent=function(a){a=this.rhino.File3dm.fromByteArray(a);null===a?(this.SetError(),this.SetMessage("Failed to read Rhino file.")):(this.ImportRhinoDocument(a),OV.IsModelEmpty(this.model)&&(this.SetError(),this.SetMessage("The model doesn't contain any 3D meshes. Try to save the model while you are in shaded view in Rhino.")))};OV.Importer3dm.prototype.ImportRhinoDocument=function(a){this.InitRhinoInstances(a);this.ImportRhinoGeometry(a)};
OV.Importer3dm.prototype.InitRhinoInstances=function(a){for(var b=a.objects(),c=0;c<b.count;c++){var d=b.get(c),e=d.attributes();e.isInstanceDefinitionObject&&(this.instanceObjects[e.id]=d)}a=a.instanceDefinitions();for(b=0;b<a.count();b++)c=a.get(b),this.instanceDefinitions[c.id]=c};OV.Importer3dm.prototype.ImportRhinoGeometry=function(a){for(var b=a.objects(),c=0;c<b.count;c++){var d=b.get(c);this.ImportRhinoGeometryObject(a,d,[])}};
OV.Importer3dm.prototype.ImportRhinoGeometryObject=function(a,b,c){var d=b.geometry(),e=b.attributes(),f=d.objectType;if(!e.isInstanceDefinitionObject||0!==c.length){e=null;var g=!1;if(f===this.rhino.ObjectType.Mesh)e=d,g=!1;else if(f===this.rhino.ObjectType.Extrusion)e=d.getMesh(this.rhino.MeshType.Any),g=!0;else if(f===this.rhino.ObjectType.Brep){e=new this.rhino.Mesh;g=d.faces();for(d=0;d<g.count;d++){f=g.get(d);var h=f.getMesh(this.rhino.MeshType.Any);h&&(e.append(h),h.delete());f.delete()}g.delete();
e.compact();g=!0}else if(f===this.rhino.ObjectType.SubD)d.subdivide(3),e=this.rhino.Mesh.createFromSubDControlNet(d),g=!0;else if(f===this.rhino.ObjectType.InstanceReference&&(d=this.instanceDefinitions[d.parentIdefId],void 0!==d))for(d=d.getObjectIds(),f=0;f<d.length;f++)h=this.instanceObjects[d[f]],void 0!==h&&(c.push(b),this.ImportRhinoGeometryObject(a,h,c),c.pop());null!==e&&(this.ImportRhinoMesh(a,e,b,c),g&&e.delete())}};
OV.Importer3dm.prototype.ImportRhinoMesh=function(a,b,c,d){var e=c.attributes(),f=new OV.Mesh;f.SetName(e.name);a=this.GetMaterialIndex(a,c,d);e=b.toThreejsJSON();b=e.data.attributes.position.array;for(c=0;c<b.length;c+=3)f.AddVertex(new OV.Coord3D(b[c],b[c+1],b[c+2]));if(b=void 0!==e.data.attributes.normal){c=e.data.attributes.normal.array;for(var g=0;g<c.length;g+=3)f.AddNormal(new OV.Coord3D(c[g],c[g+1],c[g+2]))}if(c=void 0!==e.data.attributes.uv){g=e.data.attributes.uv.array;for(var h=0;h<g.length;h+=
2)f.AddTextureUV(new OV.Coord2D(g[h],g[h+1]))}e=e.data.index.array;for(g=0;g<e.length;g+=3){h=e[g];var k=e[g+1],l=e[g+2],m=new OV.Triangle(h,k,l);b&&m.SetNormals(h,k,l);c&&m.SetTextureUVs(h,k,l);null!==a&&m.SetMaterial(a);f.AddTriangle(m)}if(0!==d.length){a=(new OV.Matrix).CreateIdentity();for(b=d.length-1;0<=b;b--)c=d[b].geometry().xform.toFloatArray(!1),c=new OV.Matrix(c),a=a.MultiplyMatrix(c);d=new OV.Transformation(a);OV.TransformMesh(f,d)}this.model.AddMesh(f)};
OV.Importer3dm.prototype.GetMaterialIndex=function(a,b,c){function d(e,f,g){f=f.attributes();if(f.materialSource===e.ObjectMaterialSource.MaterialFromObject){if(e=f.materialIndex,-1<e)return a.materials().get(e)}else if(f.materialSource===e.ObjectMaterialSource.MaterialFromLayer){if(e=f.layerIndex,-1<e&&(e=a.layers().get(e).renderMaterialIndex,-1<e))return a.materials().get(e)}else if(f.materialSource===e.ObjectMaterialSource.MaterialFromParent&&0!==g.length)return d(e,g[0],[]);return null}b=d(this.rhino,
b,c);return function(e,f){function g(p,n){p.Set(n.r,n.g,n.b)}function h(p){return 0===p.r&&0===p.g&&0===p.b}function k(p){return 255===p.r&&255===p.g&&255===p.b}var l=new OV.Material;null===f?l.diffuse.Set(255,255,255):(l.name=f.name,g(l.ambient,f.ambientColor),g(l.diffuse,f.diffuseColor),g(l.specular,f.specularColor),l.opacity=1-f.transparency,OV.UpdateMaterialTransparency(l),h(l.diffuse)&&!k(f.reflectionColor)&&g(l.diffuse,f.reflectionColor),h(l.diffuse)&&!k(f.transparentColor)&&g(l.diffuse,f.transparentColor));
for(f=0;f<e.MaterialCount();f++){var m=e.GetMaterial(f);if(m.name===l.name&&OV.ColorIsEqual(m.ambient,l.ambient)&&OV.ColorIsEqual(m.diffuse,l.diffuse)&&OV.ColorIsEqual(m.specular,l.specular)&&OV.IsEqual(m.opacity,l.opacity)&&m.transparent===l.transparent&&OV.IsEqual(m.shininess,l.shininess))return f}return e.AddMaterial(l)}(this.model,b)};OV.Exporter3dm=function(){OV.ExporterBase.call(this);this.rhino=null};$jscomp.inherits(OV.Exporter3dm,OV.ExporterBase);OV.Exporter3dm.prototype.CanExport=function(a,b){return a===OV.FileFormat.Binary&&"3dm"===b};OV.Exporter3dm.prototype.ExportContent=function(a,b,c,d){if(null===this.rhino){var e=this;OV.LoadExternalLibrary("rhino3dm.min.js",{success:function(){rhino3dm().then(function(f){e.rhino=f;e.ExportRhinoContent(a,c,d)})},error:function(){d()}})}else this.ExportRhinoContent(a,c,d)};
OV.Exporter3dm.prototype.ExportRhinoContent=function(a,b,c){function d(n){return{r:n.r,g:n.g,b:n.b,a:255}}var e=new OV.ExportedFile("model.3dm");b.push(e);b=new this.rhino.File3dm;for(var f=0;f<a.MeshCount();f++)for(var g=a.GetMesh(f),h=OV.ConvertMeshToMeshBuffer(g),k=0;k<h.PrimitiveCount();k++){var l=h.GetPrimitive(k),m={data:{attributes:{position:{itemSize:3,type:"Float32Array",array:l.vertices},normal:{itemSize:3,type:"Float32Array",array:l.normals}},index:{type:"Uint16Array",array:l.indices}}};
l=a.GetMaterial(l.material);var p=new this.rhino.Material;p.name=this.GetExportedMaterialName(l.name);p.ambientColor=d(l.ambient);p.diffuseColor=d(l.diffuse);p.specularColor=d(l.specular);p.transparency=1-l.opacity;l=b.materials().count();b.materials().add(p);m=new this.rhino.Mesh.createFromThreejsJSON(m);p=new this.rhino.ObjectAttributes;p.name=this.GetExportedMeshName(g.GetName());p.materialSource=this.rhino.ObjectMaterialSource.MaterialFromObject;p.materialIndex=l;b.objects().add(m,p)}a=new this.rhino.File3dmWriteOptions;
a.version=6;a=b.toByteArray(a);e.SetContent(a);c()};OV.HasHighpDriverIssue=function(){var a=document.createElement("canvas");document.body.appendChild(a);var b=new THREE.WebGLRenderer({canvas:a,antialias:!0});b.setClearColor("#ffffff",1);b.setSize(10,10);var c=new THREE.Scene,d=new THREE.AmbientLight(8947848);c.add(d);d=new THREE.DirectionalLight(8947848);d.position.set(0,0,1);c.add(d);d=new THREE.PerspectiveCamera(45,1,.1,1E3);d.position.set(0,0,1);d.up.set(0,1,0);d.lookAt(new THREE.Vector3(0,0,0));c.add(d);var e=new THREE.PlaneGeometry(1,1);e=new THREE.Mesh(e,
new THREE.MeshPhongMaterial({color:13369344}));c.add(e);b.render(c,d);b=b.getContext();c=new Uint8Array(4);b.readPixels(5,5,1,1,b.RGBA,b.UNSIGNED_BYTE,c);document.body.removeChild(a);return 50>c[0]&&50>c[1]&&50>c[2]?!0:!1};OV.ModelToThreeConversionParams=function(){this.forceMediumpForMaterials=!1};
OV.ConvertModelToThreeMeshes=function(a,b,c){function d(l,m){function p(t,v,w){null!==v&&v.IsValid()&&(new THREE.TextureLoader).load(v.url,function(u){u.wrapS=THREE.RepeatWrapping;u.wrapT=THREE.RepeatWrapping;u.rotation=v.rotation;u.offset.x=v.offset.x;u.offset.y=v.offset.y;u.repeat.x=v.scale.x;u.repeat.y=v.scale.y;u.image=OV.ResizeImageToPowerOfTwoSides(u.image);t.needsUpdate=!0;w(u)})}var n=l.GetMaterial(m);l=new THREE.Color(n.diffuse.r/255,n.diffuse.g/255,n.diffuse.b/255);m=new THREE.Color(n.specular.r/
255,n.specular.g/255,n.specular.b/255);var q=new THREE.Color(n.emissive.r/255,n.emissive.g/255,n.emissive.b/255);OV.IsEqual(n.shininess,0)&&m.setRGB(0,0,0);l={color:l,specular:m,emissive:q,shininess:100*n.shininess,opacity:n.opacity,transparent:n.transparent,alphaTest:n.alphaTest,side:THREE.DoubleSide};b.forceMediumpForMaterials&&(l.precision="mediump");var r=new THREE.MeshPhongMaterial(l);p(r,n.diffuseMap,function(t){n.multiplyDiffuseMap||r.color.setRGB(1,1,1);r.map=t;c.onTextureLoaded()});p(r,n.specularMap,
function(t){r.specularMap=t;c.onTextureLoaded()});p(r,n.bumpMap,function(t){r.bumpMap=t;c.onTextureLoaded()});p(r,n.normalMap,function(t){r.normalMap=t;c.onTextureLoaded()});p(r,n.emissiveMap,function(t){r.emissiveMap=t;c.onTextureLoaded()});return r}function e(l,m,p){var n=l.GetMesh(m),q=n.TriangleCount();if(0===q)return null;var r=[];for(l=0;l<q;l++)r.push(l);r.sort(function(F,H){F=n.GetTriangle(F);H=n.GetTriangle(H);return F.mat-H.mat});var t=new THREE.BufferGeometry,v=[];l=[];var w={},u=[],z=
[],x=[],y=[];y.push({start:0,end:-1});for(var A=0<n.TextureUVCount(),C=0;C<r.length;C++){var B=n.GetTriangle(r[C]),D=n.GetVertex(B.v0),E=n.GetVertex(B.v1),G=n.GetVertex(B.v2);u.push(D.x,D.y,D.z,E.x,E.y,E.z,G.x,G.y,G.z);D=n.GetNormal(B.n0);E=n.GetNormal(B.n1);G=n.GetNormal(B.n2);z.push(D.x,D.y,D.z,E.x,E.y,E.z,G.x,G.y,G.z);B.HasTextureUVs()?(D=n.GetTextureUV(B.u0),E=n.GetTextureUV(B.u1),G=n.GetTextureUV(B.u2),x.push(D.x,D.y,E.x,E.y,G.x,G.y)):A&&x.push(0,0,0,0,0,0);B=B.mat;D=w[B];void 0===D&&(D=v.length,
w[B]=D,v.push(p[B]),l.push(B),0<C&&(y[y.length-1].end=C-1,y.push({start:y[y.length-1].end+1,end:-1})))}y[y.length-1].end=q-1;t.setAttribute("position",new THREE.Float32BufferAttribute(u,3));t.setAttribute("normal",new THREE.Float32BufferAttribute(z,3));0!==x.length&&t.setAttribute("uv",new THREE.Float32BufferAttribute(x,2));for(p=0;p<y.length;p++)q=y[p],t.addGroup(3*q.start,3*(q.end-q.start+1),p);p=new THREE.Mesh(t,v);p.userData={originalMeshIndex:m,originalMaterials:l,threeMaterials:null};return p}
for(var f=[],g=0;g<a.MaterialCount();g++){var h=d(a,g);f.push(h)}var k=[];(new OV.TaskRunner).RunBatch(a.MeshCount(),100,{runTask:function(l,m,p){for(;l<=m;l++)if(0<a.GetMesh(l).TriangleCount()){var n=e(a,l,f);k.push(n)}p()},onReady:function(){c.onModelLoaded(k)}})};OV.ThreeModelLoader=function(){this.importer=new OV.Importer;this.importer.AddImporter(new OV.Importer3dm);this.callbacks=null;this.inProgress=!1;this.hasHighpDriverIssue=OV.HasHighpDriverIssue()};OV.ThreeModelLoader.prototype.Init=function(a){this.callbacks=a};OV.ThreeModelLoader.prototype.LoadFromUrlList=function(a,b){if(!this.inProgress){var c=this;this.inProgress=!0;this.callbacks.onLoadStart();this.importer.LoadFilesFromUrls(a,function(){c.OnFilesLoaded(b)})}};
OV.ThreeModelLoader.prototype.LoadFromFileList=function(a,b){if(!this.inProgress){var c=this;this.inProgress=!0;this.callbacks.onLoadStart();this.importer.LoadFilesFromFileObjects(a,function(){c.OnFilesLoaded(b)})}};OV.ThreeModelLoader.prototype.ReloadFiles=function(a){this.inProgress||(this.inProgress=!0,this.callbacks.onLoadStart(),this.OnFilesLoaded(a))};
OV.ThreeModelLoader.prototype.OnFilesLoaded=function(a){var b=this;this.callbacks.onImportStart();OV.RunTaskAsync(function(){b.importer.Import(a,{onSuccess:function(c){b.OnModelImported(c)},onError:function(c){b.callbacks.onLoadError(c);b.inProgress=!1}})})};
OV.ThreeModelLoader.prototype.OnModelImported=function(a){var b=this;this.callbacks.onVisualizationStart();var c=new OV.ModelToThreeConversionParams;c.forceMediumpForMaterials=this.hasHighpDriverIssue;OV.ConvertModelToThreeMeshes(a.model,c,{onTextureLoaded:function(){b.callbacks.onTextureLoaded()},onModelLoaded:function(d){b.callbacks.onModelFinished(a,d);b.inProgress=!1}})};OV.ThreeModelLoader.prototype.GetImporter=function(){return this.importer};OV.ParameterConverter={IntegerToString:function(a){return a.toString()},StringToInteger:function(a){return parseInt(a,10)},NumberToString:function(a){return a.toPrecision(5)},StringToNumber:function(a){return parseFloat(a)},ModelUrlsToString:function(a){return null===a?null:a.join(",")},StringToModelUrls:function(a){return null===a||0===a.length?null:a.split(",")},CameraToString:function(a){return null===a?null:[this.NumberToString(a.eye.x),this.NumberToString(a.eye.y),this.NumberToString(a.eye.z),
this.NumberToString(a.center.x),this.NumberToString(a.center.y),this.NumberToString(a.center.z),this.NumberToString(a.up.x),this.NumberToString(a.up.y),this.NumberToString(a.up.z)].join()},StringToCamera:function(a){if(null===a||0===a.length)return null;a=a.split(",");return 9!==a.length?null:new OV.Camera(new OV.Coord3D(this.StringToNumber(a[0]),this.StringToNumber(a[1]),this.StringToNumber(a[2])),new OV.Coord3D(this.StringToNumber(a[3]),this.StringToNumber(a[4]),this.StringToNumber(a[5])),new OV.Coord3D(this.StringToNumber(a[6]),
this.StringToNumber(a[7]),this.StringToNumber(a[8])))},ColorToString:function(a){return null===a?null:[this.IntegerToString(a.r),this.IntegerToString(a.g),this.IntegerToString(a.b)].join()},StringToColor:function(a){if(null===a||0===a.length)return null;if("#"===a[0])return a=parseInt(a.substr(1),16),new OV.Color(a>>16&255,a>>8&255,a&255);a=a.split(",");return 3!==a.length?null:new OV.Color(this.StringToInteger(a[0]),this.StringToInteger(a[1]),this.StringToInteger(a[2]))}};
OV.ParameterListBuilder=function(a){this.separator=a;this.paramList=""};OV.ParameterListBuilder.prototype.AddModelUrls=function(a){this.AddUrlPart("model",OV.ParameterConverter.ModelUrlsToString(a));return this};OV.ParameterListBuilder.prototype.AddCamera=function(a){this.AddUrlPart("camera",OV.ParameterConverter.CameraToString(a));return this};OV.ParameterListBuilder.prototype.AddColor=function(a){this.AddUrlPart("color",OV.ParameterConverter.ColorToString(a));return this};
OV.ParameterListBuilder.prototype.AddUrlPart=function(a,b){null!==a&&null!==b&&(0<this.paramList.length&&(this.paramList+=this.separator),this.paramList+=a+"="+b)};OV.ParameterListBuilder.prototype.GetParameterList=function(){return this.paramList};OV.ParameterListParser=function(a,b){this.separator=b;this.paramList=a};OV.ParameterListParser.prototype.GetModelUrls=function(){if(-1===this.paramList.indexOf("="))return this.paramList.split(",");var a=this.GetKeywordParams("model");return OV.ParameterConverter.StringToModelUrls(a)};
OV.ParameterListParser.prototype.GetCamera=function(){var a=this.GetKeywordParams("camera");return OV.ParameterConverter.StringToCamera(a)};OV.ParameterListParser.prototype.GetColor=function(){var a=this.GetKeywordParams("color");return OV.ParameterConverter.StringToColor(a)};OV.ParameterListParser.prototype.GetKeywordParams=function(a){if(null===this.paramList||0===this.paramList.length)return null;a+="=";for(var b=this.paramList.split(this.separator),c=0;c<b.length;c++){var d=b[c];if(d.startsWith(a))return d.substr(a.length)}return null};
OV.CreateUrlBuilder=function(){return new OV.ParameterListBuilder("$")};OV.CreateUrlParser=function(a){return new OV.ParameterListParser(a,"$")};OV.CreateModelUrlParameters=function(a){var b=OV.CreateUrlBuilder();b.AddModelUrls(a);return b.GetParameterList()};OV.GetInnerDimensions=function(a,b,c){function d(e){return Math.round(parseFloat(e))}a=getComputedStyle(a);b=b-d(a.borderLeftWidth)-d(a.borderRightWidth)-d(a.marginLeft)-d(a.marginRight)-d(a.paddingLeft)-d(a.paddingRight);c=c-d(a.borderTopWidth)-d(a.borderBottomWidth)-d(a.marginTop)-d(a.marginBottom)-d(a.paddingTop)-d(a.paddingBottom);return{width:b,height:c}};OV.GetClientCoordinates=function(a,b,c){a.getBoundingClientRect&&(a=a.getBoundingClientRect(),b-=a.left,c-=a.top);window.pageXOffset&&window.pageYOffset&&(b+=window.pageXOffset,c+=window.pageYOffset);return new OV.Coord2D(b,c)};OV.Camera=function(a,b,c){this.eye=a;this.center=b;this.up=c};OV.Camera.prototype.Clone=function(){return new OV.Camera(this.eye.Clone(),this.center.Clone(),this.up.Clone())};
OV.MouseInteraction=function(){this.prev=new OV.Coord2D(0,0);this.curr=new OV.Coord2D(0,0,0);this.diff=new OV.Coord2D(0,0);this.buttons=[]};OV.MouseInteraction.prototype.Down=function(a,b){this.buttons.push(b.which);this.curr=this.GetCurrent(a,b);this.prev=this.curr.Clone()};OV.MouseInteraction.prototype.Move=function(a,b){this.curr=this.GetCurrent(a,b);this.diff=OV.SubCoord2D(this.curr,this.prev);this.prev=this.curr.Clone()};
OV.MouseInteraction.prototype.Up=function(a,b){var c=this.buttons.indexOf(b.which);-1!==c&&this.buttons.splice(c,1);this.curr=this.GetCurrent(a,b)};OV.MouseInteraction.prototype.Leave=function(a,b){this.buttons=[];this.curr=this.GetCurrent(a,b)};OV.MouseInteraction.prototype.IsButtonDown=function(){return 0<this.buttons.length};OV.MouseInteraction.prototype.GetButton=function(){var a=this.buttons.length;return 0===a?0:this.buttons[a-1]};OV.MouseInteraction.prototype.GetMoveDiff=function(){return this.diff};
OV.MouseInteraction.prototype.GetCurrent=function(a,b){return OV.GetClientCoordinates(a,b.clientX,b.clientY)};OV.TouchInteraction=function(){this.prevPos=new OV.Coord2D(0,0);this.currPos=new OV.Coord2D(0,0,0);this.diffPos=new OV.Coord2D(0,0);this.fingers=this.diffDist=this.currDist=this.prevDist=0};
OV.TouchInteraction.prototype.Start=function(a,b){0!==b.touches.length&&(this.fingers=b.touches.length,this.currPos=this.GetCurrent(a,b),this.prevPos=this.currPos.Clone(),this.prevDist=this.currDist=this.GetTouchDistance(a,b))};
OV.TouchInteraction.prototype.Move=function(a,b){0!==b.touches.length&&(this.currPos=this.GetCurrent(a,b),this.diffPos=OV.SubCoord2D(this.currPos,this.prevPos),this.prevPos=this.currPos.Clone(),this.currDist=this.GetTouchDistance(a,b),this.diffDist=this.currDist-this.prevDist,this.prevDist=this.currDist)};OV.TouchInteraction.prototype.End=function(a,b){0!==b.touches.length&&(this.fingers=0,this.currPos=this.GetCurrent(a,b),this.currDist=this.GetTouchDistance(a,b))};
OV.TouchInteraction.prototype.IsFingerDown=function(){return 0!==this.fingers};OV.TouchInteraction.prototype.GetFingerCount=function(){return this.fingers};OV.TouchInteraction.prototype.GetMoveDiff=function(){return this.diffPos};OV.TouchInteraction.prototype.GetDistanceDiff=function(){return this.diffDist};OV.TouchInteraction.prototype.GetCurrent=function(a,b){var c=null;0!==b.touches.length&&(b=b.touches[0],c=OV.GetClientCoordinates(a,b.pageX,b.pageY));return c};
OV.TouchInteraction.prototype.GetTouchDistance=function(a,b){if(2!==b.touches.length)return 0;var c=b.touches[0];b=b.touches[1];return OV.CoordDistance2D(OV.GetClientCoordinates(a,c.pageX,c.pageY),OV.GetClientCoordinates(a,b.pageX,b.pageY))};OV.ClickDetector=function(){this.isClick=!1;this.button=0};OV.ClickDetector.prototype.Down=function(a){this.isClick=!0;this.button=a.which};OV.ClickDetector.prototype.Move=function(){this.isClick=!1};
OV.ClickDetector.prototype.Up=function(a){this.isClick&&a.which!==this.button&&(this.isClick=!1)};OV.ClickDetector.prototype.Leave=function(a){this.isClick=!1;this.button=0};OV.ClickDetector.prototype.IsClick=function(){return this.isClick};
OV.Navigation=function(a,b){this.canvas=a;this.camera=b;this.orbitCenter=this.camera.center.Clone();this.fixUpVector=!0;this.zoomFactor=this.boundingSphereRadius=null;this.mouse=new OV.MouseInteraction;this.touch=new OV.TouchInteraction;this.clickDetector=new OV.ClickDetector;this.onMove=this.onClick=this.onUpdate=null;this.canvas.addEventListener&&(this.canvas.addEventListener("mousedown",this.OnMouseDown.bind(this)),this.canvas.addEventListener("wheel",this.OnMouseWheel.bind(this)),this.canvas.addEventListener("touchstart",
this.OnTouchStart.bind(this)),this.canvas.addEventListener("touchmove",this.OnTouchMove.bind(this)),this.canvas.addEventListener("touchend",this.OnTouchEnd.bind(this)),this.canvas.addEventListener("contextmenu",this.OnContextMenu.bind(this)));document.addEventListener&&(document.addEventListener("mousemove",this.OnMouseMove.bind(this)),document.addEventListener("mouseup",this.OnMouseUp.bind(this)),document.addEventListener("mouseleave",this.OnMouseLeave.bind(this)))};
OV.Navigation.prototype.SetZoomFactor=function(a){null!==a&&(this.zoomFactor=parseInt(a))};OV.Navigation.prototype.SetBoundingSphereRadius=function(a){null!==this.zoomFactor&&(this.boundingSphereRadius=a)};OV.Navigation.prototype.SetUpdateHandler=function(a){this.onUpdate=a};OV.Navigation.prototype.SetClickHandler=function(a){this.onClick=a};OV.Navigation.prototype.SetMoveHandler=function(a){this.onMove=a};OV.Navigation.prototype.IsFixUpVector=function(){return this.fixUpVector};
OV.Navigation.prototype.SetFixUpVector=function(a){this.fixUpVector=a};OV.Navigation.prototype.GetCamera=function(){return this.camera};OV.Navigation.prototype.SetCamera=function(a){this.camera=a};
OV.Navigation.prototype.MoveCamera=function(a,b){function c(g,h,k,l){g.camera.eye=h.eye[l];g.camera.center=h.center[l];g.camera.up=h.up[l];g.Update();l<k-1&&requestAnimationFrame(function(){c(g,h,k,l+1)})}if(null!==a)if(0===b)this.SetCamera(a);else if(!(OV.CoordIsEqual3D(this.camera.eye,a.eye)&&OV.CoordIsEqual3D(this.camera.center,a.center)&&OV.CoordIsEqual3D(this.camera.up,a.up))){var d=OV.ParabolicTweenFunction,e=this,f={eye:OV.TweenCoord3D(this.camera.eye,a.eye,b,d),center:OV.TweenCoord3D(this.camera.center,
a.center,b,d),up:OV.TweenCoord3D(this.camera.up,a.up,b,d)};requestAnimationFrame(function(){c(e,f,b,0)});this.Update()}};OV.Navigation.prototype.FitToSphere=function(a,b,c){OV.IsZero(b)||(this.camera=this.GetFitToSphereCamera(a,b,c),this.orbitCenter=this.camera.center.Clone(),this.Update())};
OV.Navigation.prototype.GetFitToSphereCamera=function(a,b,c){if(OV.IsZero(b))return null;var d=this.camera.Clone(),e=OV.SubCoord3D(d.center,a);d.eye=OV.SubCoord3D(d.eye,e);d.center=a.Clone();a=OV.SubCoord3D(d.eye,d.center).Normalize();c/=2;this.canvas.width<this.canvas.height&&(c=c*this.canvas.width/this.canvas.height);b/=Math.sin(c*OV.DegRad);d.eye=d.center.Clone().Offset(a,b);this.orbitCenter=d.center.Clone();return d};
OV.Navigation.prototype.OnMouseDown=function(a){a.preventDefault();this.mouse.Down(this.canvas,a);this.clickDetector.Down(a)};
OV.Navigation.prototype.OnMouseMove=function(a){this.mouse.Move(this.canvas,a);this.clickDetector.Move();this.onMove&&this.Move(a.clientX,a.clientY);if(this.mouse.IsButtonDown()){a=this.mouse.GetMoveDiff();var b=this.mouse.GetButton();if(1===b)this.Orbit(.5*a.x,.5*a.y);else if(2===b||3===b)b=.001*OV.CoordDistance3D(this.camera.eye,this.camera.center),this.Pan(a.x*b,a.y*b);this.Update()}};
OV.Navigation.prototype.OnMouseUp=function(a){this.mouse.Up(this.canvas,a);this.clickDetector.Up(a);this.clickDetector.IsClick()&&this.Click(a.which,a.ctrlKey||a.metaKey,a.clientX,a.clientY)};OV.Navigation.prototype.OnMouseLeave=function(a){this.mouse.Leave(this.canvas,a);this.clickDetector.Leave(a)};OV.Navigation.prototype.OnTouchStart=function(a){a.preventDefault();this.onMove&&this.clickDetector.Down(this.canvas,a);this.touch.Start(this.canvas,a)};
OV.Navigation.prototype.OnTouchMove=function(a){a.preventDefault();this.touch.Move(this.canvas,a);this.onMove&&this.clickDetector.Move(a);if(this.touch.IsFingerDown()){a=this.touch.GetMoveDiff();var b=this.touch.GetDistanceDiff(),c=this.touch.GetFingerCount();1===c?this.Orbit(.5*a.x,.5*a.y):2===c&&(this.Zoom(.005*b),b=.001*OV.CoordDistance3D(this.camera.eye,this.camera.center),this.Pan(a.x*b,a.y*b));this.Update()}};
OV.Navigation.prototype.OnTouchEnd=function(a){a.preventDefault();this.touch.End(this.canvas,a);this.onMove&&(this.clickDetector.IsClick()&&this.Click(1,!1,a.changedTouches[0].clientX,a.changedTouches[0].clientY),this.clickDetector.Up(a))};OV.Navigation.prototype.OnMouseWheel=function(a){a.preventDefault();var b=.1;0>-(a||window.event).deltaY/40&&(b*=-1);this.Zoom(b);this.Update()};OV.Navigation.prototype.OnContextMenu=function(a){a.preventDefault()};
OV.Navigation.prototype.Orbit=function(a,b){a*=OV.DegRad;b*=OV.DegRad;var c=OV.SubCoord3D(this.camera.center,this.camera.eye).Normalize(),d=OV.CrossVector3D(c,this.camera.up).Normalize(),e=!OV.CoordIsEqual3D(this.orbitCenter,this.camera.center);this.fixUpVector?(c=OV.VectorAngle3D(c,this.camera.up)+b,OV.IsGreater(c,0)&&OV.IsLower(c,Math.PI)&&(this.camera.eye.Rotate(d,-b,this.orbitCenter),e&&this.camera.center.Rotate(d,-b,this.orbitCenter)),this.camera.eye.Rotate(this.camera.up,-a,this.orbitCenter),
e&&this.camera.center.Rotate(this.camera.up,-a,this.orbitCenter)):(c=OV.CrossVector3D(d,c).Normalize(),this.camera.eye.Rotate(d,-b,this.orbitCenter),this.camera.eye.Rotate(c,-a,this.orbitCenter),e&&(this.camera.center.Rotate(d,-b,this.orbitCenter),this.camera.center.Rotate(c,-a,this.orbitCenter)),this.camera.up=c)};
OV.Navigation.prototype.Pan=function(a,b){var c=OV.SubCoord3D(this.camera.center,this.camera.eye).Normalize(),d=OV.CrossVector3D(c,this.camera.up).Normalize();c=OV.CrossVector3D(d,c).Normalize();this.camera.eye.Offset(d,-a);this.camera.center.Offset(d,-a);this.camera.eye.Offset(c,b);this.camera.center.Offset(c,b)};
OV.Navigation.prototype.Zoom=function(a){if(0!==this.zoomFactor){var b=OV.SubCoord3D(this.camera.center,this.camera.eye),c=b.Length();a*=c;var d=this.zoomFactor*this.boundingSphereRadius/100,e=10*this.zoomFactor*this.boundingSphereRadius;null!==this.boundingSphereRadius&&c<d&&(this.camera.eye=this.camera.center.Clone().Offset(b,-d));null!==this.boundingSphereRadius&&c>e&&(this.camera.eye=OV.AddCoord3D(this.camera.center,b.Clone().MultiplyScalar(-e/c)));this.camera.eye.Offset(b,a)}};
OV.Navigation.prototype.Update=function(){if(this.onUpdate)this.onUpdate()};OV.Navigation.prototype.Click=function(a,b,c,d){this.onClick&&(c=OV.GetClientCoordinates(this.canvas,c,d),this.onClick(a,b,c))};OV.Navigation.prototype.Move=function(a,b){a=OV.GetClientCoordinates(this.canvas,a,b);b=window.devicePixelRatio||1;a.x*=b;a.y*=b;if(0<=a.x&&a.x<this.canvas.width&&0<=a.y&&a.y<this.canvas.height)this.onMove(a)};OV.NavCubeParams={champer:.15,faceColor:14079964,edgeColor:11650516,vertexColor:7440282,hoverColor:13231608};
OV.NavCubeInteraction=function(a){this.navCube=a;this.activePlane=0;this.oldPosition=new THREE.Vector3;this.newPosition=new THREE.Vector3;this.mouse=new OV.MouseInteraction;this.clickDetector=new OV.ClickDetector;this.touch=new OV.TouchInteraction;this.canvas=this.navCube.renderer.domElement;this.canvas.addEventListener&&(this.canvas.addEventListener("mousedown",this.OnMouseDown.bind(this)),this.canvas.addEventListener("touchstart",this.OnTouchStart.bind(this)),this.canvas.addEventListener("touchmove",
this.OnTouchMove.bind(this)),this.canvas.addEventListener("touchend",this.OnTouchEnd.bind(this)),this.canvas.addEventListener("mouseleave",this.OnCanvasMouseLeave.bind(this)));document.addEventListener&&(document.addEventListener("mousemove",this.OnMouseMove.bind(this)),document.addEventListener("mouseup",this.OnMouseUp.bind(this)),document.addEventListener("mouseleave",this.OnMouseLeave.bind(this)))};
OV.NavCubeInteraction.prototype.OnMouseMove=function(a){var b=OV.GetClientCoordinates(this.canvas,a.clientX,a.clientY);if((0>b.x||b.x>this.canvas.width||0>b.y||b.y>this.canvas.height)&&!this.mouse.IsButtonDown())return!1;a.preventDefault();this.mouse.Move(this.canvas,a);this.clickDetector.Move();if(this.mouse.IsButtonDown())return a=this.mouse.GetMoveDiff(),1===this.mouse.GetButton()&&this.navCube.Orbit(.5*a.x,.5*a.y),!1;this.navCube.Intersect(b)};
OV.NavCubeInteraction.prototype.OnMouseDown=function(a){a.preventDefault();this.mouse.Down(this.canvas,a);this.clickDetector.Down(a)};OV.NavCubeInteraction.prototype.OnMouseUp=function(a){this.mouse.Up(this.canvas,a);this.clickDetector.Up(a);this.clickDetector.IsClick()&&(a=OV.GetClientCoordinates(this.canvas,a.clientX,a.clientY),this.navCube.Intersect(a),this.navCube.Click())};OV.NavCubeInteraction.prototype.OnMouseLeave=function(a){this.mouse.Leave(this.canvas,a);this.clickDetector.Leave(a)};
OV.NavCubeInteraction.prototype.OnCanvasMouseLeave=function(a){this.navCube.ResetSelection();this.navCube.Render()};OV.NavCubeInteraction.prototype.OnTouchMove=function(a){a.preventDefault();this.touch.Move(this.canvas,a);this.touch.IsFingerDown()&&(a=this.touch.GetMoveDiff(),1===this.touch.GetFingerCount()&&this.navCube.Orbit(.5*a.x,.5*a.y))};OV.NavCubeInteraction.prototype.OnTouchStart=function(a){a.preventDefault();this.clickDetector.Down(this.canvas,a);this.touch.Start(this.canvas,a)};
OV.NavCubeInteraction.prototype.OnTouchEnd=function(a){a.preventDefault();this.touch.End(this.canvas,a);if(this.clickDetector.IsClick()){var b=OV.GetClientCoordinates(this.canvas,a.changedTouches[0].clientX,a.changedTouches[0].clientY);this.navCube.Intersect(b);this.navCube.Click()}this.clickDetector.Up(a)};
OV.NavCube=function(a,b,c){this.params=Object.assign(OV.NavCubeParams,a);this.params.hoverColor=new THREE.Color(this.params.hoverColor);this.cubeMesh=new THREE.Mesh;this.canvas=c;this.canvas.classList.add("navcube");this.renderer=new THREE.WebGLRenderer({canvas:this.canvas,antialias:!0,alpha:!0});window.devicePixelRatio&&this.renderer.setPixelRatio(window.devicePixelRatio);this.renderer.setSize(this.canvas.width,this.canvas.height);this.scene=new THREE.Scene;this.scene.background=null;this.initCamera();
this.viewer=b;this.planes=[];this.createMainFacets();this.createEdgeFacets();this.createCornerFacets();this.createLabels();this.scene.add(this.cubeMesh);this.Render();this.addEvents()};OV.NavCube.prototype.addEvents=function(){this.interaction=new OV.NavCubeInteraction(this)};OV.NavCube.prototype.ResetSelection=function(){this.activePlane&&(this.activePlane.material.color=this.activePlane.material.initialColor,this.activePlane.material.needsUpdate=!0,this.activePlane=null)};
OV.NavCube.prototype.Intersect=function(a){this.ResetSelection();var b=this.renderer.getSize(new THREE.Vector2);a=new THREE.Vector2(a.x/b.width*2-1,-a.y/b.height*2+1);b=new THREE.Raycaster;b.setFromCamera(a,this.camera);a=b.intersectObjects(this.planes,!0);0<a.length&&(this.activePlane=a[0].object,this.activePlane.material.color!==new THREE.Color(this.params.hoverColor)&&(this.activePlane.material.initialColor=this.activePlane.material.color),this.activePlane.material.color=new THREE.Color(this.params.hoverColor),
this.activePlane.material.needsUpdate=!0,this.activeFaceNormal=a[0].face.normal.clone(),this.Render())};OV.NavCube.prototype.Orbit=function(a,b){a*=OV.DegRad;b*=OV.DegRad;var c=this.getMainCamera(),d=OV.SubCoord3D(c.camera.center,c.camera.eye).Normalize(),e=OV.CrossVector3D(d,c.camera.up).Normalize();d=OV.VectorAngle3D(d,c.camera.up)+b;OV.IsGreater(d,0)&&OV.IsLower(d,Math.PI)&&c.camera.eye.Rotate(e,-b,c.camera.center);c.camera.eye.Rotate(c.camera.up,-a,c.camera.center);this.viewer.Render()};
OV.NavCube.prototype.Click=function(){if(!this.activePlane||!this.interaction.clickDetector.IsClick())return!1;this.onSideClicked(this.activeFaceNormal)};OV.NavCube.prototype.getMainCamera=function(){var a=this.viewer.navigation.GetCamera(),b=new THREE.Vector3(a.center.x,a.center.y,a.center.z);return{camera:a,center:b,position:this.viewer.camera.position}};
OV.NavCube.prototype.onSideClicked=function(a){var b=this.activePlane.userData.sides&OV.NavCube.Top?new OV.Coord3D(0,1,0):this.activePlane.userData.sides&OV.NavCube.Bottom?new OV.Coord3D(0,-1,0):new OV.Coord3D(0,0,1);this.viewer.SetCameraViewDirection(new OV.Coord3D(-a.x,-a.y,-a.z),!0,b)};OV.NavCube.prototype.initCamera=function(){this.camera=new THREE.PerspectiveCamera(45,this.canvas.width/this.canvas.height,.1,1E3)};
OV.NavCube.prototype.ResizedRenderer=function(a,b){window.devicePixelRatio&&this.renderer.setPixelRatio(window.devicePixelRatio);this.camera.aspect=a/b;this.camera.updateProjectionMatrix();this.renderer.setSize(a,b);this.Render()};OV.NavCube.prototype.Render=function(){var a=this.getMainCamera();this.camera.rotation.copy(this.viewer.camera.rotation);a=a.position.clone().sub(a.center).normalize();this.camera.position.copy(a.multiplyScalar(2.5));this.renderer.render(this.scene,this.camera)};
OV.NavCube.prototype.createMainFacets=function(){var a=this,b=1-Math.sqrt(2)*this.params.champer;b=(new THREE.PlaneGeometry(b,b)).translate(0,0,.5);var c=Math.PI/2,d=[];d[OV.NavCube.Front]=b.clone().rotateX(c);d[OV.NavCube.Back]=b.clone().rotateX(-c).rotateY(Math.PI);d[OV.NavCube.Left]=b.clone().rotateY(-c).rotateX(c);d[OV.NavCube.Right]=b.clone().rotateY(c).rotateX(c);d[OV.NavCube.Top]=b.clone();d[OV.NavCube.Bottom]=b.clone().rotateX(-Math.PI);d.forEach(function(e,f){e=new THREE.Mesh(e,new THREE.MeshBasicMaterial);
e.userData.sides=f;a.cubeMesh.add(e);a.planes.push(e)})};
OV.NavCube.prototype.createEdgeFacets=function(){var a=this,b=new THREE.PlaneGeometry(this.params.champer,1-Math.sqrt(2)*this.params.champer),c=new THREE.MeshBasicMaterial({color:this.params.edgeColor}),d=Math.PI/2,e=Math.PI/4,f=[];b.translate(0,0,Math.sqrt(2)/2-this.params.champer/2);f[OV.NavCube.Front|OV.NavCube.Right]=b.clone().rotateX(d).rotateZ(e);f[OV.NavCube.Right|OV.NavCube.Back]=f[OV.NavCube.Front|OV.NavCube.Right].clone().rotateZ(d);f[OV.NavCube.Back|OV.NavCube.Left]=f[OV.NavCube.Right|
OV.NavCube.Back].clone().rotateZ(d);f[OV.NavCube.Left|OV.NavCube.Front]=f[OV.NavCube.Back|OV.NavCube.Left].clone().rotateZ(d);f[OV.NavCube.Top|OV.NavCube.Right]=b.clone().rotateY(e);f[OV.NavCube.Top|OV.NavCube.Back]=f[OV.NavCube.Top|OV.NavCube.Right].clone().rotateZ(d);f[OV.NavCube.Top|OV.NavCube.Left]=f[OV.NavCube.Top|OV.NavCube.Back].clone().rotateZ(d);f[OV.NavCube.Top|OV.NavCube.Front]=f[OV.NavCube.Top|OV.NavCube.Left].clone().rotateZ(d);f[OV.NavCube.Bottom|OV.NavCube.Right]=b.clone().rotateY(e+
d);f[OV.NavCube.Bottom|OV.NavCube.Back]=f[OV.NavCube.Bottom|OV.NavCube.Right].clone().rotateZ(d);f[OV.NavCube.Bottom|OV.NavCube.Left]=f[OV.NavCube.Bottom|OV.NavCube.Back].clone().rotateZ(d);f[OV.NavCube.Bottom|OV.NavCube.Front]=f[OV.NavCube.Bottom|OV.NavCube.Left].clone().rotateZ(d);var g=new THREE.Vector3;f.forEach(function(h,k){var l=c.clone();l=new THREE.Mesh(h,l);l.userData.sides=k;a.cubeMesh.add(l);a.planes.push(l.clone());k=h.getAttribute("position");h=[];h.push(g.fromBufferAttribute(k,0).clone());
h.push(g.fromBufferAttribute(k,1).clone());h.push(g.fromBufferAttribute(k,3).clone());h.push(g.fromBufferAttribute(k,2).clone());h.push(g.fromBufferAttribute(k,0).clone());k=new THREE.LineBasicMaterial({color:"black"});h=new THREE.Line((new THREE.BufferGeometry).setFromPoints(h),k);l.add(h)})};
OV.NavCube.prototype.getClosestVertex=function(a,b){var c=new THREE.Vector3;a=a.geometry.getAttribute("position");for(var d=c.fromBufferAttribute(a,0).clone(),e=d.distanceTo(b),f=1;f<a.count;f++){var g=c.fromBufferAttribute(a,f).distanceTo(b);g<e&&(e=g,d=c.fromBufferAttribute(a,f).clone())}return d};OV.NavCube.prototype.getMeshOfSide=function(a){return this.cubeMesh.children.find(function(b){return b.userData.sides===a})};
OV.NavCube.prototype.getTriangleOfSides=function(a,b,c,d){return new THREE.Triangle(this.getClosestVertex(this.getMeshOfSide(a),d),this.getClosestVertex(this.getMeshOfSide(b),d),this.getClosestVertex(this.getMeshOfSide(c),d))};
OV.NavCube.prototype.createCornerMesh=function(a,b,c,d){var e=new THREE.BufferGeometry,f=this.getTriangleOfSides(a,b,c,d);d=[];d.push(f.a);d.push(f.b);d.push(f.c);f=new THREE.MeshBasicMaterial({color:this.params.vertexColor});e.setFromPoints(d);e.computeVertexNormals();e=new THREE.Mesh(e,f);e.userData.sides=a|b|c;return e};
OV.NavCube.prototype.createCornerFacets=function(){var a=this.createCornerMesh(OV.NavCube.Left,OV.NavCube.Front,OV.NavCube.Top,new THREE.Vector3(-1,-1,1));this.cubeMesh.add(a);this.planes.push(a);a=this.createCornerMesh(OV.NavCube.Front,OV.NavCube.Right,OV.NavCube.Top,new THREE.Vector3(1,-1,1));this.cubeMesh.add(a);this.planes.push(a);a=this.createCornerMesh(OV.NavCube.Right,OV.NavCube.Back,OV.NavCube.Top,new THREE.Vector3(1,1,1));this.cubeMesh.add(a);this.planes.push(a);a=this.createCornerMesh(OV.NavCube.Back,
OV.NavCube.Left,OV.NavCube.Top,new THREE.Vector3(-1,1,1));this.cubeMesh.add(a);this.planes.push(a);a=this.createCornerMesh(OV.NavCube.Front,OV.NavCube.Left,OV.NavCube.Bottom,new THREE.Vector3(-1,-1,-1));this.cubeMesh.add(a);this.planes.push(a);a=this.createCornerMesh(OV.NavCube.Right,OV.NavCube.Front,OV.NavCube.Bottom,new THREE.Vector3(1,-1,-1));this.cubeMesh.add(a);this.planes.push(a);a=this.createCornerMesh(OV.NavCube.Back,OV.NavCube.Right,OV.NavCube.Bottom,new THREE.Vector3(1,1,-1));this.cubeMesh.add(a);
this.planes.push(a);a=this.createCornerMesh(OV.NavCube.Left,OV.NavCube.Back,OV.NavCube.Bottom,new THREE.Vector3(-1,1,-1));this.cubeMesh.add(a);this.planes.push(a)};
OV.NavCube.prototype.createLabels=function(){var a=[OV.NavCube.Front,OV.NavCube.Back,OV.NavCube.Left,OV.NavCube.Right,OV.NavCube.Top,OV.NavCube.Bottom],b="Front Back Left Right Top Bottom".split(" "),c=72,d=document.createElement("canvas");d.width=256;d.height=256;d=d.getContext("2d");d.font="bold "+c+"px Arial";d=256/d.measureText("Bottom").width;c=Math.round(c*d*.9);for(d=0;d<a.length;d++){var e=a[d],f=b[d],g=document.createElement("canvas");g.width=256;g.height=256;var h=g.getContext("2d");h.fillStyle=
"#"+this.params.faceColor.toString(16);h.fillRect(0,0,g.width,g.height);h.font="bold "+c+"px Arial";h.textAlign="center";h.textBaseline="middle";h.fillStyle="black";h.fillText(f,g.width/2,g.height/2);this.getMeshOfSide(e).material.map=new THREE.CanvasTexture(g)}};
$jscomp.global.Object.defineProperties(OV.NavCube,{Front:{configurable:!0,enumerable:!0,get:function(){return 1}},Back:{configurable:!0,enumerable:!0,get:function(){return 2}},Left:{configurable:!0,enumerable:!0,get:function(){return 4}},Right:{configurable:!0,enumerable:!0,get:function(){return 8}},Top:{configurable:!0,enumerable:!0,get:function(){return 16}},Bottom:{configurable:!0,enumerable:!0,get:function(){return 32}}});OV.CutPlane=function(a,b,c){c=void 0===c?OV.Slider:c;this.viewer=a;a=a.GetBoundingSphere(function(){return!0});if(null!==a){var d=new THREE.PlaneGeometry(2.2*a.radius,2.2*a.radius),e=a.center.clone();this.normal=(new THREE.Vector3).subVectors(e,this.viewer.camera.position);this.normal.normalize();this.cutPlanePos=this.viewer.camera.position.clone();this.cutPlaneDistance=e.distanceTo(this.viewer.camera.position);this.maxPlaneDistance=e.clone().addScaledVector(this.normal,a.radius).distanceTo(this.viewer.camera.position);
this.minPlaneDistance=e.clone().addScaledVector(this.normal,-a.radius).distanceTo(this.viewer.camera.position);this.cutPlane=new THREE.Plane;this.cutPlane.setFromNormalAndCoplanarPoint(this.normal,e);this.mesh=new THREE.Mesh(d,new THREE.MeshBasicMaterial({color:65280,transparent:!0,opacity:.3,side:THREE.DoubleSide}));this.mesh.position.copy(this.ComputeNewPlanePosition(this.minPlaneDistance/100));this.mesh.quaternion.setFromUnitVectors(new THREE.Vector3(0,0,1),this.normal);this.modelGeometry=this.viewer.geometry.modelMeshes[0].geometry.clone();
this.poGroup=new THREE.Group;this.stencilGroup=new THREE.Group;this.stencilGroup.add(this.CreatePlaneStencilGroup(this.modelGeometry,this.cutPlane,1));d=(new THREE.TextureLoader).load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAWUlEQVQ4jaWTOw4AMAhCuf+l6dCkX21FTZyUNygAANdWC0XxBCTFHVAQU1afN5MA1sHDAO9bIcDr1V/AzydPQMRkLiDqUHOi2PuaqtnYNjLBGlvZVKIiJskGbQ087tuFaxEAAAAASUVORK5CYIIA",function(f){this.viewer.Render()}.bind(this));d.wrapS=d.wrapT=THREE.RepeatWrapping;d.anisotropy=
this.viewer.renderer.capabilities.getMaxAnisotropy();d.repeat.set(25,25);d.rotation=Math.PI/7;d=new THREE.MeshBasicMaterial({color:16311753,clippingPlanes:[],map:d,stencilWrite:!0,stencilRef:0,stencilFunc:THREE.NotEqualStencilFunc,stencilFail:THREE.ReplaceStencilOp,stencilZFail:THREE.ReplaceStencilOp,stencilZPass:THREE.ReplaceStencilOp});this.planeObject=new THREE.Mesh(new THREE.PlaneGeometry(4*a.radius,4*a.radius),d);this.planeObject.onAfterRender=function(f){f.clearStencil()};this.planeObject.renderOrder=
1.1;this.poGroup.add(this.planeObject);this.viewer.scene.add(this.stencilGroup);this.viewer.scene.add(this.poGroup);this.viewer.renderer.localClippingEnabled=!0;this.ShadowMeshes();this.mesh.visible=!0;this.viewer.scene.add(this.mesh);this.FixStencilPlaneOrientation();this.viewer.Render();this.slider=new c(0,1E3,this.CutPlaneAxisUpdated.bind(this));this.slider.CreateDomElement(b)}};
OV.CutPlane.prototype.ShadowMeshes=function(){var a=new THREE.MeshStandardMaterial({color:16761095,metalness:.1,roughness:.75,clippingPlanes:[this.cutPlane]});this.modelMeshes=[];this.edgesMeshes=[];for(var b=0;b<this.viewer.geometry.modelMeshes.length;b++)this.modelMeshes.push(new THREE.Mesh(this.viewer.geometry.modelMeshes[b].geometry.clone(),a)),this.modelMeshes[b].originalVisible=this.viewer.geometry.modelMeshes[b].visible,this.modelMeshes[b].position.copy(this.viewer.geometry.modelMeshes[b].position),
this.modelMeshes[b].renderOrder=2,this.viewer.scene.add(this.modelMeshes[b]),this.viewer.geometry.modelMeshes[b].visible=!1;new THREE.LineBasicMaterial({color:0,clippingPlanes:[this.cutPlane]});for(b=0;b<this.viewer.geometry.edgesMeshes.length;b++)this.edgesMeshes.push(new THREE.LineSegments(this.viewer.geometry.edgesMeshes[b].geometry.clone(),a)),this.edgesMeshes[b].originalVisible=this.viewer.geometry.edgesMeshes[b].visible,this.edgesMeshes[b].position.copy(this.viewer.geometry.edgesMeshes[b].position),
this.edgesMeshes[b].renderOrder=2,this.viewer.scene.add(this.edgesMeshes[b]),this.viewer.geometry.edgesMeshes[b].visible=!1};OV.CutPlane.prototype.FixStencilPlaneOrientation=function(){var a=this.planeObject;this.cutPlane.coplanarPoint(a.position);this.planeObject.lookAt(a.position.x-this.cutPlane.normal.x,a.position.y-this.cutPlane.normal.y,a.position.z-this.cutPlane.normal.z)};
OV.CutPlane.prototype.CreatePlaneStencilGroup=function(a,b,c){var d=new THREE.Group,e=new THREE.MeshBasicMaterial;e.depthWrite=!1;e.depthTest=!1;e.colorWrite=!1;e.stencilWrite=!0;e.stencilFunc=THREE.AlwaysStencilFunc;var f=e.clone();f.side=THREE.BackSide;f.clippingPlanes=[b];f.stencilFail=THREE.IncrementWrapStencilOp;f.stencilZFail=THREE.IncrementWrapStencilOp;f.stencilZPass=THREE.IncrementWrapStencilOp;f=new THREE.Mesh(a,f);f.renderOrder=c;d.add(f);e=e.clone();e.side=THREE.FrontSide;e.clippingPlanes=
[b];e.stencilFail=THREE.DecrementWrapStencilOp;e.stencilZFail=THREE.DecrementWrapStencilOp;e.stencilZPass=THREE.DecrementWrapStencilOp;a=new THREE.Mesh(a,e);a.renderOrder=c;d.add(a);return d};OV.CutPlane.prototype.ComputeNewPlanePosition=function(a){a=void 0===a?0:a;return this.cutPlanePos.clone().addScaledVector(this.normal,this.cutPlaneDistance+a)};
OV.CutPlane.prototype.CutPlaneAxisUpdated=function(a){this.cutPlaneDistance=a/1E3*(this.maxPlaneDistance-this.minPlaneDistance)+this.minPlaneDistance;a=this.ComputeNewPlanePosition();this.cutPlane.setFromNormalAndCoplanarPoint(this.normal,a);this.FixStencilPlaneOrientation();this.mesh.position.copy(this.ComputeNewPlanePosition(this.minPlaneDistance/100));this.viewer.Render();return!1};
OV.CutPlane.prototype.Dispose=function(){this.mesh.visible=!1;this.viewer.scene.remove(this.mesh);for(var a=0;a<this.modelMeshes.length;a++)this.viewer.scene.remove(this.modelMeshes[a]),this.viewer.geometry.modelMeshes[a].visible=this.modelMeshes[a].originalVisible;for(a=0;a<this.edgesMeshes.length;a++)this.viewer.scene.remove(this.edgesMeshes[a]),this.viewer.geometry.edgesMeshes[a].visible=this.edgesMeshes[a].originalVisible;this.viewer.scene.remove(this.poGroup);this.viewer.scene.remove(this.stencilGroup);
this.viewer.Render();this.slider.Dispose()};OV.FaceSelector=function(a,b,c){this.viewer=a;this.raycaster=new THREE.Raycaster;this.mousePos=new THREE.Vector2;this.state=OV.FaceSelector.NoneSelected;var d=a.GetBoundingSphere(function(){return!0});a=new THREE.PlaneGeometry(.2*d.radius,.2*d.radius);this.coneHeight=.12*d.radius;d=new THREE.ConeGeometry(this.coneHeight/2,this.coneHeight,32);var e=new THREE.CircleGeometry(this.coneHeight/4,32);this.selectedPlanes=[new THREE.Plane(new THREE.Vector3(1,0,0),0),new THREE.Plane(new THREE.Vector3(1,0,0),
0)];this.material=[new THREE.MeshBasicMaterial({color:16776960,transparent:!0,opacity:.3,side:THREE.DoubleSide}),new THREE.MeshBasicMaterial({color:0,transparent:!0,opacity:.3,side:THREE.DoubleSide}),new THREE.MeshPhongMaterial({color:16711680,transparent:!0,opacity:.8,shininess:100})];this.mesh=[new THREE.Mesh(a,this.material[0]),new THREE.Mesh(e,this.material[1]),new THREE.Mesh(d,this.material[2]),new THREE.Mesh(e,this.material[1]),new THREE.Mesh(d,this.material[2])];for(a=0;a<this.mesh.length;a++)d=
this.mesh[a],d.visible=!1,this.viewer.scene.add(d);this.viewer.Render();this.viewer.navigation.SetMoveHandler(this.GetFaceUnderMouse.bind(this));this.viewer.navigation.SetClickHandler(this.SelectFace.bind(this));this.button=b;this.infoPanel=c};
OV.FaceSelector.prototype.IntersectPlane=function(a){this.mousePos.x=a.x/this.viewer.canvas.width*2-1;this.mousePos.y=2*-(a.y/this.viewer.canvas.height)+1;this.raycaster.setFromCamera(this.mousePos,this.viewer.camera);a=this.raycaster.intersectObjects(this.viewer.scene.children);this.mesh[0].visible=!1;if(0<a.length)for(var b=0;b<a.length;b++){var c=a[b];if(c.object.id!==this.mesh[0].id&&c.object.id!==this.mesh[1].id&&c.object.id!==this.mesh[2].id&&"Mesh"===c.object.type&&c.object.visible)return{normal:c.face.normal,
position:c.point}}return null};OV.FaceSelector.prototype.GetFaceUnderMouse=function(a){a=this.IntersectPlane(a);return null!==a?(this.mesh[0].position.copy(a.position.addScaledVector(a.normal,.005)),this.mesh[0].quaternion.setFromUnitVectors(new THREE.Vector3(0,0,1),a.normal),this.mesh[0].visible=!0,this.viewer.Render(),!0):!1};
OV.FaceSelector.prototype.SelectFace=function(a,b,c){a=window.devicePixelRatio||1;c.x*=a;c.y*=a;c=this.IntersectPlane(c);if(null===c)return!1;switch(this.state){case OV.FaceSelector.TwoFaceSelected:this.mesh[2].visible=!1;case OV.FaceSelector.NoneSelected:this.selectedPlanes[0].setFromNormalAndCoplanarPoint(c.normal,c.position);this.mesh[1].position.copy(c.position.addScaledVector(c.normal,this.coneHeight/100));this.mesh[1].quaternion.setFromUnitVectors(new THREE.Vector3(0,0,1),c.normal);this.mesh[2].position.copy(c.position.addScaledVector(c.normal,
this.coneHeight/2));this.mesh[2].quaternion.setFromUnitVectors(new THREE.Vector3(0,-1,0),c.normal);this.state=OV.FaceSelector.OneFaceSelected;this.mesh[1].visible=!0;this.mesh[2].visible=!0;break;case OV.FaceSelector.OneFaceSelected:this.selectedPlanes[1].setFromNormalAndCoplanarPoint(c.normal,c.position),this.mesh[3].position.copy(c.position.addScaledVector(c.normal,this.coneHeight/100)),this.mesh[3].quaternion.setFromUnitVectors(new THREE.Vector3(0,0,1),c.normal),this.mesh[4].position.copy(c.position.addScaledVector(c.normal,
this.coneHeight/2)),this.mesh[4].quaternion.setFromUnitVectors(new THREE.Vector3(0,-1,0),c.normal),this.state=OV.FaceSelector.TwoFaceSelected,this.mesh[3].visible=!0,this.mesh[4].visible=!0,c=this.selectedPlanes[0].normal.angleTo(this.selectedPlanes[1].normal),a=new THREE.Vector3(0,0,0),this.selectedPlanes[0].coplanarPoint(a),a=Math.abs(this.selectedPlanes[1].distanceToPoint(a)),b=this.mesh[1].position.clone().addScaledVector(this.selectedPlanes[0].normal,-this.coneHeight/100).distanceTo(this.mesh[3].position.clone().addScaledVector(this.selectedPlanes[0].normal,
-this.coneHeight/100)),.01<Math.abs(c%Math.PI)&&(a=0),this.infoPanel.UpdateMeasure(a,c,b)}this.viewer.Render()};OV.FaceSelector.prototype.Dispose=function(){this.viewer.navigation.SetMoveHandler(null);for(var a=0;a<this.mesh.length;a++){var b=this.mesh[a];b.visible=!1;this.viewer.scene.remove(b)}this.button.Select(!1);this.infoPanel.UpdateMeasure(null,null);this.viewer.Render()};
$jscomp.global.Object.defineProperties(OV.FaceSelector,{NoneSelected:{configurable:!0,enumerable:!0,get:function(){return 0}},OneFaceSelected:{configurable:!0,enumerable:!0,get:function(){return 1}},TwoFaceSelected:{configurable:!0,enumerable:!0,get:function(){return 2}}});OV.GetDefaultCamera=function(a){return a===OV.Direction.X?new OV.Camera(new OV.Coord3D(2,-3,1.5),new OV.Coord3D(0,0,0),new OV.Coord3D(1,0,0)):a===OV.Direction.Y?new OV.Camera(new OV.Coord3D(-1.5,2,3),new OV.Coord3D(0,0,0),new OV.Coord3D(0,1,0)):a===OV.Direction.Z?new OV.Camera(new OV.Coord3D(-1.5,-3,2),new OV.Coord3D(0,0,0),new OV.Coord3D(0,0,1)):null};OV.UpVector=function(){this.direction=OV.Direction.Z;this.isFixed=!0;this.isFlipped=!1};
OV.UpVector.prototype.SetDirection=function(a,b){this.direction=a;this.isFlipped=!1;a=OV.GetDefaultCamera(this.direction);a=OV.SubCoord3D(a.eye,a.center);var c=OV.CoordDistance3D(b.center,b.eye);a=b.center.Clone().Offset(a,c);b=b.Clone();this.direction===OV.Direction.X&&(b.up=new OV.Coord3D(1,0,0),b.eye=a);this.direction===OV.Direction.Y?(b.up=new OV.Coord3D(0,1,0),b.eye=a):this.direction===OV.Direction.Z&&(b.up=new OV.Coord3D(0,0,1),b.eye=a);return b};
OV.UpVector.prototype.SetFixed=function(a,b){return(this.isFixed=a)?this.SetDirection(this.direction,b):null};OV.UpVector.prototype.Flip=function(a){this.isFlipped=!this.isFlipped;a=a.Clone();a.up.MultiplyScalar(-1);return a};OV.ViewerGeometry=function(a){this.scene=a;this.modelMeshes=[];this.edgesMeshes=[];this.edgesSettings={showEdges:!1,edgesAngle:15,edgesColor:new OV.Color(0,0,0)}};
OV.ViewerGeometry.prototype.AddModelMeshes=function(a){for(var b=0;b<a.length;b++){var c=a[b];this.modelMeshes.push(c);this.scene.add(c)}this.edgesSettings.showEdges&&this.ToggleEdges(!0)};OV.ViewerGeometry.prototype.GetModelMeshes=function(){return this.modelMeshes};OV.ViewerGeometry.prototype.ClearModelMeshes=function(){this.ToggleEdges(!1);for(var a=0;a<this.modelMeshes.length;a++){var b=this.modelMeshes[a];b.geometry.dispose();this.scene.remove(b)}this.modelMeshes=[]};
OV.ViewerGeometry.prototype.EnumerateModelMeshes=function(a){for(var b=0;b<this.modelMeshes.length;b++)a(this.modelMeshes[b])};OV.ViewerGeometry.prototype.GetModelMeshUnderMouse=function(a,b,c,d){var e=new THREE.Raycaster,f=new THREE.Vector2;f.x=a.x/c*2-1;f.y=2*-(a.y/d)+1;e.setFromCamera(f,b);a=e.intersectObjects(this.modelMeshes);for(b=0;b<a.length;b++)if(c=a[b],"Mesh"===c.object.type&&c.object.visible)return c.object;return null};
OV.ViewerGeometry.prototype.ToggleEdges=function(a){if(a)for(a=0;a<this.modelMeshes.length;a++){var b=new THREE.EdgesGeometry(this.modelMeshes[a].geometry,this.edgesSettings.edgesAngle);b=new THREE.LineSegments(b,new THREE.LineBasicMaterial({color:"#"+OV.ColorToHexString(this.edgesSettings.edgesColor)}));this.scene.add(b);this.edgesMeshes.push(b)}else{for(a=this.edgesMeshes.length-1;0<=a;a--)b=this.edgesMeshes[a],b.geometry.dispose(),this.scene.remove(b);this.edgesMeshes=[]}};
OV.ViewerGeometry.prototype.SetMeshVisibility=function(a,b){a.visible!==b&&(a.visible=b,a=this.modelMeshes.indexOf(a),this.edgesMeshes.length>a&&(this.edgesMeshes[a].visible=b))};OV.Viewer=function(){this.upVector=this.navigation=this.light=this.camera=this.geometry=this.scene=this.renderer=this.canvas=null;this.settings={animationSteps:40};this.navCube=null};OV.Viewer.prototype.UpdateEdgesSettings=function(a){this.geometry.edgesSettings=Object.assign({},a)};
OV.Viewer.prototype.Init=function(a,b,c){this.canvas=a;this.canvas.classList.add("viewer");this.renderer=new THREE.WebGLRenderer({canvas:this.canvas,antialias:!0});window.devicePixelRatio&&this.renderer.setPixelRatio(window.devicePixelRatio);this.renderer.setClearColor("#ffffff",1);this.renderer.setSize(this.canvas.width,this.canvas.height);this.scene=new THREE.Scene;this.geometry=new OV.ViewerGeometry(this.scene);this.InitCamera();this.InitLights();this.navigation.SetZoomFactor(c);null!==b&&(this.navCube=
new OV.NavCube({},this,b));this.Render()};OV.Viewer.prototype.SetClickHandler=function(a){this.navigation.SetClickHandler(a)};OV.Viewer.prototype.GetCamera=function(){return this.navigation.GetCamera()};OV.Viewer.prototype.SetCamera=function(a){this.navigation.SetCamera(a);this.Render()};OV.Viewer.prototype.Resize=function(a,b){a=OV.GetInnerDimensions(this.canvas,a,b);this.ResizeRenderer(a.width,a.height)};
OV.Viewer.prototype.ResizeRenderer=function(a,b){window.devicePixelRatio&&this.renderer.setPixelRatio(window.devicePixelRatio);this.camera.aspect=a/b;this.camera.updateProjectionMatrix();this.renderer.setSize(a,b);null!==this.navCube&&this.navCube.ResizedRenderer(b/4,b/4);this.Render()};
OV.Viewer.prototype.FitToWindow=function(a,b){if(null!==a){var c=new OV.Coord3D(a.center.x,a.center.y,a.center.z);a=a.radius;var d=this.camera.fov;b?(b=this.navigation.GetFitToSphereCamera(c,a,d),this.navigation.MoveCamera(b,this.settings.animationSteps)):this.navigation.FitToSphere(c,a,d)}};
OV.Viewer.prototype.AdjustClippingPlanes=function(a){null!==a&&(10>a.radius?(this.camera.near=.01,this.camera.far=100):100>a.radius?(this.camera.near=.1,this.camera.far=1E3):1E3>a.radius?(this.camera.near=10,this.camera.far=1E4):(this.camera.near=100,this.camera.far=1E6),this.camera.updateProjectionMatrix(),this.Render())};OV.Viewer.prototype.IsFixUpVector=function(){return this.navigation.IsFixUpVector()};
OV.Viewer.prototype.SetFixUpVector=function(a){var b=this.navigation.GetCamera();b=this.upVector.SetFixed(a,b);this.navigation.SetFixUpVector(a);null!==b&&this.navigation.MoveCamera(b,this.settings.animationSteps);this.Render()};
OV.Viewer.prototype.SetCameraViewDirection=function(a,b,c){var d=this.navigation.GetCamera(),e=OV.CoordDistance3D(d.center,d.eye);e=OV.AddCoord3D(a.Normalize().MultiplyScalar(-e),d.center);a=c?c:OV.CrossVector3D(e,a.Normalize());d=new OV.Camera(e,d.center,a);this.navigation.MoveCamera(d,b?this.settings.animationSteps:0);this.Render()};
OV.Viewer.prototype.SetUpVector=function(a,b){var c=this.navigation.GetCamera();a=this.upVector.SetDirection(a,c);this.navigation.MoveCamera(a,b?this.settings.animationSteps:0);this.Render()};OV.Viewer.prototype.FlipUpVector=function(){var a=this.navigation.GetCamera();a=this.upVector.Flip(a);this.navigation.MoveCamera(a,0);this.Render()};
OV.Viewer.prototype.Render=function(){var a=this.navigation.GetCamera();this.camera.position.set(a.eye.x,a.eye.y,a.eye.z);this.camera.up.set(a.up.x,a.up.y,a.up.z);this.camera.lookAt(new THREE.Vector3(a.center.x,a.center.y,a.center.z));a=OV.SubCoord3D(a.eye,a.center);this.light.position.set(a.x,a.y,a.z);this.renderer.render(this.scene,this.camera);null!==this.navCube&&this.navCube.Render()};OV.Viewer.prototype.ToggleEdges=function(a){this.geometry.ToggleEdges(a);this.Render()};
OV.Viewer.prototype.AddMeshes=function(a){this.geometry.AddModelMeshes(a);this.Render()};OV.Viewer.prototype.Clear=function(){this.geometry.ClearModelMeshes();this.Render()};OV.Viewer.prototype.SetMeshesVisibility=function(a){this.geometry.EnumerateModelMeshes(function(b){var c=a(b.userData);this.geometry.SetMeshVisibility(b,c)}.bind(this));this.Render()};
OV.Viewer.prototype.SetMeshesHighlight=function(a,b){this.geometry.EnumerateModelMeshes(function(c){if(b(c.userData)){if(null===c.userData.threeMaterials){for(var d=c.userData.threeMaterials=c.material,e=[],f=0;f<d.length;f++)e.push(a);c.material=e}}else null!==c.userData.threeMaterials&&(c.material=c.userData.threeMaterials,c.userData.threeMaterials=null)});this.Render()};
OV.Viewer.prototype.GetMeshUserDataUnderMouse=function(a){var b=this.canvas.width,c=this.canvas.height;window.devicePixelRatio&&(b/=window.devicePixelRatio,c/=window.devicePixelRatio);a=this.geometry.GetModelMeshUnderMouse(a,this.camera,b,c);return null===a?null:a.userData};OV.Viewer.prototype.GetBoundingBox=function(a){var b=!1,c=new THREE.Box3;this.geometry.EnumerateModelMeshes(function(d){a(d.userData)&&(c.union((new THREE.Box3).setFromObject(d)),b=!0)});return b?c:null};
OV.Viewer.prototype.GetBoundingSphere=function(a){a=this.GetBoundingBox(a);if(null===a)return null;var b=new THREE.Sphere;a.getBoundingSphere(b);this.navigation.SetBoundingSphereRadius(b.radius);return b};OV.Viewer.prototype.EnumerateMeshesUserData=function(a){this.geometry.EnumerateModelMeshes(function(b){a(b.userData)})};
OV.Viewer.prototype.InitCamera=function(){this.camera=new THREE.PerspectiveCamera(45,this.canvas.width/this.canvas.height,.1,1E3);this.scene.add(this.camera);var a=this.renderer.domElement,b=OV.GetDefaultCamera(OV.Direction.Z),c=this;this.navigation=new OV.Navigation(a,b);this.navigation.SetUpdateHandler(function(){c.Render()});this.upVector=new OV.UpVector};
OV.Viewer.prototype.InitLights=function(){var a=new THREE.AmbientLight(8947848);this.scene.add(a);this.light=new THREE.DirectionalLight(8947848);this.scene.add(this.light)};OV.Viewer.prototype.GetImageSize=function(){var a=new THREE.Vector2;this.renderer.getSize(a);return{width:parseInt(a.x,10),height:parseInt(a.y,10)}};
OV.Viewer.prototype.GetImageAsDataUrl=function(a,b){var c=this.GetImageSize();window.devicePixelRatio&&(a/=window.devicePixelRatio,b/=window.devicePixelRatio);this.ResizeRenderer(a,b);this.Render();b=this.renderer.domElement.toDataURL();this.ResizeRenderer(c.width,c.height);return b};OV.Init3DViewerElements=function(a){function b(d){var e=document.createElement("canvas");d.appendChild(e);var f=null;d.getAttribute("navcube")&&(f=document.createElement("canvas"),d.appendChild(f));var g=d.getAttribute("zoomFactor"),h=new OV.Viewer;h.Init(e,f,g);h.Resize(d.clientWidth,d.clientHeight);f=new OV.ThreeModelLoader;var k=null;f.Init({onLoadStart:function(){e.style.display="none";k=document.createElement("div");d.appendChild(k);k.innerHTML="Loading model..."},onImportStart:function(){k.innerHTML=
"Importing model..."},onVisualizationStart:function(){k.innerHTML="Visualizing model..."},onModelFinished:function(n,q){d.removeChild(k);e.style.display="inherit";h.AddMeshes(q);q=h.GetBoundingSphere(function(v){return!0});h.AdjustClippingPlanes(q);var r=null,t=d.getAttribute("camera");t&&(r=OV.ParameterConverter.StringToCamera(t));null!==r?h.SetCamera(r):h.SetUpVector(n.upVector,!1);h.FitToWindow(q,!1);a(h,n)},onTextureLoaded:function(){h.Render()},onLoadError:function(n){k.innerHTML="Unknown error."}});
if(g=d.getAttribute("model"))if(g=OV.ParameterConverter.StringToModelUrls(g),null!==g&&0!==g.length){var l=new OV.ImportSettings,m=d.getAttribute("color");m&&(m=OV.ParameterConverter.StringToColor(m),null!==m&&(l.defaultColor=m));m={};var p=d.getAttribute("edge");p&&(p=OV.ParameterConverter.StringToColor(p),null!==p&&(m.showEdges=!0,m.edgesColor=p,m.edgesAngle=30));h.UpdateEdgesSettings(m);f.LoadFromUrlList(g,l);return{element:d,viewer:h}}}var c=[];window.addEventListener("load",function(){for(var d=
document.getElementsByClassName("online_3d_viewer"),e=0;e<d.length;e++){var f=b(d[e]);c.push(f)}});window.addEventListener("resize",function(){for(var d=0;d<c.length;d++){var e=c[d];e.viewer.Resize(e.element.clientWidth,e.element.clientHeight)}});return c};
